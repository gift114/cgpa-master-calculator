let e,t,n,i,r,s,o,a,l,h,u,c,d,f,p;var g,m,y,_,v,w,b,E,I,T,C,S,k,A,N,R,P,D,x,O,L,M,U,F,V,B=globalThis;const j=()=>void 0,q={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},$=function(e,t){if(!e)throw z(t)},z=function(e){return Error("Firebase Database ("+q.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},H=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},W=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=e[n++],o=((7&r)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(o>>10)),t[i++]=String.fromCharCode(56320+(1023&o))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},K={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,u=(3&r)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),i.push(n[h],n[u],n[c],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(H(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):W(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new G;let l=r<<2|s>>4;if(i.push(l),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class G extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Q=function(e){let t=H(e);return K.encodeByteArray(t,!0)},Y=function(e){return Q(e).replace(/\./g,"")},J=function(e){try{return K.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},X=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==B)return B;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,Z=()=>{},ee=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&J(e[1]);return t&&JSON.parse(t)},et=()=>{try{return j()||X()||Z()||ee()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},en=e=>{var t,n;return null==(n=null==(t=et())?void 0:t.emulatorHosts)?void 0:n[e]},ei=e=>{let t=en(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},er=()=>{var e;return null==(e=et())?void 0:e.config},es=e=>{var t;return null==(t=et())?void 0:t[`_${e}`]};class eo{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function ea(e){return e.endsWith(".cloudworkstations.dev")}async function el(e){return(await fetch(e,{credentials:"include"})).ok}function eh(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Y(JSON.stringify({alg:"none",type:"JWT"})),Y(JSON.stringify(s)),""].join(".")}const eu={};let ec=!1;function ed(e,t){if("undefined"==typeof window||"undefined"==typeof document||!ea(window.location.host)||eu[e]===t||eu[e]||ec)return;function n(e){return`__firebase__banner__${e}`}eu[e]=t;let i="__firebase__banner",r=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(eu))eu[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(i),t=!1,e||((e=document.createElement("div")).setAttribute("id",i),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{ec=!0;let e=document.getElementById(i);e&&e.remove()},e}();c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",e.append(c,a,h,t),document.body.appendChild(e)}r?(a.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function ef(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ep(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ef())}function eg(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function em(){return!0===q.NODE_CLIENT||!0===q.NODE_ADMIN}class ey extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,ey.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,e_.prototype.create)}}class e_{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,i;let r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,i=r,n.replace(ev,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new ey(s,l,r)}}const ev=/\{\$([^}]+)}/g;function ew(e){return JSON.parse(e)}function eb(e){return JSON.stringify(e)}const eE=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=ew(J(s[0])||""),n=ew(J(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},eI=function(e){let t=eE(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},eT=function(e){let t=eE(e).claims;return"object"==typeof t&&!0===t.admin};function eC(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eS(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function ek(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function eA(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function eN(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(eR(n)&&eR(s)){if(!eN(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function eR(e){return null!==e&&"object"==typeof e}function eP(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function eD(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function ex(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class eO{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=t<<1|t>>>31}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),i=0x5a827999):(n=o^a^l,i=0x6ed9eba1):e<60?(n=o&a|l&(o|a),i=0x8f1bbcdc):(n=o^a^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]|0;h=l,l=a,a=o<<30|o>>>2,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class eL{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=eM),void 0===i.error&&(i.error=eM),void 0===i.complete&&(i.complete=eM);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eM(){}const eU=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;$(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eF=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function eV(e){return e&&e._delegate?e._delegate:e}class eB{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ej="[DEFAULT]";class eq{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new eo;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}if(i)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ej})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ej){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ej){return this.instances.has(e)}getOptions(e=ej){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),r=null!=(n=this.onInitCallbacks.get(i))?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);let s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===ej?void 0:n,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch(e){}return i||null}normalizeInstanceIdentifier(e=ej){return this.component?this.component.multipleInstances?e:ej:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class e${constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eq(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const ez=[];(g=_||(_={}))[g.DEBUG=0]="DEBUG",g[g.VERBOSE=1]="VERBOSE",g[g.INFO=2]="INFO",g[g.WARN=3]="WARN",g[g.ERROR=4]="ERROR",g[g.SILENT=5]="SILENT";const eH={debug:_.DEBUG,verbose:_.VERBOSE,info:_.INFO,warn:_.WARN,error:_.ERROR,silent:_.SILENT},eW=_.INFO,eK={[_.DEBUG]:"log",[_.VERBOSE]:"log",[_.INFO]:"info",[_.WARN]:"warn",[_.ERROR]:"error"},eG=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=eK[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eQ{constructor(e){this.name=e,this._logLevel=eW,this._logHandler=eG,this._userLogHandler=null,ez.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eH[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_.DEBUG,...e),this._logHandler(this,_.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_.VERBOSE,...e),this._logHandler(this,_.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_.INFO,...e),this._logHandler(this,_.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_.WARN,...e),this._logHandler(this,_.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_.ERROR,...e),this._logHandler(this,_.ERROR,...e)}}const eY=(e,t)=>t.some(t=>e instanceof t),eJ=new WeakMap,eX=new WeakMap,eZ=new WeakMap,e0=new WeakMap,e1=new WeakMap;let e2={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eX.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eZ.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return e6(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function e6(n){if(n instanceof IDBRequest){let e=new Promise((e,t)=>{let i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",s)},r=()=>{e(e6(n.result)),i()},s=()=>{t(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&eJ.set(e,n)}).catch(()=>{}),e1.set(e,n),e}if(e0.has(n))return e0.get(n);let i=function(n){if("function"==typeof n)return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(n)?function(...e){return n.apply(e3(this),e),e6(eJ.get(this))}:function(...e){return e6(n.apply(e3(this),e))}:function(e,...t){let i=n.call(e3(this),e,...t);return eZ.set(i,e.sort?e.sort():[e]),e6(i)};return(n instanceof IDBTransaction&&function(e){if(eX.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});eX.set(e,t)}(n),eY(n,e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(n,e2):n}(n);return i!==n&&(e0.set(n,i),e1.set(i,n)),i}const e3=e=>e1.get(e),e5=["get","getKey","getAll","getAllKeys","count"],e4=["put","add","delete","clear"],e8=new Map;function e7(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(e8.get(t))return e8.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=e4.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||e5.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return e8.set(t,s),s}e2={...p=e2,get:(e,t,n)=>e7(e,t)||p.get(e,t,n),has:(e,t)=>!!e7(e,t)||p.has(e,t)};class e9{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}const te="@firebase/app",tt="0.12.3",tn=new eQ("@firebase/app"),ti="[DEFAULT]",tr={[te]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ts=new Map,to=new Map,ta=new Map;function tl(e,t){try{e.container.addComponent(t)}catch(n){tn.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function th(e){let t=e.name;if(ta.has(t))return tn.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(ta.set(t,e),ts.values()))tl(n,e);for(let t of to.values())tl(t,e);return!0}function tu(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function tc(e){return null!=e&&void 0!==e.settings}const td=new e_("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tf{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eB("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw td.create("app-deleted",{appName:this._name})}}const tp="11.7.3";function tg(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i=Object.assign({name:ti,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw td.create("bad-app-name",{appName:String(r)});if(n||(n=er()),!n)throw td.create("no-options");let s=ts.get(r);if(s)if(eN(n,s.options)&&eN(i,s.config))return s;else throw td.create("duplicate-app",{appName:r});let o=new e$(r);for(let e of ta.values())o.addComponent(e);let a=new tf(n,i,o);return ts.set(r,a),a}function tm(e=ti){let t=ts.get(e);if(!t&&e===ti&&er())return tg();if(!t)throw td.create("no-app",{appName:e});return t}function ty(e,t,n){var i;let r=null!=(i=tr[e])?i:e;n&&(r+=`-${n}`);let s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let e=[`Unable to register library "${r}" with version "${t}":`];s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),tn.warn(e.join(" "));return}th(new eB(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const t_="firebase-heartbeat-store";let tv=null;function tw(){return tv||(tv=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),a=e6(o);return i&&o.addEventListener("upgradeneeded",e=>{i(e6(o.result),e.oldVersion,e.newVersion,e6(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(t_)}catch(e){console.warn(e)}}}).catch(e=>{throw td.create("idb-open",{originalErrorMessage:e.message})})),tv}async function tb(e){try{let t=(await tw()).transaction(t_),n=await t.objectStore(t_).get(tI(e));return await t.done,n}catch(e){if(e instanceof ey)tn.warn(e.message);else{let t=td.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});tn.warn(t.message)}}}async function tE(e,t){try{let n=(await tw()).transaction(t_,"readwrite"),i=n.objectStore(t_);await i.put(t,tI(e)),await n.done}catch(e){if(e instanceof ey)tn.warn(e.message);else{let t=td.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});tn.warn(t.message)}}}function tI(e){return`${e.name}!${e.options.appId}`}class tT{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new tS(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=tC();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(e=>e.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){tn.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=tC(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),tk(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),tk(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=Y(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return tn.warn(e),""}}}function tC(){return new Date().toISOString().substring(0,10)}class tS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null==(e=r.error)?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tb(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return tE(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return tE(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function tk(e){return Y(JSON.stringify({version:2,heartbeats:e})).length}function tA(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function tN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}th(new eB("platform-logger",e=>new e9(e),"PRIVATE")),th(new eB("heartbeat",e=>new tT(e),"PRIVATE")),ty(te,tt,""),ty(te,tt,"esm2017"),ty("fire-js",""),ty("firebase","11.7.3","app"),"function"==typeof SuppressedError&&SuppressedError;const tR=new e_("auth","Firebase",tN()),tP=new eQ("@firebase/auth");function tD(e,...t){tP.logLevel<=_.ERROR&&tP.error(`Auth (${tp}): ${e}`,...t)}function tx(e,...t){throw tU(e,...t)}function tO(e,...t){return tU(e,...t)}function tL(e,t,n){return new e_("auth","Firebase",Object.assign(Object.assign({},tN()),{[t]:n})).create(t,{appName:e.name})}function tM(e){return tL(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tU(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return tR.create(e,...t)}function tF(e,t,...n){if(!e)throw tU(t,...n)}function tV(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tD(t),Error(t)}function tB(e,t){e||tV(t)}function tj(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function tq(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class t${constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||tV(n),this.isMobile=ep()||eg()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===tq()||"https:"===tq()||function(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tz(e,t){var n,i;n=e.emulator,i="Emulator should always be set here",n||tV(i);let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class tH{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void tV("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void tV("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void tV("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const tW={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tK=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tG=new t$(3e4,6e4);function tQ(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function tY(e,t,n,i,r={}){return tJ(e,r,async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});let o=eP(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);let l=Object.assign({method:t,headers:a},r);return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&ea(e.emulatorConfig.host)&&(l.credentials="include"),tH.fetch()(await tZ(e,e.config.apiHost,n,o),l)})}async function tJ(e,t,n){e._canInitEmulator=!1;let i=Object.assign(Object.assign({},tW),t);try{let t=new t0(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw t1(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw t1(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw t1(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw t1(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw tL(e,o,n);tx(e,o)}}catch(t){if(t instanceof ey)throw t;tx(e,"network-request-failed",{message:String(t)})}}async function tX(e,t,n,i,r={}){let s=await tY(e,t,n,i,r);return"mfaPendingCredential"in s&&tx(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function tZ(e,t,n,i){let r=`${t}${n}?${i}`,s=e.config.emulator?tz(e.config,r):`${e.config.apiScheme}://${r}`;return tK.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class t0{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tO(this.auth,"network-request-failed")),tG.get())})}}function t1(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=tO(e,t,i);return r.customData._tokenResponse=n,r}function t2(e){return void 0!==e&&void 0!==e.enterprise}class t6{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function t3(e,t){return tY(e,"GET","/v2/recaptchaConfig",tQ(e,t))}async function t5(e,t){return tY(e,"POST","/v1/accounts:delete",t)}async function t4(e,t){return tY(e,"POST","/v1/accounts:lookup",t)}function t8(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function t7(e,t=!1){let n=eV(e),i=await n.getIdToken(t),r=ne(i);tF(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");let s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:t8(t9(r.auth_time)),issuedAtTime:t8(t9(r.iat)),expirationTime:t8(t9(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function t9(e){return 1e3*Number(e)}function ne(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return tD("JWT malformed, contained fewer than 3 sections"),null;try{let e=J(n);if(!e)return tD("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tD("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function nt(e){let t=ne(e);return tF(t,"internal-error"),tF(void 0!==t.exp,"internal-error"),tF(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function nn(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof ey&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ni{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class nr{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=t8(this.lastLoginAt),this.creationTime=t8(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ns(e){var t,n,i;let r=e.auth,s=await e.getIdToken(),o=await nn(e,t4(r,{idToken:s}));tF(null==o?void 0:o.users.length,r,"internal-error");let a=o.users[0];e._notifyReloadListener(a);let l=(null==(t=a.providerUserInfo)?void 0:t.length)?na(a.providerUserInfo):[],h=(n=e.providerData,i=l,[...n.filter(e=>!i.some(t=>t.providerId===e.providerId)),...i]),u=e.isAnonymous,c=!(e.email&&a.passwordHash)&&!(null==h?void 0:h.length);Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:h,metadata:new nr(a.createdAt,a.lastLoginAt),isAnonymous:!!u&&c})}async function no(e){let t=eV(e);await ns(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function na(e){return e.map(e=>{var{providerId:t}=e,n=tA(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}async function nl(e,t){let n=await tJ(e,{},async()=>{let n=eP({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=await tZ(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",tH.fetch()(s,{method:"POST",headers:o,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function nh(e,t){return tY(e,"POST","/v2/accounts:revokeToken",tQ(e,t))}class nu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tF(e.idToken,"internal-error"),tF(void 0!==e.idToken,"internal-error"),tF(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):nt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tF(0!==e.length,"internal-error");let t=nt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tF(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await nl(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new nu;return n&&(tF("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(tF("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(tF("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new nu,this.toJSON())}_performRefresh(){return tV("not implemented")}}function nc(e,t){tF("string"==typeof e||void 0===e,"internal-error",{appName:t})}class nd{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=tA(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ni(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new nr(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await nn(this,this.stsTokenManager.getToken(this.auth,e));return tF(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return t7(this,e)}reload(){return no(this)}_assign(e){this!==e&&(tF(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new nd(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){tF(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ns(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tc(this.auth.app))return Promise.reject(tM(this.auth));let e=await this.getIdToken();return await nn(this,t5(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,l,h;let u=null!=(n=t.displayName)?n:void 0,c=null!=(i=t.email)?i:void 0,d=null!=(r=t.phoneNumber)?r:void 0,f=null!=(s=t.photoURL)?s:void 0,p=null!=(o=t.tenantId)?o:void 0,g=null!=(a=t._redirectEventId)?a:void 0,m=null!=(l=t.createdAt)?l:void 0,y=null!=(h=t.lastLoginAt)?h:void 0,{uid:_,emailVerified:v,isAnonymous:w,providerData:b,stsTokenManager:E}=t;tF(_&&E,e,"internal-error");let I=nu.fromJSON(this.name,E);tF("string"==typeof _,e,"internal-error"),nc(u,e.name),nc(c,e.name),tF("boolean"==typeof v,e,"internal-error"),tF("boolean"==typeof w,e,"internal-error"),nc(d,e.name),nc(f,e.name),nc(p,e.name),nc(g,e.name),nc(m,e.name),nc(y,e.name);let T=new nd({uid:_,auth:e,email:c,emailVerified:v,displayName:u,isAnonymous:w,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:I,createdAt:m,lastLoginAt:y});return b&&Array.isArray(b)&&(T.providerData=b.map(e=>Object.assign({},e))),g&&(T._redirectEventId=g),T}static async _fromIdTokenResponse(e,t,n=!1){let i=new nu;i.updateFromServerResponse(t);let r=new nd({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await ns(r),r}static async _fromGetAccountInfoResponse(e,t,n){let i=t.users[0];tF(void 0!==i.localId,"internal-error");let r=void 0!==i.providerUserInfo?na(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!(null==r?void 0:r.length),o=new nu;o.updateFromIdToken(n);let a=new nd({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new nr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(null==r?void 0:r.length)}),a}}const nf=new Map;function np(e){var t,n;t="Expected a class definition",e instanceof Function||tV(t);let i=nf.get(e);return i?(n="Instance stored in cache mismatched with class",i instanceof e||tV(n)):(i=new e,nf.set(e,i)),i}class ng{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function nm(e,t,n){return`firebase:${e}:${t}:${n}`}ng.type="NONE";class ny{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:i,name:r}=this.auth;this.fullUserKey=nm(this.userKey,i.apiKey,r),this.fullPersistenceKey=nm("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await t4(this.auth,{idToken:e}).catch(()=>void 0);return t?nd._fromGetAccountInfoResponse(this.auth,t,e):null}return nd._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ny(np(ng),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||np(ng),s=nm(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let i;if("string"==typeof t){let n=await t4(e,{idToken:t}).catch(()=>void 0);if(!n)break;i=await nd._fromGetAccountInfoResponse(e,n,t)}else i=nd._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}let a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length&&(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new ny(r,e,n)}}function n_(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(nE(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(nv(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(nT(t))return"Blackberry";if(nC(t))return"Webos";if(nw(t))return"Safari";if((t.includes("chrome/")||nb(t))&&!t.includes("edge/"))return"Chrome";if(nI(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function nv(e=ef()){return/firefox\//i.test(e)}function nw(e=ef()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function nb(e=ef()){return/crios\//i.test(e)}function nE(e=ef()){return/iemobile/i.test(e)}function nI(e=ef()){return/android/i.test(e)}function nT(e=ef()){return/blackberry/i.test(e)}function nC(e=ef()){return/webos/i.test(e)}function nS(e=ef()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function nk(e=ef()){return nS(e)||nI(e)||nC(e)||nT(e)||/windows phone/i.test(e)||nE(e)}function nA(e,t=[]){let n;switch(e){case"Browser":n=n_(ef());break;case"Worker":n=`${n_(ef())}-${e}`;break;default:n=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${tp}/${i}`}class nN{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let i=e(t);n(i)}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function nR(e,t={}){return tY(e,"GET","/v2/passwordPolicy",tQ(e,t))}class nP{constructor(e){var t,n,i,r;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=s.minPasswordLength)?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(i=null==(n=e.allowedNonAlphanumericCharacters)?void 0:n.join(""))?i:"",this.forceUpgradeOnSignin=null!=(r=e.forceUpgradeOnSignin)&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,s,o;let a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null==(t=a.meetsMinPasswordLength)||t),a.isValid&&(a.isValid=null==(n=a.meetsMaxPasswordLength)||n),a.isValid&&(a.isValid=null==(i=a.containsLowercaseLetter)||i),a.isValid&&(a.isValid=null==(r=a.containsUppercaseLetter)||r),a.isValid&&(a.isValid=null==(s=a.containsNumericCharacter)||s),a.isValid&&(a.isValid=null==(o=a.containsNonAlphanumericCharacter)||o),a}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class nD{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nx(this),this.idTokenSubscription=new nx(this),this.beforeStateQueue=new nN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tR,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=np(t)),this._initializationPromise=this.queue(async()=>{var n,i,r;if(!this._deleted){if(this.persistenceManager=await ny.create(this,e),null==(n=this._resolvePersistenceManagerAvailable)||n.call(this),!this._deleted){if(null==(i=this._popupRedirectResolver)?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(r=this.currentUser)?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await t4(this,{idToken:e}),n=await nd._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(tc(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let n=await this.assertedPersistence.getCurrentUser(),i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);(!n||n===s)&&(null==o?void 0:o.user)&&(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return(tF(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId)?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ns(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tc(this.app))return Promise.reject(tM(this));let t=e?eV(e):null;return t&&tF(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tF(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tc(this.app)?Promise.reject(tM(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tc(this.app)?Promise.reject(tM(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(np(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new nP(await nR(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new e_("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await nh(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&np(e)||this._popupRedirectResolver;tF(t,this,"argument-error"),this.redirectPersistenceManager=await ny.create(this,[np(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(n=this.redirectUser)?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(tF(o,this,"internal-error"),o.then(()=>{s||r(this.currentUser)}),"function"==typeof t){let r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tF(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);let i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(tc(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){tP.logLevel<=_.WARN&&tP.warn(`Auth (${tp}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}class nx{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new eL(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return tF(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let nO={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nL(e){return`__${e}${Math.floor(1e6*Math.random())}`}class nM{constructor(){this.enterprise=new nU}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nU{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const nF="NO_RECAPTCHA";class nV{constructor(e){this.type="recaptcha-enterprise",this.auth=eV(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{t3(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new t6(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function i(t,n,i){let r=window.grecaptcha;t2(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(nF)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new nM().execute("siteKey",{action:"verify"}):new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&t2(window.grecaptcha))i(n,e,r);else{var s;if("undefined"==typeof window)return void r(Error("RecaptchaVerifier is only supported in browser"));let t=nO.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,nO.loadJS(s)).then(()=>{i(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function nB(e,t,n,i=!1,r=!1){let s,o=new nV(e);if(r)s=nF;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function nj(e,t,n,i,r){var s,o;if("EMAIL_PASSWORD_PROVIDER"===r)if(null==(s=e._getRecaptchaConfig())||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return i(e,t).catch(async r=>{if("auth/missing-recaptcha-token"!==r.code)return Promise.reject(r);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let r=await nB(e,t,n,"getOobCode"===n);return i(e,r)}});else{let r=await nB(e,t,n,"getOobCode"===n);return i(e,r)}if("PHONE_PROVIDER"!==r)return Promise.reject(r+" provider is not supported.");if(null==(o=e._getRecaptchaConfig())?void 0:o.isProviderEnabled("PHONE_PROVIDER")){let r=await nB(e,t,n);return i(e,r).catch(async r=>{var s;if((null==(s=e._getRecaptchaConfig())?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let r=await nB(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)})}{let r=await nB(e,t,n,!1,!0);return i(e,r)}}async function nq(e){let t=eV(e),n=new t6(await t3(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new nV(t).verify()}function n$(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function nz(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class nH{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tV("not implemented")}_getIdTokenResponse(e){return tV("not implemented")}_linkToIdToken(e,t){return tV("not implemented")}_getReauthenticationResolver(e){return tV("not implemented")}}async function nW(e,t){return tY(e,"POST","/v1/accounts:signUp",t)}async function nK(e,t){return tX(e,"POST","/v1/accounts:signInWithPassword",tQ(e,t))}async function nG(e,t){return tX(e,"POST","/v1/accounts:signInWithEmailLink",tQ(e,t))}async function nQ(e,t){return tX(e,"POST","/v1/accounts:signInWithEmailLink",tQ(e,t))}class nY extends nH{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new nY(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new nY(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return nj(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nK,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nG(e,{email:this._email,oobCode:this._password});default:tx(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nj(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nW,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nQ(e,{idToken:t,email:this._email,oobCode:this._password});default:tx(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function nJ(e,t){return tX(e,"POST","/v1/accounts:signInWithIdp",tQ(e,t))}class nX extends nH{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new nX(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tx("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=tA(t,["providerId","signInMethod"]);if(!n||!i)return null;let s=new nX(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return nJ(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,nJ(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,nJ(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eP(t)}return e}}async function nZ(e,t){return tY(e,"POST","/v1/accounts:sendVerificationCode",tQ(e,t))}async function n0(e,t){return tX(e,"POST","/v1/accounts:signInWithPhoneNumber",tQ(e,t))}async function n1(e,t){let n=await tX(e,"POST","/v1/accounts:signInWithPhoneNumber",tQ(e,t));if(n.temporaryProof)throw t1(e,"account-exists-with-different-credential",n);return n}const n2={USER_NOT_FOUND:"user-not-found"};async function n6(e,t){return tX(e,"POST","/v1/accounts:signInWithPhoneNumber",tQ(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),n2)}class n3 extends nH{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n3({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n3({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return n0(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return n1(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return n6(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new n3({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class n5{constructor(e){var t,n,i,r,s,o;let a=eD(ex(e)),l=null!=(t=a.apiKey)?t:null,h=null!=(n=a.oobCode)?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(i=a.mode)?i:null);tF(l&&h&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=h,this.continueUrl=null!=(r=a.continueUrl)?r:null,this.languageCode=null!=(s=a.lang)?s:null,this.tenantId=null!=(o=a.tenantId)?o:null}static parseLink(e){let t=function(e){let t=eD(ex(e)).link,n=t?eD(ex(t)).deep_link_id:null,i=eD(ex(e)).deep_link_id;return(i?eD(ex(i)).link:null)||i||n||t||e}(e);try{return new n5(t)}catch(e){return null}}}class n4{constructor(){this.providerId=n4.PROVIDER_ID}static credential(e,t){return nY._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=n5.parseLink(t);return tF(n,"argument-error"),nY._fromEmailAndCode(e,n.code,n.tenantId)}}n4.PROVIDER_ID="password",n4.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n4.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class n8{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class n7 extends n8{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class n9 extends n7{constructor(){super("facebook.com")}static credential(e){return nX._fromParams({providerId:n9.PROVIDER_ID,signInMethod:n9.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return n9.credentialFromTaggedObject(e)}static credentialFromError(e){return n9.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return n9.credential(e.oauthAccessToken)}catch(e){return null}}}n9.FACEBOOK_SIGN_IN_METHOD="facebook.com",n9.PROVIDER_ID="facebook.com";class ie extends n7{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return nX._fromParams({providerId:ie.PROVIDER_ID,signInMethod:ie.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ie.credentialFromTaggedObject(e)}static credentialFromError(e){return ie.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ie.credential(t,n)}catch(e){return null}}}ie.GOOGLE_SIGN_IN_METHOD="google.com",ie.PROVIDER_ID="google.com";class it extends n7{constructor(){super("github.com")}static credential(e){return nX._fromParams({providerId:it.PROVIDER_ID,signInMethod:it.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return it.credentialFromTaggedObject(e)}static credentialFromError(e){return it.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return it.credential(e.oauthAccessToken)}catch(e){return null}}}it.GITHUB_SIGN_IN_METHOD="github.com",it.PROVIDER_ID="github.com";class ii extends n7{constructor(){super("twitter.com")}static credential(e,t){return nX._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ii.credentialFromTaggedObject(e)}static credentialFromError(e){return ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ii.credential(t,n)}catch(e){return null}}}async function ir(e,t){return tX(e,"POST","/v1/accounts:signUp",tQ(e,t))}ii.TWITTER_SIGN_IN_METHOD="twitter.com",ii.PROVIDER_ID="twitter.com";class is{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){return new is({user:await nd._fromIdTokenResponse(e,n,i),providerId:io(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new is({user:e,providerId:io(n),_tokenResponse:n,operationType:t})}}function io(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ia extends ey{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,ia.prototype),this.customData={appName:e.name,tenantId:null!=(r=e.tenantId)?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new ia(e,t,n,i)}}function il(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw ia._fromErrorAndOperation(e,n,t,i);throw n})}async function ih(e,t,n=!1){let i=await nn(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return is._forOperation(e,"link",i)}async function iu(e,t,n=!1){let{auth:i}=e;if(tc(i.app))return Promise.reject(tM(i));let r="reauthenticate";try{let s=await nn(e,il(i,r,t,e),n);tF(s.idToken,i,"internal-error");let o=ne(s.idToken);tF(o,i,"internal-error");let{sub:a}=o;return tF(e.uid===a,i,"user-mismatch"),is._forOperation(e,r,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&tx(i,"user-mismatch"),e}}async function ic(e,t,n=!1){if(tc(e.app))return Promise.reject(tM(e));let i="signIn",r=await il(e,i,t),s=await is._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}async function id(e,t){return ic(eV(e),t)}async function ip(e){let t=eV(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function ig(e,t,n){if(tc(e.app))return Promise.reject(tM(e));let i=eV(e),r=nj(i,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ir,"EMAIL_PASSWORD_PROVIDER"),s=await r.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&ip(e),t}),o=await is._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(o.user),o}function im(e,t){return tY(e,"POST","/v2/accounts/mfaEnrollment:start",tQ(e,t))}new WeakMap;const iy="__sak";class i_{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(iy,"1"),this.storage.removeItem(iy),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class iv extends i_{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let n=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);(function(){let e=ef();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0})()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}iv.type="LOCAL";class iw extends i_{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}iw.type="SESSION";class ib{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new ib(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function iE(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ib.receivers=[];class iI{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=iE("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(h),clearTimeout(i),a(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function iT(){return window}function iC(){return void 0!==iT().WorkerGlobalScope&&"function"==typeof iT().importScripts}async function iS(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}const ik="firebaseLocalStorageDb",iA="firebaseLocalStorage",iN="fbase_key";class iR{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function iP(e,t){return e.transaction([iA],t?"readwrite":"readonly").objectStore(iA)}function iD(){let e=indexedDB.open(ik,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(iA,{keyPath:iN})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(iA)?t(n):(n.close(),await new iR(indexedDB.deleteDatabase(ik)).toPromise(),t(await iD()))})})}async function ix(e,t,n){return new iR(iP(e,!0).put({[iN]:t,value:n})).toPromise()}async function iO(e,t){let n=iP(e,!1).get(t),i=await new iR(n).toPromise();return void 0===i?null:i.value}function iL(e,t){return new iR(iP(e,!0).delete(t)).toPromise()}class iM{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await iD()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return iC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ib._getInstance(iC()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await iS(),!this.activeServiceWorker)return;this.sender=new iI(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null==(e=n[0])?void 0:e.fulfilled)&&(null==(t=n[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await iD();return await ix(e,iy,"1"),await iL(e,iy),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ix(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>iO(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>iL(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new iR(iP(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function iU(e,t){return tY(e,"POST","/v2/accounts/mfaSignIn:start",tQ(e,t))}iM.type="LOCAL",nL("rcb"),new t$(3e4,6e4);const iF="recaptcha";async function iV(e,t,n){var i;if(!e._getRecaptchaConfig())try{await nq(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){let t=r.session;if("phoneNumber"in r){tF("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===nF){tF((null==n?void 0:n.type)===iF,e,"argument-error");let i=await iB(e,t,n);return im(e,i)}return im(e,t)},o=nj(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{tF("signin"===t.type,e,"internal-error");let s=(null==(i=r.multiFactorHint)?void 0:i.uid)||r.multiFactorUid;tF(s,e,"missing-multi-factor-info");let o={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===nF){tF((null==n?void 0:n.type)===iF,e,"argument-error");let i=await iB(e,t,n);return iU(e,i)}return iU(e,t)},l=nj(e,o,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await l.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===nF){tF((null==n?void 0:n.type)===iF,e,"argument-error");let i=await iB(e,t,n);return nZ(e,i)}return nZ(e,t)},s=nj(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==n||n._reset()}}async function iB(e,t,n){tF(n.type===iF,e,"argument-error");let i=await n.verify();tF("string"==typeof i,e,"argument-error");let r=Object.assign({},t);if("phoneEnrollmentInfo"in r){let e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if(!("phoneSignInInfo"in r))return Object.assign(r,{recaptchaToken:i}),r;{let e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}}class ij{constructor(e){this.providerId=ij.PROVIDER_ID,this.auth=eV(e)}verifyPhoneNumber(e,t){return iV(this.auth,e,eV(t))}static credential(e,t){return n3._fromVerification(e,t)}static credentialFromResult(e){return ij.credentialFromTaggedObject(e)}static credentialFromError(e){return ij.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?n3._fromTokenResponse(t,n):null}}ij.PROVIDER_ID="phone",ij.PHONE_SIGN_IN_METHOD="phone";class iq extends nH{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nJ(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nJ(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nJ(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function i$(e){return ic(e.auth,new iq(e),e.bypassAuthState)}function iz(e){let{auth:t,user:n}=e;return tF(n,t,"internal-error"),iu(n,new iq(e),e.bypassAuthState)}async function iH(e){let{auth:t,user:n}=e;return tF(n,t,"internal-error"),ih(n,new iq(e),e.bypassAuthState)}class iW{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return i$;case"linkViaPopup":case"linkViaRedirect":return iH;case"reauthViaPopup":case"reauthViaRedirect":return iz;default:tx(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tV(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tV(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const iK=new t$(2e3,1e4);class iG extends iW{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,iG.currentPopupAction&&iG.currentPopupAction.cancel(),iG.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return tF(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||tV(t);let n=iE();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tO(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(tO(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,iG.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null==(n=null==(t=this.authWindow)?void 0:t.window)?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tO(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,iK.get())};e()}}iG.currentPopupAction=null;const iQ=new Map;class iY extends iW{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=iQ.get(this.auth._key());if(!e){try{let t=await iJ(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}iQ.set(this.auth._key(),e)}return this.bypassAuthState||iQ.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function iJ(e,t){var n;let i=nm("pendingRedirect",(n=t).config.apiKey,n.name),r=np(e._redirectPersistence);if(!await r._isAvailable())return!1;let s=await r._get(i)==="true";return await r._remove(i),s}function iX(e,t){iQ.set(e._key(),t)}async function iZ(e,t,n=!1){if(tc(e.app))return Promise.reject(tM(e));let i=eV(e),r=t?np(t):(tF(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver),s=new iY(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class i0{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return i2(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!i2(e)){let i=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error";t.onError(tO(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(i1(e))}saveEventToCache(e){this.cachedEventUids.add(i1(e)),this.lastProcessedEventTime=Date.now()}}function i1(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function i2({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function i6(e,t={}){return tY(e,"GET","/v1/projects",t)}const i3=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i5=/^https?/;async function i4(e){if(e.config.emulator)return;let{authorizedDomains:t}=await i6(e);for(let e of t)try{if(function(e){let t=tj(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!i5.test(n))return!1;if(i3.test(e))return i===e;let r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}(e))return}catch(e){}tx(e,"unauthorized-domain")}const i8=new t$(3e4,6e4);function i7(){let e=iT().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let i9=null;const re=new t$(5e3,15e3),rt={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},rn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function ri(e){let t=await (i9=i9||new Promise((t,n)=>{var i,r,s,o;function a(){i7(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{i7(),n(tO(e,"network-request-failed"))},timeout:i8.get()})}if(null==(r=null==(i=iT().gapi)?void 0:i.iframes)?void 0:r.Iframe)t(gapi.iframes.getContext());else if(null==(s=iT().gapi)?void 0:s.load)a();else{let t=nL("iframefcb");return iT()[t]=()=>{gapi.load?a():n(tO(e,"network-request-failed"))},(o=`${nO.gapiScript}?onload=${t}`,nO.loadJS(o)).catch(e=>n(e))}}).catch(e=>{throw i9=null,e})),n=iT().gapi;return tF(n,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;tF(t.authDomain,e,"auth-domain-config-required");let n=t.emulator?tz(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:tp},r=rn.get(e.config.apiHost);r&&(i.eid=r);let s=e._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${eP(i).slice(1)}`}(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rt,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=tO(e,"network-request-failed"),s=iT().setTimeout(()=>{i(r)},re.get());function o(){iT().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})}))}const rr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class rs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const ro=encodeURIComponent("fac");async function ra(e,t,n,i,r,s){tF(e.config.authDomain,e,"auth-domain-config-required"),tF(e.config.apiKey,e,"invalid-api-key");let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:tp,eventId:r};if(t instanceof n8)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",ek(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))o[n]=i;if(t instanceof n7){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}for(let t of(e.tenantId&&(o.tid=e.tenantId),Object.keys(o)))void 0===o[t]&&delete o[t];let a=await e._getAppCheckToken(),l=a?`#${ro}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?tz(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${eP(o).slice(1)}${l}`}const rl="webStorageSupport",rh=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iw,this._completeRedirectFn=iZ,this._overrideRedirectResult=iX}async _openPopup(e,t,n,i){var r,s,o;s=null==(r=this.eventManagers[e._key()])?void 0:r.manager,o="_initialize() not called before _openPopup()",s||tV(o);let a=await ra(e,t,n,tj(),i);return function(e,t,n,i=500,r=600){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",l=Object.assign(Object.assign({},rr),{width:i.toString(),height:r.toString(),top:s,left:o}),h=ef().toLowerCase();n&&(a=nb(h)?"_blank":n),nv(h)&&(t=t||"http://localhost",l.scrollbars="yes");let u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=ef()){var t;return nS(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(h)&&"_self"!==a)return function(e,t){let n=document.createElement("a");n.href=e,n.target=t;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new rs(null);let c=window.open(t||"",a,u);tF(c,e,"popup-blocked");try{c.focus()}catch(e){}return new rs(c)}(e,a,iE())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=await ra(e,t,n,tj(),i),iT().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",i||tV(n),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await ri(e),n=new i0(e);return t.register("authEvent",t=>(tF(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(rl,{type:rl},n=>{var i;let r=null==(i=null==n?void 0:n[0])?void 0:i[rl];void 0!==r&&t(!!r),tx(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=i4(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nk()||nw()||nS()}};class ru{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return tV("unexpected MultiFactorSessionType")}}}class rc extends ru{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new rc(e)}_finalizeEnroll(e,t,n){return tY(e,"POST","/v2/accounts/mfaEnrollment:finalize",tQ(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return tY(e,"POST","/v2/accounts/mfaSignIn:finalize",tQ(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class rd extends ru{constructor(e,t,n){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=n}static _fromSecret(e,t){return new rd(t,void 0,e)}static _fromEnrollmentId(e,t){return new rd(t,e)}async _finalizeEnroll(e,t,n){return tF(void 0!==this.secret,e,"argument-error"),tY(e,"POST","/v2/accounts/mfaEnrollment:finalize",tQ(e,{idToken:t,displayName:n,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}))}async _finalizeSignIn(e,t){tF(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let n={verificationCode:this.otp};return tY(e,"POST","/v2/accounts/mfaSignIn:finalize",tQ(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:n}))}}class rf{constructor(e,t,n,i,r,s,o){this.sessionInfo=s,this.auth=o,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=n,this.codeIntervalSeconds=i,this.enrollmentCompletionDeadline=r}static _fromStartTotpMfaEnrollmentResponse(e,t){return new rf(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var n;let i=!1;return(rp(e)||rp(t))&&(i=!0),i&&(rp(e)&&(e=(null==(n=this.auth.currentUser)?void 0:n.email)||"unknownuser"),rp(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function rp(e){return void 0===e||(null==e?void 0:e.length)===0}var rg="@firebase/auth",rm="1.10.4";class ry{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tF(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const r_=es("authIdTokenMaxAge")||300;let rv=null;const rw=e=>async t=>{let n=t&&await t.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>r_)return;let r=null==n?void 0:n.token;rv!==r&&(rv=r,await fetch(e,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};nO={loadJS:e=>new Promise((t,n)=>{var i,r;let s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{let t=tO("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(null!=(r=null==(i=document.getElementsByTagName("head"))?void 0:i[0])?r:document).appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},m="Browser",th(new eB("auth",(e,{options:t})=>{let n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;tF(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});let a=new nD(n,i,r,{apiKey:s,authDomain:o,clientPlatform:m,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nA(m)}),l=(null==t?void 0:t.persistence)||[],h=(Array.isArray(l)?l:[l]).map(np);return(null==t?void 0:t.errorMap)&&a._updateErrorMap(t.errorMap),a._initializeWithPersistence(h,null==t?void 0:t.popupRedirectResolver),a},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),th(new eB("auth-internal",e=>new ry(eV(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),ty(rg,rm,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(m)),ty(rg,rm,"esm2017");var rb={},rE=rb={};function rI(){throw Error("setTimeout has not been defined")}function rT(){throw Error("clearTimeout has not been defined")}try{v="function"==typeof setTimeout?setTimeout:rI}catch(e){v=rI}try{w="function"==typeof clearTimeout?clearTimeout:rT}catch(e){w=rT}function rC(e){if(v===setTimeout)return setTimeout(e,0);if((v===rI||!v)&&setTimeout)return v=setTimeout,setTimeout(e,0);try{return v(e,0)}catch(t){try{return v.call(null,e,0)}catch(t){return v.call(this,e,0)}}}var rS=[],rk=!1,rA=-1;function rN(){rk&&b&&(rk=!1,b.length?rS=b.concat(rS):rA=-1,rS.length&&rR())}function rR(){if(!rk){var e=rC(rN);rk=!0;for(var t=rS.length;t;){for(b=rS,rS=[];++rA<t;)b&&b[rA].run();rA=-1,t=rS.length}b=null,rk=!1,function(e){if(w===clearTimeout)return clearTimeout(e);if((w===rT||!w)&&clearTimeout)return w=clearTimeout,clearTimeout(e);try{w(e)}catch(t){try{return w.call(null,e)}catch(t){return w.call(this,e)}}}(e)}}function rP(e,t){this.fun=e,this.array=t}function rD(){}rE.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];rS.push(new rP(e,t)),1!==rS.length||rk||rC(rR)},rP.prototype.run=function(){this.fun.apply(null,this.array)},rE.title="browser",rE.browser=!0,rE.env={},rE.argv=[],rE.version="",rE.versions={},rE.on=rD,rE.addListener=rD,rE.once=rD,rE.off=rD,rE.removeListener=rD,rE.removeAllListeners=rD,rE.emit=rD,rE.prependListener=rD,rE.prependOnceListener=rD,rE.listeners=function(e){return[]},rE.binding=function(e){throw Error("process.binding is not supported")},rE.cwd=function(){return"/"},rE.chdir=function(e){throw Error("process.chdir is not supported")},rE.umask=function(){return 0};const rx="@firebase/database",rO="1.0.17";let rL="";class rM{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),eb(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:ew(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class rU{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return eC(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const rF=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new rM(t)}}catch(e){}return new rU},rV=rF("localStorage"),rB=rF("sessionStorage"),rj=new eQ("@firebase/database"),rq=(f=1,function(){return f++}),r$=function(e){let t=eU(e),n=new eO;n.update(t);let i=n.digest();return K.encodeByteArray(i)},rz=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=rz.apply(null,i):"object"==typeof i?t+=eb(i):t+=i,t+=" "}return t};let rH=null,rW=!0;const rK=function(e,t){$(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(rj.logLevel=_.VERBOSE,rH=rj.log.bind(rj),t&&rB.set("logging_enabled",!0)):"function"==typeof e?rH=e:(rH=null,rB.remove("logging_enabled"))},rG=function(...e){if(!0===rW&&(rW=!1,null===rH&&!0===rB.get("logging_enabled")&&rK(!0)),rH){let t=rz.apply(null,e);rH(t)}},rQ=function(e){return function(...t){rG(e,...t)}},rY=function(...e){let t="FIREBASE INTERNAL ERROR: "+rz(...e);rj.error(t)},rJ=function(...e){let t=`FIREBASE FATAL ERROR: ${rz(...e)}`;throw rj.error(t),Error(t)},rX=function(...e){let t="FIREBASE WARNING: "+rz(...e);rj.warn(t)},rZ=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&rX("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},r0=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},r1=function(e){if(em()||"complete"===document.readyState)e();else{let t=!1,n=function(){if(!document.body)return void setTimeout(n,Math.floor(10));t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},r2="[MIN_NAME]",r6="[MAX_NAME]",r3=function(e,t){if(e===t)return 0;{if(e===r2||t===r6)return -1;if(t===r2||e===r6)return 1;let n=sn(e),i=sn(t);if(null!==n)if(null!==i)return n-i==0?e.length-t.length:n-i;else return -1;return null!==i?1:e<t?-1:1}},r5=function(e,t){return e===t?0:e<t?-1:1},r4=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+eb(t))},r8=function(e){if("object"!=typeof e||null===e)return eb(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=eb(t[i]),n+=":",n+=r8(e[t[i]]);return n+"}"},r7=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function r9(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}const se=function(e){let t,n,i,r,s;$(!r0(e),"Invalid JSON number");0===e?(n=0,i=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},st=RegExp("^-?(0*)\\d{1,10}$"),sn=function(e){if(st.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},si=function(e){try{e()}catch(e){setTimeout(()=>{throw rX("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},sr=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class ss{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,tc(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){rX(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class so{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(rG("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',rX(e)}}class sa{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}sa.OWNER="owner";const sl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,sh="websocket",su="long_polling";class sc{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=rV.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&rV.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function sd(e,t,n){let i;if($("string"==typeof t,"typeof type must == string"),$("object"==typeof n,"typeof params must == object"),t===sh)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===su)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return r9(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class sf{constructor(){this.counters_={}}incrementCounter(e,t=1){eC(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,this.counters_)}}const sp={},sg={};function sm(e){let t=e.toString();return sp[t]||(sp[t]=new sf),sp[t]}class sy{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&si(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const s_="start";class sv{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=rQ(e),this.stats_=sm(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),sd(t,su,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new sy(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),r1(()=>{if(this.isClosed_)return;this.scriptTagHolder=new sw((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===s_)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[s_]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&sl.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){sv.forceAllow_=!0}static forceDisallow(){sv.forceDisallow_=!0}static isAvailable(){return!em()&&(!!sv.forceAllow_||!sv.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=eb(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=r7(Q(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(em())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=eb(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class sw{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,em())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=rq(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=sw.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');let i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){rG("frame writing exception"),e.stack&&rG(e.stack),rG(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||rG("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){em()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{rG("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let sb=null;"undefined"!=typeof MozWebSocket?sb=MozWebSocket:"undefined"!=typeof WebSocket&&(sb=WebSocket);class sE{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=rQ(this.connId),this.stats_=sm(t),this.connURL=sE.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!em()&&"undefined"!=typeof location&&location.hostname&&sl.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),sd(e,sh,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,rV.set("previous_websocket_failure",!0);try{let e;if(em()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${rL}/${rb.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n={},i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new sb(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){sE.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==sb&&!sE.forceDisallow_}static previouslyFailed(){return rV.isInMemoryStorage||!0===rV.get("previous_websocket_failure")}markConnectionHealthy(){rV.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=ew(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if($(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=eb(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=r7(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}sE.responsesRequiredToBeHealthy=2,sE.healthyTimeout=3e4;class sI{static get ALL_TRANSPORTS(){return[sv,sE]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=sE&&sE.isAvailable(),n=t&&!sE.previouslyFailed();if(e.webSocketOnly&&(t||rX("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[sE];else{let e=this.transports_=[];for(let t of sI.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);sI.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}sI.globalTransportInitialized_=!1;class sT{constructor(e,t,n,i,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=rQ("c:"+this.id+":"),this.transportManager_=new sI(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=sr(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=r4("t",e),n=r4("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=r4("t",e),n=r4("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=r4("t",e);if("d"in e){let n=e.d;if("h"===t){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?rY("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):rY("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&rX("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),sr(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):sr(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(rV.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class sC{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class sS{constructor(e){this.allowedEvents_=e,this.listeners_={},$(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){$(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class sk extends sS{static getInstance(){return new sk}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||ep()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return $("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class sA{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function sN(){return new sA("")}function sR(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function sP(e){return e.pieces_.length-e.pieceNum_}function sD(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new sA(e.pieces_,t)}function sx(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function sO(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function sL(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new sA(t,0)}function sM(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof sA)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new sA(n,0)}function sU(e){return e.pieceNum_>=e.pieces_.length}function sF(e,t){let n=sR(e),i=sR(t);if(null===n)return t;if(n===i)return sF(sD(e),sD(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function sV(e,t){if(sP(e)!==sP(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function sB(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(sP(e)>sP(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class sj{constructor(e,t){this.errorPrefix_=t,this.parts_=sO(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eF(this.parts_[e]);sq(this)}}function sq(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+s$(e))}function s$(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class sz extends sS{static getInstance(){return new sz}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return $("visible"===e,"Unknown event type: "+e),[this.visible_]}}class sH extends sC{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=sH.nextPersistentConnectionId_++,this.log_=rQ("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!em())throw Error("Auth override specified in options, but not supported on non Node.js platforms");sz.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&sk.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(eb(r)),$(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new eo,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),$(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),$(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;sH.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&eC(e,"w")){let n=eS(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();rX(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||eT(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=eI(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),$(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+eb(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):rY("Unrecognized action received from server: "+eb(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){$(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+sH.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){$(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?rG("getToken() completed but was canceled"):(rG("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new sT(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{rX(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&rX(e),a())}}}interrupt(e){rG("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){rG("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ek(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>r8(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n,i=new sA(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){rG("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){rG("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";em()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+rL.replace(/\./g,"-")]=1,ep()?e["framework.cordova"]=1:eg()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=sk.getInstance().currentlyOnline();return ek(this.interruptReasons_)&&e}}sH.nextPersistentConnectionId_=0,sH.nextConnectionId_=0;class sW{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new sW(e,t)}}class sK{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new sW(r2,e),i=new sW(r2,t);return 0!==this.compare(n,i)}minPost(){return sW.MIN}}class sG extends sK{static get __EMPTY_NODE(){return n}static set __EMPTY_NODE(e){n=e}compare(e,t){return r3(e.name,t.name)}isDefinedOn(e){throw z("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return sW.MIN}maxPost(){return new sW(r6,n)}makePost(e,t){return $("string"==typeof e,"KeyIndex indexValue must always be a string."),new sW(e,n)}toString(){return".key"}}const sQ=new sG;class sY{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class sJ{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:sJ.RED,this.left=null!=i?i:sX.EMPTY_NODE,this.right=null!=r?r:sX.EMPTY_NODE}copy(e,t,n,i,r){return new sJ(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return sX.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return sX.EMPTY_NODE;else i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,sJ.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,sJ.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}sJ.RED=!0,sJ.BLACK=!1;class sX{constructor(e,t=sX.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new sX(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,sJ.BLACK,null,null))}remove(e){return new sX(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,sJ.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(i)return i.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new sY(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new sY(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new sY(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new sY(this.root_,null,this.comparator_,!0,e)}}function sZ(e,t){return r3(e.name,t.name)}function s0(e,t){return r3(e,t)}sX.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new sJ(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const s1=function(e){return"number"==typeof e?"number:"+se(e):"string:"+e},s2=function(e){if(e.isLeafNode()){let t=e.val();$("string"==typeof t||"number"==typeof t||"object"==typeof t&&eC(t,".sv"),"Priority must be a string or number.")}else $(e===i||e.isEmpty(),"priority of unexpected type.");$(e===i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class s6{static set __childrenNodeConstructor(e){r=e}static get __childrenNodeConstructor(){return r}constructor(e,t=s6.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,$(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),s2(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new s6(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:s6.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return sU(e)?this:".priority"===sR(e)?this.priorityNode_:s6.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:s6.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=sR(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:($(".priority"!==n||1===sP(e),".priority must be the last token in a path"),this.updateImmediateChild(n,s6.__childrenNodeConstructor.EMPTY_NODE.updateChild(sD(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+s1(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=se(this.value_):e+=this.value_,this.lazyHash_=r$(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===s6.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof s6.__childrenNodeConstructor?-1:($(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=s6.VALUE_TYPE_ORDER.indexOf(t),r=s6.VALUE_TYPE_ORDER.indexOf(n);return($(i>=0,"Unknown leaf type: "+t),$(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}s6.VALUE_TYPE_ORDER=["object","boolean","number","string"];const s3=new class extends sK{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?r3(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return sW.MIN}maxPost(){return new sW(r6,new s6("[PRIORITY-POST]",o))}makePost(e,t){return new sW(t,new s6("[PRIORITY-POST]",s(e)))}toString(){return".priority"}},s5=Math.log(2);class s4{constructor(e){this.count=parseInt(Math.log(e+1)/s5,10),this.current_=this.count-1;let t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}const s8=function(e,t,n,i){e.sort(t);let r=function(t,i){let s,o,a=i-t;if(0===a)return null;if(1===a)return s=e[t],new sJ(n?n(s):s,s.node,sJ.BLACK,null,null);{let o=parseInt(a/2,10)+t,l=r(t,o),h=r(o+1,i);return s=e[o],new sJ(n?n(s):s,s.node,sJ.BLACK,l,h)}};return new sX(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let h=r(s+1,a),u=e[s];l(new sJ(n?n(u):u,u.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,sJ.BLACK):(a(i,sJ.BLACK),a(i,sJ.RED))}return s}(new s4(e.length)))},s7={};class s9{static get Default(){return $(s7&&s3,"ChildrenNode.ts has not been loaded"),a=a||new s9({".priority":s7},{".priority":s3})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eS(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof sX?t:null}hasIndex(e){return eC(this.indexSet_,e.toString())}addIndex(e,t){let n;$(e!==sQ,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(sW.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?s8(i,e.getCompare()):s7;let a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;let h=Object.assign({},this.indexes_);return h[a]=n,new s9(h,l)}addToIndexes(e,t){return new s9(eA(this.indexes_,(n,i)=>{let r=eS(this.indexSet_,i);if($(r,"Missing index implementation for "+i),n===s7)if(!r.isDefinedOn(e.node))return s7;else{let n=[],i=t.getIterator(sW.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),s8(n,r.getCompare())}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new sW(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new s9(eA(this.indexes_,n=>{if(n===s7)return n;{let i=t.get(e.name);return i?n.remove(new sW(e.name,i)):n}}),this.indexSet_)}}class oe{static get EMPTY_NODE(){return l||(l=new oe(new sX(s0),null,s9.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&s2(this.priorityNode_),this.children_.isEmpty()&&$(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||l}updatePriority(e){return this.children_.isEmpty()?this:new oe(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?l:t}}getChild(e){let t=sR(e);return null===t?this:this.getImmediateChild(t).getChild(sD(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if($(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i,r=new sW(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?l:this.priorityNode_;return new oe(n,s,i)}}updateChild(e,t){let n=sR(e);if(null===n)return t;{$(".priority"!==sR(e)||1===sP(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(sD(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(s3,(s,o)=>{t[s]=o.val(e),n++,r&&oe.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+s1(this.getPriority().val())+":"),this.forEachChild(s3,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":r$(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new sW(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new sW(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new sW(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,sW.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,sW.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===ot?-1:0}withIndex(e){if(e===sQ||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new oe(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===sQ||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(s3),n=e.getIterator(s3),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===sQ?null:this.indexMap_.get(e.toString())}}oe.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const ot=new class extends oe{constructor(){super(new sX(s0),oe.EMPTY_NODE,s9.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return oe.EMPTY_NODE}isEmpty(){return!1}};function on(e,t=null){if(null===e)return oe.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),$(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new s6(e,on(t));if(e instanceof Array){let n=oe.EMPTY_NODE;return r9(e,(t,i)=>{if(eC(e,t)&&"."!==t.substring(0,1)){let e=on(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(on(t))}{let n=[],i=!1;if(r9(e,(e,t)=>{if("."!==e.substring(0,1)){let r=on(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new sW(e,r)))}}),0===n.length)return oe.EMPTY_NODE;let r=s8(n,sZ,e=>e.name,s0);if(!i)return new oe(r,on(t),s9.Default);{let e=s8(n,s3.getCompare());return new oe(r,on(t),new s9({".priority":e},{".priority":s3}))}}}Object.defineProperties(sW,{MIN:{value:new sW(r2,oe.EMPTY_NODE)},MAX:{value:new sW(r6,ot)}}),sG.__EMPTY_NODE=oe.EMPTY_NODE,s6.__childrenNodeConstructor=oe,i=ot,o=ot,s=on;class oi extends sK{constructor(e){super(),this.indexPath_=e,$(!sU(e)&&".priority"!==sR(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?r3(e.name,t.name):r}makePost(e,t){let n=on(e);return new sW(t,oe.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new sW(r6,oe.EMPTY_NODE.updateChild(this.indexPath_,ot))}toString(){return sO(this.indexPath_,0).join("/")}}const or=new class extends sK{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?r3(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return sW.MIN}maxPost(){return sW.MAX}makePost(e,t){return new sW(t,on(e))}toString(){return".value"}};function os(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class oo{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=s3}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return $(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return($(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:r2}hasEnd(){return this.endSet_}getIndexEndValue(){return $(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return($(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:r6}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return $(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===s3}copy(){let e=new oo;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function oa(e){let t,n={};if(e.isDefault())return n;if(e.index_===s3?t="$priority":e.index_===or?t="$value":e.index_===sQ?t="$key":($(e.index_ instanceof oi,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=eb(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=eb(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+eb(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=eb(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+eb(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function ol(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==s3&&(t.i=e.index_.toString()),t}class oh extends sC{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:($(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=rQ("p:rest:"),this.listens_={}}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=oh.getListenId_(e,n),o={};this.listens_[s]=o;let a=oa(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),eS(this.listens_,s)===o){let t;i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}})}unlisten(e,t){let n=oh.getListenId_(e,t);delete this.listens_[n]}get(e){let t=oa(e._queryParams),n=e._path.toString(),i=new eo;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+eP(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=ew(o.responseText)}catch(e){rX("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&rX("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class ou{constructor(){this.rootNode_=oe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function oc(){return{value:null,children:new Map}}function od(e,t,n){var i,r;null!==e.value?n(t,e.value):(i=e,r=(e,i)=>{od(i,new sA(t.toString()+"/"+e),n)},i.children.forEach((e,t)=>{r(t,e)}))}class of{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&r9(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class op{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new of(e);let n=1e4+2e4*Math.random();sr(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;r9(e,(e,i)=>{i>0&&eC(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),sr(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function og(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function om(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function oy(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(y=E||(E={}))[y.OVERWRITE=0]="OVERWRITE",y[y.MERGE=1]="MERGE",y[y.ACK_USER_WRITE=2]="ACK_USER_WRITE",y[y.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class o_{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=E.ACK_USER_WRITE,this.source=og()}operationForChild(e){if(!sU(this.path))return $(sR(this.path)===e,"operationForChild called for unrelated child."),new o_(sD(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return $(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new sA(e));return new o_(sN(),t,this.revert)}}}class ov{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=E.OVERWRITE}operationForChild(e){return sU(this.path)?new ov(this.source,sN(),this.snap.getImmediateChild(e)):new ov(this.source,sD(this.path),this.snap)}}class ow{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=E.MERGE}operationForChild(e){if(!sU(this.path))return $(sR(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ow(this.source,sD(this.path),this.children);{let t=this.children.subtree(new sA(e));return t.isEmpty()?null:t.value?new ov(this.source,sN(),t.value):new ow(this.source,sN(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ob{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(sU(e))return this.isFullyInitialized()&&!this.filtered_;let t=sR(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function oE(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw z("Should only compare child_ events.");let i=new sW(t.childName,t.snapshotNode),r=new sW(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{var i,o,a;let l=(i=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,i.index_)),o);r.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(l,e.query_))})})}function oI(e,t){return{eventCache:e,serverCache:t}}function oT(e,t,n,i){return oI(new ob(t,n,i),e.serverCache)}function oC(e,t,n,i){return oI(e.eventCache,new ob(t,n,i))}function oS(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ok(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}const oA=()=>(h||(h=new sX(r5)),h);class oN{static fromObject(e){let t=new oN(null);return r9(e,(e,n)=>{t=t.set(new sA(e),n)}),t}constructor(e,t=oA()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:sN(),value:this.value};{if(sU(e))return null;let n=sR(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(sD(e),t);return null!=r?{path:sM(new sA(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(sU(e))return this;{let t=sR(e),n=this.children.get(t);return null!==n?n.subtree(sD(e)):new oN(null)}}set(e,t){if(sU(e))return new oN(t,this.children);{let n=sR(e),i=(this.children.get(n)||new oN(null)).set(sD(e),t),r=this.children.insert(n,i);return new oN(this.value,r)}}remove(e){if(sU(e))if(this.children.isEmpty())return new oN(null);else return new oN(null,this.children);{let t=sR(e),n=this.children.get(t);if(!n)return this;{let i,r=n.remove(sD(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new oN(null):new oN(this.value,i)}}}get(e){if(sU(e))return this.value;{let t=sR(e),n=this.children.get(t);return n?n.get(sD(e)):null}}setTree(e,t){if(sU(e))return t;{let n,i=sR(e),r=(this.children.get(i)||new oN(null)).setTree(sD(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new oN(this.value,n)}}fold(e){return this.fold_(sN(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(sM(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,sN(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;{if(sU(e))return null;let i=sR(e),r=this.children.get(i);return r?r.findOnPath_(sD(e),sM(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,sN(),t)}foreachOnPath_(e,t,n){if(sU(e))return this;{this.value&&n(t,this.value);let i=sR(e),r=this.children.get(i);return r?r.foreachOnPath_(sD(e),sM(t,i),n):new oN(null)}}foreach(e){this.foreach_(sN(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(sM(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class oR{constructor(e){this.writeTree_=e}static empty(){return new oR(new oN(null))}}function oP(e,t,n){if(sU(t))return new oR(new oN(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=sF(r,t);return s=s.updateChild(o,n),new oR(e.writeTree_.set(r,s))}{let i=new oN(n);return new oR(e.writeTree_.setTree(t,i))}}}function oD(e,t,n){let i=e;return r9(n,(e,n)=>{i=oP(i,sM(t,e),n)}),i}function ox(e,t){return sU(t)?oR.empty():new oR(e.writeTree_.setTree(t,new oN(null)))}function oO(e,t){return null!=oL(e,t)}function oL(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(sF(n.path,t)):null}function oM(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(s3,(e,n)=>{t.push(new sW(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new sW(e,n.value))}),t}function oU(e,t){if(sU(t))return e;{let n=oL(e,t);return new oR(null!=n?new oN(n):e.writeTree_.subtree(t))}}function oF(e){return e.writeTree_.isEmpty()}function oV(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?($(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(sM(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(sM(t,".priority"),r)),i}}(sN(),e.writeTree_,t)}function oB(e){return e.visible}function oj(e,t,n){let i=oR.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e,t=s.path;if(s.snap)sB(n,t)?i=oP(i,e=sF(n,t),s.snap):sB(t,n)&&(e=sF(t,n),i=oP(i,sN(),s.snap.getChild(e)));else if(s.children){if(sB(n,t))i=oD(i,e=sF(n,t),s.children);else if(sB(t,n))if(sU(e=sF(t,n)))i=oD(i,sN(),s.children);else{let t=eS(s.children,sR(e));if(t){let n=t.getChild(sD(e));i=oP(i,sN(),n)}}}else throw z("WriteRecord should have .snap or .children")}}return i}function oq(e,t,n,i,r){if(i||r){let s=oU(e.visibleWrites,t);return!r&&oF(s)?n:r||null!=n||oO(s,sN())?oV(oj(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(sB(e.path,t)||sB(t,e.path))},t),n||oe.EMPTY_NODE):null}{let i=oL(e.visibleWrites,t);if(null!=i)return i;{let i=oU(e.visibleWrites,t);return oF(i)?n:null!=n||oO(i,sN())?oV(i,n||oe.EMPTY_NODE):null}}}function o$(e,t,n,i){return oq(e.writeTree,e.treePath,t,n,i)}function oz(e,t){return function(e,t,n){let i=oe.EMPTY_NODE,r=oL(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(s3,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return oM(oU(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=oU(e.visibleWrites,t);return n.forEachChild(s3,(e,t)=>{let n=oV(oU(r,new sA(e)),t);i=i.updateImmediateChild(e,n)}),oM(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function oH(e,t,n,i){return function(e,t,n,i,r){$(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=sM(t,n);if(oO(e.visibleWrites,s))return null;{let t=oU(e.visibleWrites,s);return oF(t)?r.getChild(n):oV(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function oW(e,t){var n,i;return n=e.writeTree,i=sM(e.treePath,t),oL(n.visibleWrites,i)}function oK(e,t,n){return function(e,t,n,i){let r=sM(t,n),s=oL(e.visibleWrites,r);return null!=s?s:i.isCompleteForChild(n)?oV(oU(e.visibleWrites,r),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function oG(e,t){return oQ(sM(e.treePath,t),e.writeTree)}function oQ(e,t){return{treePath:e,writeTree:t}}class oY{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;$("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),$(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,os(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,{type:"child_removed",snapshotNode:i.oldSnap,childName:n});else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,{type:"child_added",snapshotNode:e.snapshotNode,childName:n});else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,os(n,e.snapshotNode,i.oldSnap));else throw z("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const oJ=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class oX{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new ob(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return oK(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ok(this.viewCache_),s=(i=this.writes_,function(e,t,n,i,r,s,o){let a,l=oU(e.visibleWrites,t),h=oL(l,sN());if(null!=h)a=h;else{if(null==n)return[];a=oV(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}(i.writeTree,i.treePath,r,t,1,n,e));return 0===s.length?null:s[0]}}function oZ(e,t,n,i,r,s){let o=t.eventCache;if(null!=oW(i,n))return t;{let a,l;if(sU(n))if($(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=ok(t),r=oz(i,n instanceof oe?n:oe.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=o$(i,ok(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=sR(n);if(".priority"===h){$(1===sP(n),"Can't have a priority with additional path components");let r=o.getNode(),s=oH(i,n,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let u,c=sD(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=oH(i,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=oK(i,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,r,s):o.getNode()}}return oT(t,a,o.isFullyInitialized()||sU(n),e.filter.filtersNodes())}}function o0(e,t,n,i,r,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(sU(n))l=u.updateFullNode(h.getNode(),i,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=u.updateFullNode(h.getNode(),e,null)}else{let e=sR(n);if(!h.isCompleteForPath(n)&&sP(n)>1)return t;let r=sD(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,r,oJ,null)}let c=oC(t,l,h.isFullyInitialized()||sU(n),u.filtersNodes()),d=new oX(r,c,s);return oZ(e,c,n,r,d,a)}function o1(e,t,n,i,r,s,o){let a,l,h=t.eventCache,u=new oX(r,t,s);if(sU(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=oT(t,l,!0,e.filter.filtersNodes());else{let r=sR(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),a=oT(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=sD(n),c=h.getNode().getImmediateChild(r);if(sU(l))s=i;else{let e=u.getCompleteChild(r);s=null!=e?".priority"===sx(l)&&e.getChild(sL(l)).isEmpty()?e:e.updateChild(l,i):oe.EMPTY_NODE}a=c.equals(s)?t:oT(t,e.filter.updateChild(h.getNode(),r,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function o2(e,t){return e.eventCache.isCompleteForChild(t)}function o6(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function o3(e,t,n,i,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=sU(n)?i:new oN(null).setTree(n,i);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){let l=o6(e,t.serverCache.getNode().getImmediateChild(n),i);h=o0(e,h,new sA(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){let l=o6(e,t.serverCache.getNode().getImmediateChild(n),i);h=o0(e,h,new sA(n),l,r,s,o,a)}}),h}function o5(e,t,n,i){var r,s;t.type===E.MERGE&&null!==t.source.queryId&&($(ok(e.viewCache_),"We should always have a full cache before handling merges"),$(oS(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){let s,o,a=new oY;if(n.type===E.OVERWRITE)n.source.fromUser?s=o1(e,t,n.path,n.snap,i,r,a):($(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered()&&!sU(n.path),s=o0(e,t,n.path,n.snap,i,r,o,a));else if(n.type===E.MERGE){var l,h,u,c,d,f,p;let g;n.source.fromUser?(l=e,h=t,u=n.path,c=n.children,d=i,f=r,p=a,g=h,c.foreach((e,t)=>{let n=sM(u,e);o2(h,sR(n))&&(g=o1(l,g,n,t,d,f,p))}),c.foreach((e,t)=>{let n=sM(u,e);o2(h,sR(n))||(g=o1(l,g,n,t,d,f,p))}),s=g):($(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered(),s=o3(e,t,n.path,n.children,i,r,o,a))}else if(n.type===E.ACK_USER_WRITE)s=n.revert?function(e,t,n,i,r,s){let o;if(null!=oW(i,n))return t;{let a,l=new oX(i,t,r),h=t.eventCache.getNode();if(sU(n)||".priority"===sR(n)){let n;if(t.serverCache.isFullyInitialized())n=o$(i,ok(t));else{let e=t.serverCache.getNode();$(e instanceof oe,"serverChildren would be complete if leaf node"),n=oz(i,e)}a=e.filter.updateFullNode(h,n,s)}else{let r=sR(n),u=oK(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=h.getImmediateChild(r)),(a=null!=u?e.filter.updateChild(h,r,u,sD(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,oe.EMPTY_NODE,sD(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=o$(i,ok(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=oW(i,sN()),oT(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,a):function(e,t,n,i,r,s,o){if(null!=oW(r,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value)if(sU(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return o0(e,t,n,l.getNode().getChild(n),r,s,a,o);else{if(!sU(n))return t;let i=new oN(null);return l.getNode().forEachChild(sQ,(e,t)=>{i=i.set(new sA(e),t)}),o3(e,t,n,i,r,s,a,o)}{let h=new oN(null);return i.foreach((e,t)=>{let i=sM(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),o3(e,t,n,h,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,a);else if(n.type===E.LISTEN_COMPLETE)s=function(e,t,n,i,r){let s=t.serverCache;return oZ(e,oC(t,s.getNode(),s.isFullyInitialized()||sU(n),s.isFiltered()),n,i,oJ,r)}(e,t,n.path,i,a);else throw z("Unknown operation type: "+n.type);let g=a.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=oS(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push({type:"value",snapshotNode:oS(t)})}}(t,s,g),{viewCache:s,changes:g}}(e.processor_,o,t,n,i);return r=e.processor_,$((s=a.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),$(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),$(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,function(e,t,n,i){let r=(0,e.eventRegistrations_);var s=e.eventGenerator_;let o=[],a=[];return t.forEach(e=>{var t;"child_changed"===e.type&&s.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&a.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),oE(s,o,"child_removed",t,r,n),oE(s,o,"child_added",t,r,n),oE(s,o,"child_moved",a,r,n),oE(s,o,"child_changed",t,r,n),oE(s,o,"value",t,r,n),o}(e,a.changes,a.viewCache.eventCache.getNode(),null)}function o4(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return $(null!=s,"SyncTree gave us an op for an invalid query."),o5(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(o5(s,t,n,i));return r}}function o8(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=ok(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!sU(t)&&!n.getImmediateChild(sR(t)).isEmpty())?n.getChild(t):null}(i,t);return n}class o7{constructor(e){this.listenProvider_=e,this.syncPointTree_=new oN(null),this.pendingWriteTree_={visibleWrites:oR.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function o9(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let i=e.allWrites.findIndex(e=>e.writeId===t);$(i>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[i];e.allWrites.splice(i,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=i&&function(e,t){if(e.snap)return sB(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&sB(sM(e.path,n),t))return!0;return!1}(t,r.path)?s=!1:sB(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=oj(n.allWrites,oB,sN()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):r.snap?e.visibleWrites=ox(e.visibleWrites,r.path):r9(r.children,t=>{e.visibleWrites=ox(e.visibleWrites,sM(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new oN(null);return null!=i.snap?t=t.set(sN(),!0):r9(i.children,e=>{t=t.set(new sA(e),!0)}),an(e,new o_(i.path,t,n))}}function ae(e,t,n){return an(e,new ov(om(),t,n))}function at(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=o8(n,sF(e,t));if(i)return i});return oq(i,t,r,n,!0)}function an(e,t){var n;return function e(t,n,i,r){if(sU(t.path))return function e(t,n,i,r){let s=n.get(sN());null==i&&null!=s&&(i=o8(s,sN()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,l=oG(r,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(o4(s,t,r,i))),o}(t,n,i,r);{let s=n.get(sN());null==i&&null!=s&&(i=o8(s,sN()));let o=[],a=sR(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=i?i.getImmediateChild(a):null,n=oG(r,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(o4(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,oQ(sN(),n)))}function ai(e,t){return e.tagToQueryMap.get(t)}function ar(e){let t=e.indexOf("$");return $(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new sA(e.substr(0,t))}}function as(e,t,n){let i=e.syncPointTree_.get(t);return $(i,"Missing sync point for query tag that we're tracking"),o4(i,n,oQ(t,e.pendingWriteTree_),null)}class ao{constructor(e){this.node_=e}getImmediateChild(e){return new ao(this.node_.getImmediateChild(e))}node(){return this.node_}}class aa{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=sM(this.path_,e);return new aa(this.syncTree_,t)}node(){return at(this.syncTree_,this.path_)}}const al=function(e,t,n){return e&&"object"==typeof e?($(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?ah(e[".sv"],t,n):"object"==typeof e[".sv"]?au(e[".sv"],t):void $(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},ah=function(e,t,n){if("timestamp"===e)return n.timestamp;$(!1,"Unexpected server value: "+e)},au=function(e,t,n){e.hasOwnProperty("increment")||$(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&$(!1,"Unexpected increment value: "+i);let r=t.node();if($(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i};function ac(e,t,n){let i,r=al(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new s6(r))),e.forEachChild(s3,(e,r)=>{let s=ac(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=al(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new s6(i,on(r)):e}}class ad{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function af(e,t){let n=t instanceof sA?t:new sA(t),i=e,r=sR(n);for(;null!==r;){let e=eS(i.node.children,r)||{children:{},childCount:0};i=new ad(r,i,e),r=sR(n=sD(n))}return i}function ap(e){return e.node.value}function ag(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===ap(i)&&!am(i),s=eC(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function am(e){return e.node.childCount>0}function ay(e,t){r9(e.node.children,(n,i)=>{t(new ad(n,e,i))})}function a_(e){return new sA(null===e.parent?e.name:a_(e.parent)+"/"+e.name)}const av=/[\[\].#$\/\u0000-\u001F\u007F]/,aw=/[\[\].#$\u0000-\u001F\u007F]/,ab=function(e){return"string"==typeof e&&0!==e.length&&!av.test(e)},aE=function(e){var t;return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),"string"==typeof(t=e)&&0!==t.length&&!aw.test(t)},aI=function(e,t,n){let i=n instanceof sA?new sj(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+s$(i));if("function"==typeof t)throw Error(e+"contains a function "+s$(i)+" with contents = "+t.toString());if(r0(t))throw Error(e+"contains "+t.toString()+" "+s$(i));if("string"==typeof t&&t.length>0xa00000/3&&eF(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+s$(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(r9(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!ab(t)))throw Error(e+" contains an invalid key ("+t+") "+s$(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=eF(t),sq(i),aI(e,s,i);let o=i.parts_.pop();i.byteLength_-=eF(o),i.parts_.length>0&&(i.byteLength_-=1)}),n&&r)throw Error(e+' contains ".value" child '+s$(i)+" in addition to actual children.")}},aT=function(e,t){let n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!ab(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!aE(n))throw Error(`${e} failed: url argument must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class aC{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function aS(e,t,n){let i=null;for(let t=0;t<n.length;t++){let r=n[t],s=r.getPath();null===i||sV(s,i.path)||(e.eventLists_.push(i),i=null),null===i&&(i={events:[],path:s}),i.events.push(r)}i&&e.eventLists_.push(i),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();rH&&rG("event: "+n.toString()),si(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>sB(e,t)||sB(t,e))}class ak{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new aC,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=oc(),this.transactionQueueTree_=new ad,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function aA(e){var t;return(t=t={timestamp:function(e){let t=e.infoData_.getNode(new sA(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}(e)}).timestamp=t.timestamp||new Date().getTime(),t}function aN(e,t,n,i,r){e.dataUpdateCount++;let s=new sA(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){let t=eA(n,e=>on(e));o=function(e,t,n,i){let r=ai(e,i);if(!r)return[];{let i=ar(r),s=i.path,o=i.queryId,a=sF(s,t),l=oN.fromObject(n);return as(e,s,new ow(oy(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=on(n);o=function(e,t,n,i){let r=ai(e,i);if(null==r)return[];{let i=ar(r),s=i.path,o=i.queryId,a=sF(s,t);return as(e,s,new ov(oy(o),a,n))}}(e.serverSyncTree_,s,t,r)}else if(i){let t=eA(n,e=>on(e));o=function(e,t,n){let i=oN.fromObject(n);return an(e,new ow(om(),t,i))}(e.serverSyncTree_,s,t)}else{let t=on(n);o=ae(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=aO(e,s)),aS(e.eventQueue_,a,o)}function aR(e,t){aP(e,"connected",t),!1===t&&function(e){aD(e,"onDisconnectEvents");let t=aA(e),n=oc();od(e.onDisconnect_,sN(),(i,r)=>{var s;let o=(s=e.serverSyncTree_,ac(r,new aa(s,i),t));!function e(t,n,i){if(sU(n))t.value=i,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,i);else{let r=sR(n);t.children.has(r)||t.children.set(r,oc()),e(t.children.get(r),n=sD(n),i)}}(n,i,o)});let i=[];od(n,sN(),(t,n)=>{i=i.concat(ae(e.serverSyncTree_,t,n));let r=function(e,t){let n=a_(aL(e,t)),i=af(e.transactionQueueTree_,t);return!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{aF(e,t)}),aF(e,i),!function e(t,n,i,r){i&&!r&&n(t),ay(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{aF(e,t)}),n}(e,t);aO(e,r)}),e.onDisconnect_=oc(),aS(e.eventQueue_,sN(),i)}(e)}function aP(e,t,n){let i=new sA("/.info/"+t),r=on(n);e.infoData_.updateSnapshot(i,r);let s=ae(e.infoSyncTree_,i,r);aS(e.eventQueue_,i,s)}function aD(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),rG(n,...t)}function ax(e,t,n){return at(e.serverSyncTree_,t,n)||oe.EMPTY_NODE}function aO(e,t){let n=aL(e,t),i=a_(n),r=aM(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=sF(n,a.path),h=!1,u;if($(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,r=r.concat(o9(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",r=r.concat(o9(e.serverSyncTree_,a.currentWriteId,!0));else{let n=ax(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){aI("transaction failed: Data returned ",i,a.path);let t=on(i);"object"==typeof i&&null!=i&&eC(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=aA(e),h=ac(t,new ao(n),l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=h,a.currentWriteId=e.nextWriteId_++,s.splice(s.indexOf(o),1),r=(r=r.concat(function(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,$(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=oP(s.visibleWrites,t,n)),s.lastWriteId=i,r)?an(e,new ov(og(),t,n)):[]}(e.serverSyncTree_,a.path,h,a.currentWriteId,a.applyLocally))).concat(o9(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",r=r.concat(o9(e.serverSyncTree_,a.currentWriteId,!0))}aS(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(u),!1,null))))}aU(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)si(i[e]);!function e(t,n=t.transactionQueueTree_){if(n||aU(t,n),ap(n)){let i=aM(t,n);$(i.length>0,"Sending zero length transaction queue"),i.every(e=>0===e.status)&&function(t,n,i){let r=ax(t,n,i.map(e=>e.currentWriteId)),s=r,o=r.hash();for(let e=0;e<i.length;e++){let t=i[e];$(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=sF(n,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,r=>{aD(t,"transaction put response",{path:n.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<i.length;e++)i[e].status=2,s=s.concat(o9(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&r.push(()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved)),i[e].unwatcher();aU(t,af(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),aS(t.eventQueue_,n,s);for(let e=0;e<r.length;e++)si(r[e])}else{if("datastale"===r)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{rX("transaction at "+n.toString()+" failed: "+r);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=r}aO(t,n)}},o)}(t,a_(n),i)}else am(n)&&ay(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,r,i),i}function aL(e,t){let n,i=e.transactionQueueTree_;for(n=sR(t);null!==n&&void 0===ap(i);)i=af(i,n),n=sR(t=sD(t));return i}function aM(e,t){let n=[];return function e(t,n,i){let r=ap(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);ay(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function aU(e,t){let n=ap(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,ag(t,n.length>0?n:void 0)}ay(t,t=>{aU(e,t)})}function aF(e,t){let n=ap(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?($(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):($(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(o9(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?ag(t,void 0):n.length=s+1,aS(e.eventQueue_,a_(t),r);for(let e=0;e<i.length;e++)si(i[e])}}const aV=function(e,t){let n=aB(e),i=n.namespace;"firebase.com"===n.domain&&rJ(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||rJ("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||rZ();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new sc(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new sA(n.pathString)}},aB=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):rX(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class aj{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return sU(this._path)?null:sx(this._path)}get ref(){return new aq(this._repo,this._path)}get _queryIdentifier(){let e=r8(ol(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return ol(this._queryParams)}isEqual(e){if(!((e=eV(e))instanceof aj))return!1;let t=this._repo===e._repo,n=sV(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class aq extends aj{constructor(e,t){super(e,t,new oo,!1)}get parent(){let e=sL(this._path);return null===e?null:new aq(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}$(!u,"__referenceConstructor has already been defined"),u=aq,$(!c,"__referenceConstructor has already been defined"),c=aq;const a$={};class az{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){if(e.stats_=sm(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new oh(e.repoInfo_,(t,n,i,r)=>{aN(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>aR(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{eb(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new sH(e.repoInfo_,t,(t,n,i,r)=>{aN(e,t,n,i,r)},t=>{aR(e,t)},t=>{var n;n=e,r9(t,(e,t)=>{aP(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){let n=e.toString();return sg[n]||(sg[n]=t()),sg[n]}(e.repoInfo_,()=>new op(e.stats_,e.server_)),e.infoData_=new ou,e.infoSyncTree_=new o7({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=ae(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),aP(e,"connected",!1),e.serverSyncTree_=new o7({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);aS(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0,ed("Database",null!==this._repo.repoInfo_.emulatorOptions)),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new aq(this._repo,sN())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){let n=a$[t];n&&n[e.key]===e||rJ(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&rJ("Cannot call "+e+" on a deleted database.")}}sH.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},sH.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},rL=tp,th(new eB("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate();return function(e,t,n,i,r){var s,o,a,l;let h,u,c,d,f=i||e.options.databaseURL;void 0===f&&(e.options.projectId||rJ("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),rG("Using default host for project ",e.options.projectId),f=`${e.options.projectId}-default-rtdb.firebaseio.com`);let p=aV(f,void 0),g=p.repoInfo;c?(d=!0,g=(p=aV(f=`http://${c}?ns=${g.namespace}`,void 0)).repoInfo):d=!p.repoInfo.secure;let m=r&&d?new sa(sa.OWNER):new so(e.name,e.options,t);return aT("Invalid Firebase Database URL",p),sU(p.path)||rJ("Database URL must point to the root of a Firebase Database (not including a child path)."),new az((s=g,o=e,a=m,l=new ss(e,n),(h=a$[o.name])||(h={},a$[o.name]=h),(u=h[s.toURLString()])&&rJ("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new ak(s,!1,a,l),h[s.toURLString()]=u,u),e)}(n,e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),ty(rx,rO,void 0),ty(rx,rO,"esm2017");var aH="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==B?B:"undefined"!=typeof self?self:{},aW={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function n(){}function i(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var s=e.g[3],o=t+(s^n&(r^s))+i[0]+0xd76aa478|0;o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[1]+0xe8c7b756|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[2]+0x242070db|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[3]+0xc1bdceee|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[4]+0xf57c0faf|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[5]+0x4787c62a|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[6]+0xa8304613|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[7]+0xfd469501|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[8]+0x698098d8|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[9]+0x8b44f7af|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[10]+0xffff5bb1|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[11]+0x895cd7be|0,o=t+(s^(n=r+(o<<22|o>>>10))&(r^s))+i[12]+0x6b901122|0,o=s+(r^(t=n+(o<<7|o>>>25))&(n^r))+i[13]+0xfd987193|0,o=r+(n^(s=t+(o<<12|o>>>20))&(t^n))+i[14]+0xa679438e|0,o=n+(t^(r=s+(o<<17|o>>>15))&(s^t))+i[15]+0x49b40821|0,n=r+(o<<22|o>>>10),o=t+(r^s&(n^r))+i[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[11]+0x265e5a51|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[0]+0xe9b6c7aa|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[15]+0xd8a1e681|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[4]+0xe7d3fbc8|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[3]+0xf4d50d87|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[8]+0x455a14ed|0,n=r+(o<<20|o>>>12),o=t+(r^s&(n^r))+i[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^r&(t^n))+i[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=r+(t^n&(s^t))+i[7]+0x676f02d9|0,r=s+(o<<14|o>>>18),o=n+(s^t&(r^s))+i[12]+0x8d2a4c8a|0,o=t+((n=r+(o<<20|o>>>12))^r^s)+i[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[8]+0x8771f681|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[11]+0x6d9d6122|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[14]+0xfde5380c|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[4]+0x4bdecfa9|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[7]+0xf6bb4b60|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[10]+0xbebfbc70|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[0]+0xeaa127fa|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[3]+0xd4ef3085|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[6]+0x4881d05|0,o=t+((n=r+(o<<23|o>>>9))^r^s)+i[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^r)+i[12]+0xe6db99e5|0,o=r+((s=t+(o<<11|o>>>21))^t^n)+i[15]+0x1fa27cf8|0,o=n+((r=s+(o<<16|o>>>16))^s^t)+i[2]+0xc4ac5665|0,n=r+(o<<23|o>>>9),o=t+(r^(n|~s))+i[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[14]+0xab9423a7|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[5]+0xfc93a039|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[10]+0xffeff47d|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[1]+0x85845dd1|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[6]+0xa3014314|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[13]+0x4e0811a1|0,n=r+(o<<21|o>>>11),o=t+(r^(n|~s))+i[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~r))+i[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=r+(t^(s|~n))+i[2]+0x2ad7d2bb|0,r=s+(o<<15|o>>>17),o=n+(s^(r|~t))+i[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(r+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+r|0,e.g[3]=e.g[3]+s|0}function r(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=n;)i(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(r[s++]=e.charCodeAt(o++),s==this.blockSize){i(this,r),s=0;break}}else for(;o<t;)if(r[s++]=e[o++],s==this.blockSize){i(this,r),s=0;break}}this.h=s,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var s,o={};function a(e){var t;return -128<=e&&128>e?(t=function(e){return new r([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(o,e)?o[e]:o[e]=t(e)):new r([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(0>e)return p(l(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=0x100000000;return new r(t,0)}var h=a(0),u=a(1),c=a(0x1000000);function d(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(u)}function g(e,t){return e.add(p(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function _(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(h,h);if(f(e))return t=_(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=_(e,p(t)),new y(p(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,i=t;0>=i.l(e);)n=v(n),i=v(i);var r=w(n,1),s=w(i,1);for(i=w(i,2),n=w(n,2);!d(i);){var o=s.add(i);0>=o.l(e)&&(r=r.add(n),s=o),i=w(i,1),n=w(n,1)}return t=g(e,r.j(t)),new y(r,t)}for(r=h;0<=e.l(t);){for(i=48>=(i=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,i-48),o=(s=l(n)).j(t);f(o)||0<o.l(e);)n-=i,o=(s=l(n)).j(t);d(s)&&(s=u),r=r.add(s),e=g(e,o)}return new y(r,e)}function v(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function w(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],o=0;o<i;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(s,e.h)}(s=r.prototype).m=function(){if(f(this))return-p(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:0x100000000+i)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);for(var t=l(Math.pow(e,6)),n=this,i="";;){var r=_(n,t).g,s=((0<(n=g(n,r.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(d(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=g(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?p(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var o=i+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return h;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var o=this.i(i)>>>16,a=65535&this.i(i),u=e.i(s)>>>16,g=65535&e.i(s);n[2*i+2*s]+=a*g,m(n,2*i+2*s),n[2*i+2*s+1]+=o*g,m(n,2*i+2*s+1),n[2*i+2*s+1]+=a*u,m(n,2*i+2*s+1),n[2*i+2*s+2]+=o*u,m(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},s.A=function(e){return _(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,T=aW.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=l,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=l(Math.pow(n,8)),r=h,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=l(Math.pow(n,o)),r=r.j(o).add(l(a))):r=(r=r.j(i)).add(l(a))}return r},I=aW.Integer=r}).apply(void 0!==aH?aH:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var aK="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==B?B:"undefined"!=typeof self?self:{},aG={};(function(){var e,t,n,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof aK&&aK];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in n))break e;n=n[o]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,i,r;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,i=!1,(r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return r},r}});var s=s||{},o=this||self;function a(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function l(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function h(e,t,n){return e.call.apply(e.bind,arguments)}function u(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?h:u).apply(null,arguments)}function d(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function f(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function p(e){let t=e.length;if(0<t){let n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function g(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(a(n)){let t=e.length||0,i=n.length||0;e.length=t+i;for(let r=0;r<i;r++)e[t+r]=n[r]}else e.push(n)}}function m(e){return/^[\s\xa0]*$/.test(e)}function y(){var e=o.navigator;return e&&(e=e.userAgent)?e:""}function _(e){return _[" "](e),e}_[" "]=function(){};var v=-1!=y().indexOf("Gecko")&&(-1==y().toLowerCase().indexOf("webkit")||-1!=y().indexOf("Edge"))&&-1==y().indexOf("Trident")&&-1==y().indexOf("MSIE")&&-1==y().indexOf("Edge");function w(e,t,n){for(let i in e)t.call(n,e[i],i,e)}function b(e){let t={};for(let n in e)t[n]=e[n];return t}let E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t])e[n]=i[n];for(let t=0;t<E.length;t++)n=E[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}var T=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new x,e=>e.reset());class x{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let O,L=!1,M=new class{constructor(){this.h=this.g=null}add(e,t){let n=T.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},U=()=>{let e=o.Promise.resolve(void 0);O=()=>{e.then(F)}};var F=()=>{let e;for(var t;e=null,M.g&&(e=M.g,M.g=M.g.next,M.g||(M.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){o.setTimeout(()=>{throw e},0)}(e)}T.j(t),100>T.h&&(T.h++,t.next=T.g,T.g=t)}L=!1};function V(){this.s=this.s,this.C=this.C}function B(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}V.prototype.s=!1,V.prototype.ma=function(){this.s||(this.s=!0,this.N())},V.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},B.prototype.h=function(){this.defaultPrevented=!0};var j=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(e){}return e}();function q(e,t){if(B.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(v){e:{try{_(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:$[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&q.aa.h.call(this)}}f(q,B);var $={2:"touch",3:"pen",4:"mouse"};q.prototype.h=function(){q.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var z="closure_listenable_"+(1e6*Math.random()|0),H=0;function W(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=r,this.key=++H,this.da=this.fa=!1}function K(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function G(e){this.src=e,this.g={},this.h=0}function Q(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=Array.prototype.indexOf.call(r,t,void 0);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(K(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Y(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==i)return r}return -1}G.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Y(e,t,i,r);return -1<o?(t=e[o],n||(t.fa=!1)):((t=new W(t,this.src,s,!!i,r)).fa=n,e.push(t)),t};var J="closure_lm_"+(1e6*Math.random()|0),X={};function Z(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var o=l(r)?!!r.capture:!!r,a=ei(e);if(a||(e[J]=a=new G(e)),(n=a.add(t,n,i,o,s)).proxy)return n;if(i=function e(t){return en.call(e.src,e.listener,t)},n.proxy=i,i.src=e,i.listener=n,e.addEventListener)j||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(et(t.toString()),i);else if(e.addListener&&e.removeListener)e.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ee(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[z])Q(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(et(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=ei(t))?(Q(n,e),0==n.h&&(n.src=null,t[J]=null)):K(e)}}}function et(e){return e in X?X[e]:X[e]="on"+e}function en(e,t){if(e.da)e=!0;else{t=new q(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&ee(e),e=n.call(i,t)}return e}function ei(e){return(e=e[J])instanceof G?e:null}var er="__closure_events_fn_"+(1e9*Math.random()>>>0);function es(e){return"function"==typeof e?e:(e[er]||(e[er]=function(t){return e.handleEvent(t)}),e[er])}function eo(){V.call(this),this.i=new G(this),this.M=this,this.F=null}function ea(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new B(t,e);else if(t instanceof B)t.target=t.target||e;else{var r=t;I(t=new B(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=el(o,i,!0,t)&&r}if(r=el(o=t.g=e,i,!0,t)&&r,r=el(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=el(o=t.g=n[s],i,!1,t)&&r}function el(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,l=o.ha||o.src;o.fa&&Q(e.i,o),r=!1!==a.call(l,i)&&r}}return r&&!i.defaultPrevented}function eh(e,t,n){if("function"==typeof e)n&&(e=c(e,n));else if(e&&"function"==typeof e.handleEvent)e=c(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:o.setTimeout(e,t||0)}f(eo,V),eo.prototype[z]=!0,eo.prototype.removeEventListener=function(e,t,n,i){!function e(t,n,i,r,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);else(r=l(r)?!!r.capture:!!r,i=es(i),t&&t[z])?(t=t.i,(n=String(n).toString())in t.g&&-1<(i=Y(o=t.g[n],i,r,s))&&(K(o[i]),Array.prototype.splice.call(o,i,1),0==o.length&&(delete t.g[n],t.h--))):t&&(t=ei(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Y(n,i,r,s)),(i=-1<t?n[t]:null)&&ee(i))}(this,e,t,n,i)},eo.prototype.N=function(){if(eo.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)K(n[i]);delete t.g[e],t.h--}}this.F=null},eo.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},eo.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class eu extends V{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eh(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ec(e){V.call(this),this.h=e,this.g={}}f(ec,V);var ed=[];function ef(e){w(e.g,function(e,t){this.g.hasOwnProperty(t)&&ee(e)},e),e.g={}}ec.prototype.N=function(){ec.aa.N.call(this),ef(this)},ec.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ep=o.JSON.stringify,eg=o.JSON.parse,em=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function ey(){}function e_(e){return e.h||(e.h=e.i())}function ev(){}ey.prototype.h=null;var ew={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eb(){B.call(this,"d")}function eE(){B.call(this,"c")}f(eb,B),f(eE,B);var eI={},eT=null;function eC(){return eT=eT||new eo}function eS(e){B.call(this,eI.La,e)}function ek(e){let t=eC();ea(t,new eS(t))}function eA(e,t){B.call(this,eI.STAT_EVENT,e),this.stat=t}function eN(e){let t=eC();ea(t,new eA(t,e))}function eR(e,t){B.call(this,eI.Ma,e),this.size=t}function eP(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){e()},t)}function eD(){this.g=!0}function ex(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}}return ep(n)}catch(e){return t}}(e,n)+(i?" "+i:"")})}eI.La="serverreachability",f(eS,B),eI.STAT_EVENT="statevent",f(eA,B),eI.Ma="timingevent",f(eR,B),eD.prototype.xa=function(){this.g=!1},eD.prototype.info=function(){};var eO={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eL={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eM(){}function eU(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new ec(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eF}function eF(){this.i=null,this.g="",this.h=!1}f(eM,ey),eM.prototype.g=function(){return new XMLHttpRequest},eM.prototype.i=function(){return{}},t=new eM;var eV={},eB={};function ej(e,t,n){e.L=1,e.v=tn(e8(t)),e.m=n,e.P=!0,eq(e,null)}function eq(e,t){e.F=Date.now(),ez(e),e.A=e8(e.v);var n,i,r,s,o,a,h=e.A,u=e.R;Array.isArray(u)||(u=[String(u)]),tg(h.i,"t",u),e.C=0,h=e.j.J,e.h=new eF,e.g=t1(e.j,h?t:null,!e.m),0<e.O&&(e.M=new eu(c(e.Y,e,e.g),e.O)),t=e.U,h=e.g,u=e.ca;var d="readystatechange";Array.isArray(d)||(d&&(ed[0]=d.toString()),d=ed);for(var f=0;f<d.length;f++){var p=function e(t,n,i,r,s){if(r&&r.once)return function e(t,n,i,r,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);return null}return i=es(i),t&&t[z]?t.L(n,i,l(r)?!!r.capture:!!r,s):Z(t,n,i,!0,r,s)}(t,n,i,r,s);if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);return null}return i=es(i),t&&t[z]?t.K(n,i,l(r)?!!r.capture:!!r,s):Z(t,n,i,!1,r,s)}(h,d[f],u||t.handleEvent,!1,t.h||t);if(!p)break;t.g[p.key]=p}t=e.H?b(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),ek(),n=e.i,i=e.u,r=e.A,s=e.l,o=e.R,a=e.m,n.info(function(){if(n.g)if(a)for(var e="",t=a.split("&"),l=0;l<t.length;l++){var h=t[l].split("=");if(1<h.length){var u=h[0];h=h[1];var c=u.split("_");e=2<=c.length&&"type"==c[1]?e+(u+"=")+h+"&":e+(u+"=redacted&")}}else e=null;else e=a;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+i+"\n"+r+"\n"+e})}function e$(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function ez(e){e.S=Date.now()+e.I,eH(e,e.I)}function eH(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eP(c(e.ba,e),t)}function eW(e){e.B&&(o.clearTimeout(e.B),e.B=null)}function eK(e){0==e.j.G||e.J||tY(e.j,e)}function eG(e){eW(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ef(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eQ(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e0(n.h,e))){if(!e.K&&e0(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tQ(n),tV(n);else break e;tW(n),eN(18)}}else n.za=r[1],0<n.za-n.T&&37500>r[2]&&n.F&&0==n.v&&!n.C&&(n.C=eP(c(n.Za,n),6e3));if(1>=eZ(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else tX(n,11)}else if((e.K||n.g==e)&&tQ(n),!m(t))for(r=n.Da.g.parse(t),t=0;t<r.length;t++){let a=r[t];if(n.T=a[0],a=a[1],2==n.G)if("c"==a[0]){n.K=a[1],n.ia=a[2];let t=a[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let r=a[4];null!=r&&(n.Aa=r,n.j.info("SVER="+n.Aa));let l=a[5];null!=l&&"number"==typeof l&&0<l&&(n.L=i=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e1(s,s.h),s.h=null))}if(i.D){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,tt(i.I,i.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(i=n).qa=t0(i,i.J?i.ia:null,i.W),e.K){e2(i.h,e);var o=i.L;o&&(e.I=o),e.B&&(eW(e),ez(e)),i.g=e}else tH(i);0<n.i.length&&tj(n)}else"stop"!=a[0]&&"close"!=a[0]||tX(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?tX(n,7):tF(n):"noop"!=a[0]&&n.l&&n.l.ta(a),n.v=0)}}ek(4)}catch(e){}}eU.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tO(e)?t.j():this.Y(e)},eU.prototype.Y=function(e){try{if(e==this.g)e:{let v=tO(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tL(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?ek(3):ek(2)),eW(this);var n=this.g.Z();this.X=n;t:if(e$(this)){var i=tL(this.g);e="";var r=i.length,s=4==tO(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eG(this),eK(this);var a="";break t}this.h.i=new o.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(s&&t==r-1)});i.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,l=this.i,h=this.u,u=this.A,c=this.l,d=this.R,f=n,l.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+d+"]: "+h+"\n"+u+"\n"+v+" "+f}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,h,u,c,d,f,p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(p)){var y=p;break t}}y=null}if(n=y)ex(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eQ(this,n);else{this.o=!1,this.s=3,eN(12),eG(this),eK(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;)if((e=function(e,t){var n=e.C,i=t.indexOf("\n",n);return -1==i?eB:isNaN(n=Number(t.substring(n,i)))?eV:(i+=1)+n>t.length?eB:(t=t.slice(i,i+n),e.C=i+n,t)}(this,a))==eB){4==v&&(this.s=4,eN(14),n=!1),ex(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eV){this.s=4,eN(15),ex(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}else ex(this.i,this.l,e,null),eQ(this,e);if(e$(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=a.length||this.h.h||(this.s=1,eN(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var _=this.j;_.g==this&&_.ba&&!_.M&&(_.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tK(_),_.M=!0,eN(11))}}else ex(this.i,this.l,a,"[Invalid Chunked Response]"),eG(this),eK(this)}else ex(this.i,this.l,a,null),eQ(this,a);4==v&&eG(this),this.o&&!this.J&&(4==v?tY(this.j,this):(this.o=!1,ez(this)))}else(function(e){let t={};e=(e.g&&2<=tO(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(m(e[i]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[i]);let r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[r]||[];t[r]=s,s.push(n)}var i=function(e){return e.join(", ")};for(let e in t)i.call(void 0,t[e],e,t)})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,eN(12)):(this.s=0,eN(13)),eG(this),eK(this)}}}catch(e){}finally{}},eU.prototype.cancel=function(){this.J=!0,eG(this)},eU.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(ek(),eN(17)),eG(this),this.s=2,eK(this)):eH(this,this.S-n)};var eY=class{constructor(e,t){this.g=e,this.map=t}};function eJ(e){this.l=e||10,e=o.PerformanceNavigationTiming?0<(e=o.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eX(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eZ(e){return e.h?1:e.g?e.g.size:0}function e0(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e1(e,t){e.g?e.g.add(t):e.h=t}function e2(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e6(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return p(e.i)}function e3(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(a(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(a(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let i in t=[],n=0,e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(a(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}eJ.prototype.cancel=function(){if(this.i=e6(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e5=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e4(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e4){this.h=e.h,e7(this,e.j),this.o=e.o,this.g=e.g,e9(this,e.s),this.l=e.l;var t=e.i,n=new tc;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),te(this,n),this.m=e.m}else e&&(t=String(e).match(e5))?(this.h=!1,e7(this,t[1]||"",!0),this.o=ti(t[2]||""),this.g=ti(t[3]||"",!0),e9(this,t[4]),this.l=ti(t[5]||"",!0),te(this,t[6]||"",!0),this.m=ti(t[7]||"")):(this.h=!1,this.i=new tc(null,this.h))}function e8(e){return new e4(e)}function e7(e,t,n){e.j=n?ti(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e9(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function te(e,t,n){var i,r;t instanceof tc?(e.i=t,i=e.i,(r=e.h)&&!i.j&&(td(i),i.i=null,i.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tf(this,t),tg(this,n,e))},i)),i.j=r):(n||(t=tr(t,th)),e.i=new tc(t,e.h))}function tt(e,t,n){e.i.set(t,n)}function tn(e){return tt(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ti(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ts),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ts(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e4.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tr(t,to,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(tr(t,to,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tr(n,"/"==n.charAt(0)?tl:ta,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",tr(n,tu)),e.join("")};var to=/[#\/\?@]/g,ta=/[#\?:]/g,tl=/[#\?]/g,th=/[#\?@]/g,tu=/#/g;function tc(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function td(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tf(e,t){td(e),t=tm(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tp(e,t){return td(e),t=tm(e,t),e.g.has(t)}function tg(e,t,n){tf(e,t),0<n.length&&(e.i=null,e.g.set(tm(e,t),p(n)),e.h+=n.length)}function tm(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function ty(e,t,n,i,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),i(n)}catch(e){}}function t_(){this.g=new em}function tv(e){this.l=e.Ub||null,this.j=e.eb||!1}function tw(e,t){eo.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tb(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tE(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tI(e)}function tI(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tT(e){let t="";return w(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tC(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=tT(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tt(e,t,n))}function tS(e){eo.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=tc.prototype).add=function(e,t){td(this),this.i=null,e=tm(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){td(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},n.na=function(){td(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){let r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},n.V=function(e){td(this);let t=[];if("string"==typeof e)tp(this,e)&&(t=t.concat(this.g.get(tm(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return td(this),this.i=null,tp(this,e=tm(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];let s=encodeURIComponent(String(i)),o=this.V(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),e.push(r)}}return this.i=e.join("&")},f(tv,ey),tv.prototype.g=function(){return new tw(this.l,this.j)},tv.prototype.i=(e={},function(){return e}),f(tw,eo),(n=tw.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tI(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||o).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tE(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tI(this)),this.g&&(this.readyState=3,tI(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tb(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tE(this):tI(this),3==this.readyState&&tb(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tE(this))},n.Qa=function(e){this.g&&(this.response=e,tE(this))},n.ga=function(){this.g&&tE(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tw.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),f(tS,eo);var tk=/^https?$/i,tA=["POST","PUT"];function tN(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tR(e),tD(e)}function tR(e){e.A||(e.A=!0,ea(e,"complete"),ea(e,"error"))}function tP(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tO(e)||2!=e.Z())){if(e.u&&4==tO(e))eh(e.Ea,0,e);else if(ea(e,"readystatechange"),4==tO(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,i=!0;break;default:i=!1}if(!(t=i)){if(n=0===s){var r=String(e.D).match(e5)[1]||null;!r&&o.self&&o.self.location&&(r=o.self.location.protocol.slice(0,-1)),n=!tk.test(r?r.toLowerCase():"")}t=n}if(t)ea(e,"complete"),ea(e,"success");else{e.m=6;try{var a=2<tO(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",tR(e)}}finally{tD(e)}}}}function tD(e,t){if(e.g){tx(e);let n=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ea(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function tx(e){e.I&&(o.clearTimeout(e.I),e.I=null)}function tO(e){return e.g?e.g.readyState:0}function tL(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tM(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tU(e){this.Aa=0,this.i=[],this.j=new eD,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tM("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tM("baseRetryDelayMs",5e3,e),this.cb=tM("retryDelaySeedMs",1e4,e),this.Wa=tM("forwardChannelMaxRetries",2,e),this.wa=tM("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eJ(e&&e.concurrentRequestLimit),this.Da=new t_,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tF(e){if(tB(e),3==e.G){var t=e.U++,n=e8(e.I);if(tt(n,"SID",e.K),tt(n,"RID",t),tt(n,"TYPE","terminate"),t$(e,n),(t=new eU(e,e.j,t)).L=2,t.v=tn(e8(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&o.Image&&((new Image).src=t.v,n=!0),n||(t.g=t1(t.j,null),t.g.ea(t.v)),t.F=Date.now(),ez(t)}tZ(e)}function tV(e){e.g&&(tK(e),e.g.cancel(),e.g=null)}function tB(e){tV(e),e.u&&(o.clearTimeout(e.u),e.u=null),tQ(e),e.h.cancel(),e.s&&("number"==typeof e.s&&o.clearTimeout(e.s),e.s=null)}function tj(e){if(!eX(e.h)&&!e.s){e.s=!0;var t=e.Ga;O||U(),L||(O(),L=!0),M.add(t,e),e.B=0}}function tq(e,t){var n;n=t?t.l:e.U++;let i=e8(e.I);tt(i,"SID",e.K),tt(i,"RID",n),tt(i,"AID",e.T),t$(e,i),e.m&&e.o&&tC(i,e.m,e.o),n=new eU(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tz(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e1(e.h,n),ej(n,i,t)}function t$(e,t){e.H&&w(e.H,function(e,n){tt(t,n,e)}),e.l&&e3({},function(e,n){tt(t,n,e)})}function tz(e,t,n){n=Math.min(e.i.length,n);var i=e.l?c(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=r[o].g,a=r[o].map;if(0>(n-=t))t=Math.max(0,r[o].g-100),s=!1;else try{!function(e,t,n){let i=n||"";try{e3(e,function(e,n){let r=e;l(e)&&(r=ep(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(s){i=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),i}function tH(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;O||U(),L||(O(),L=!0),M.add(t,e),e.v=0}}function tW(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eP(c(e.Fa,e),tJ(e,e.v)),e.v++,!0)}function tK(e){null!=e.A&&(o.clearTimeout(e.A),e.A=null)}function tG(e){e.g=new eU(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e8(e.qa);tt(t,"RID","rpc"),tt(t,"SID",e.K),tt(t,"AID",e.T),tt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tt(t,"TO",e.ja),tt(t,"TYPE","xmlhttp"),t$(e,t),e.m&&e.o&&tC(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=tn(e8(t)),n.m=null,n.P=!0,eq(n,e)}function tQ(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function tY(e,t){var n,i=null;if(e.g==t){tQ(e),tK(e),e.g=null;var r=2}else{if(!e0(e.h,t))return;i=t.D,e2(e.h,t),r=1}if(0!=e.G){if(t.o)if(1==r){i=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;ea(r=eC(),new eR(r,i)),tj(e)}else tH(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==r&&(n=t,!(eZ(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eP(c(e.Ga,e,n),tJ(e,e.B)),e.B++,!0)))||2==r&&tW(e)))switch(i&&0<i.length&&((t=e.h).i=t.i.concat(i)),s){case 1:tX(e,5);break;case 4:tX(e,10);break;case 3:tX(e,6);break;default:tX(e,2)}}}function tJ(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function tX(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),i=e.Xa;let t=!i;i=new e4(i||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||e7(i,"https"),tn(i),t?function(e,t){let n=new eD;if(o.Image){let i=new Image;i.onload=d(ty,n,"TestLoadImage: loaded",!0,t,i),i.onerror=d(ty,n,"TestLoadImage: error",!1,t,i),i.onabort=d(ty,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=d(ty,n,"TestLoadImage: timeout",!1,t,i),o.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){let n=new eD,i=new AbortController,r=setTimeout(()=>{i.abort(),ty(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:i.signal}).then(e=>{clearTimeout(r),e.ok?ty(n,"TestPingServer: ok",!0,t):ty(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(r),ty(n,"TestPingServer: error",!1,t)})}(i.toString(),n)}else eN(2);e.G=0,e.l&&e.l.sa(t),tZ(e),tB(e)}function tZ(e){if(e.G=0,e.ka=[],e.l){let t=e6(e.h);(0!=t.length||0!=e.i.length)&&(g(e.ka,t),g(e.ka,e.i),e.h.i.length=0,p(e.i),e.i.length=0),e.l.ra()}}function t0(e,t,n){var i=n instanceof e4?e8(n):new e4(n);if(""!=i.g)t&&(i.g=t+"."+i.g),e9(i,i.s);else{var r=o.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new e4(null);i&&e7(s,i),t&&(s.g=t),r&&e9(s,r),n&&(s.l=n),i=s}return n=e.D,t=e.ya,n&&t&&tt(i,n,t),tt(i,"VER",e.la),t$(e,i),i}function t1(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tS(e.Ca&&!e.pa?new tv({eb:n}):e.pa)).Ha(e.J),t}function t2(){}function t6(){}function t3(e,t){eo.call(this),this.g=new tU(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t8(this)}function t5(e){eb.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t4(){eE.call(this),this.status=1}function t8(e){this.g=e}(n=tS.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,i,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?e_(this.o):e_(t),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tN(this,e);return}if(e=i||"",i=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)i.set(s,r[s]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())i.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r));for(let[t,a]of(r=Array.from(i.keys()).find(e=>"content-type"==e.toLowerCase()),s=o.FormData&&e instanceof o.FormData,!(0<=Array.prototype.indexOf.call(tA,n,void 0))||r||s||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i))this.g.setRequestHeader(t,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tx(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tN(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ea(this,"complete"),ea(this,"abort"),tD(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tD(this,!0)),tS.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tP(this):this.bb())},n.bb=function(){tP(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tO(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eg(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tU.prototype).la=8,n.G=1,n.connect=function(e,t,n,i){eN(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=t0(this,null,this.W),tj(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let r=new eU(this,this.j,e),s=this.o;if(this.S&&(s?I(s=b(s),this.S):s=this.S),null!==this.m||this.O||(r.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var i=this.i[n];if("__data__"in i.map&&"string"==typeof(i=i.map.__data__)){i=i.length;break t}i=void 0}if(void 0===i)break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tz(this,r,t),tt(n=e8(this.I),"RID",e),tt(n,"CVER",22),this.D&&tt(n,"X-HTTP-Session-Id",this.D),t$(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tT(s)))+"&"+t:this.m&&tC(n,this.m,s)),e1(this.h,r),this.Ua&&tt(n,"TYPE","init"),this.P?(tt(n,"$req",t),tt(n,"SID","null"),r.T=!0,ej(r,n,null)):ej(r,n,t),this.G=2}}else 3==this.G&&(e?tq(this,e):0==this.i.length||eX(this.h)||tq(this))},n.Fa=function(){if(this.u=null,tG(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eP(c(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eN(10),tV(this),tG(this))},n.Za=function(){null!=this.C&&(this.C=null,tV(this),tW(this),eN(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eN(2)):(this.j.info("Failed to ping google.com"),eN(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t2.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t6.prototype.g=function(e,t){return new t3(e,t)},f(t3,eo),t3.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t3.prototype.close=function(){tF(this.g)},t3.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ep(e),e=n);t.i.push(new eY(t.Ya++,e)),3==t.G&&tj(t)},t3.prototype.N=function(){this.g.l=null,delete this.j,tF(this.g),delete this.g,t3.aa.N.call(this)},f(t5,eb),f(t4,eE),f(t8,t2),t8.prototype.ua=function(){ea(this.g,"a")},t8.prototype.ta=function(e){ea(this.g,new t5(e))},t8.prototype.sa=function(e){ea(this.g,new t4)},t8.prototype.ra=function(){ea(this.g,"b")},t6.prototype.createWebChannel=t6.prototype.g,t3.prototype.send=t3.prototype.o,t3.prototype.open=t3.prototype.m,t3.prototype.close=t3.prototype.close,D=aG.createWebChannelTransport=function(){return new t6},P=aG.getStatEventTarget=function(){return eC()},R=aG.Event=eI,N=aG.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eO.NO_ERROR=0,eO.TIMEOUT=8,eO.HTTP_ERROR=6,A=aG.ErrorCode=eO,eL.COMPLETE="complete",k=aG.EventType=eL,ev.EventType=ew,ew.OPEN="a",ew.CLOSE="b",ew.ERROR="c",ew.MESSAGE="d",eo.prototype.listen=eo.prototype.K,S=aG.WebChannel=ev,aG.FetchXmlHttpFactory=tv,tS.prototype.listenOnce=tS.prototype.L,tS.prototype.getLastError=tS.prototype.Ka,tS.prototype.getLastErrorCode=tS.prototype.Ba,tS.prototype.getStatus=tS.prototype.Z,tS.prototype.getResponseJson=tS.prototype.Oa,tS.prototype.getResponseText=tS.prototype.oa,tS.prototype.send=tS.prototype.ea,tS.prototype.setWithCredentials=tS.prototype.Ha,C=aG.XhrIo=tS}).apply(void 0!==aK?aK:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),x=function(e){for(var t,n=e.length,i=n%3,r=[],s=0,o=n-i;s<o;s+=16383)r.push(function(e,t,n){for(var i,r=[],s=t;s<n;s+=3)i=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),r.push(aQ[i>>18&63]+aQ[i>>12&63]+aQ[i>>6&63]+aQ[63&i]);return r.join("")}(e,s,s+16383>o?o:s+16383));return 1===i?r.push(aQ[(t=e[n-1])>>2]+aQ[t<<4&63]+"=="):2===i&&r.push(aQ[(t=(e[n-2]<<8)+e[n-1])>>10]+aQ[t>>4&63]+aQ[t<<2&63]+"="),r.join("")};for(var aQ=[],aY=[],aJ="undefined"!=typeof Uint8Array?Uint8Array:Array,aX="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",aZ=0,a0=aX.length;aZ<a0;++aZ)aQ[aZ]=aX[aZ],aY[aX.charCodeAt(aZ)]=aZ;aY[45]=62,aY[95]=63,O=function(e,t,n,i,r){var s,o,a=8*r-i-1,l=(1<<a)-1,h=l>>1,u=-7,c=n?r-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=256*o+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),s-=h}return(f?-1:1)*o*Math.pow(2,s-i)},L=function(e,t,n,i,r,s){var o,a,l,h=8*s-r-1,u=(1<<h)-1,c=u>>1,d=5960464477539062e-23*(23===r),f=i?0:s-1,p=i?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(a=+!!isNaN(t),o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*l-1)*Math.pow(2,r),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,r),o=0));r>=8;e[n+f]=255&a,f+=p,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;e[n+f]=255&o,f+=p,o/=256,h-=8);e[n+f-p]|=128*g};const a1="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a2(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,a6.prototype),t}function a6(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return a4(e)}return a3(e,t,n)}function a3(e,t,n){if("string"==typeof e){var i=e,r=t;if(("string"!=typeof r||""===r)&&(r="utf8"),!a6.isEncoding(r))throw TypeError("Unknown encoding: "+r);let n=0|le(i,r),s=a2(n),o=s.write(i,r);return o!==n&&(s=s.slice(0,o)),s}if(ArrayBuffer.isView(e)){var s=e;if(lI(s,Uint8Array)){let e=new Uint8Array(s);return a7(e.buffer,e.byteOffset,e.byteLength)}return a8(s)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(lI(e,ArrayBuffer)||e&&lI(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(lI(e,SharedArrayBuffer)||e&&lI(e.buffer,SharedArrayBuffer)))return a7(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return a6.from(o,t,n);let a=function(e){if(a6.isBuffer(e)){let t=0|a9(e.length),n=a2(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a2(0):a8(e):"Buffer"===e.type&&Array.isArray(e.data)?a8(e.data):void 0}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a6.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a5(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function a4(e){return a5(e),a2(e<0?0:0|a9(e))}function a8(e){let t=e.length<0?0:0|a9(e.length),n=a2(t);for(let i=0;i<t;i+=1)n[i]=255&e[i];return n}function a7(e,t,n){let i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),a6.prototype),i}function a9(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function le(e,t){if(a6.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||lI(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return lw(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return lb(e).length;default:if(r)return i?-1:lw(e).length;t=(""+t).toLowerCase(),r=!0}}function lt(e,t,n){let i=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){let i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);let r="";for(let i=t;i<n;++i)r+=lT[e[i]];return r}(this,t,n);case"utf8":case"utf-8":return ls(this,t,n);case"ascii":return function(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}(this,t,n);case"latin1":case"binary":return function(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}(this,t,n);case"base64":var r,s,o;return r=this,s=t,o=n,0===s&&o===r.length?x(r):x(r.slice(s,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){let i=e.slice(t,n),r="";for(let e=0;e<i.length-1;e+=2)r+=String.fromCharCode(i[e]+256*i[e+1]);return r}(this,t,n);default:if(i)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function ln(e,t,n){let i=e[t];e[t]=e[n],e[n]=i}function li(e,t,n,i,r){var s;if(0===e.length)return -1;if("string"==typeof n?(i=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(r)return -1;else n=e.length-1;else if(n<0)if(!r)return -1;else n=0;if("string"==typeof t&&(t=a6.from(t,i)),a6.isBuffer(t))return 0===t.length?-1:lr(e,t,n,i,r);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(r)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return lr(e,[t],n,i,r)}throw TypeError("val must be string, number or Buffer")}function lr(e,t,n,i,r){let s,o=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,n/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){let i=-1;for(s=n;s<a;s++)if(h(e,s)===h(t,-1===i?0:s-i)){if(-1===i&&(i=s),s-i+1===l)return i*o}else -1!==i&&(s-=s-i),i=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){let n=!0;for(let i=0;i<l;i++)if(h(e,s+i)!==h(t,i)){n=!1;break}if(n)return s}return -1}function ls(e,t,n){n=Math.min(e.length,n);let i=[],r=t;for(;r<n;){let t=e[r],s=null,o=t>239?4:t>223?3:t>191?2:1;if(r+o<=n){let n,i,a,l;switch(o){case 1:t<128&&(s=t);break;case 2:(192&(n=e[r+1]))==128&&(l=(31&t)<<6|63&n)>127&&(s=l);break;case 3:n=e[r+1],i=e[r+2],(192&n)==128&&(192&i)==128&&(l=(15&t)<<12|(63&n)<<6|63&i)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:n=e[r+1],i=e[r+2],a=e[r+3],(192&n)==128&&(192&i)==128&&(192&a)==128&&(l=(15&t)<<18|(63&n)<<12|(63&i)<<6|63&a)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),r+=o}var s=i;let o=s.length;if(o<=4096)return String.fromCharCode.apply(String,s);let a="",l=0;for(;l<o;)a+=String.fromCharCode.apply(String,s.slice(l,l+=4096));return a}function lo(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function la(e,t,n,i,r,s){if(!a6.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw RangeError('"value" argument is out of bounds');if(n+i>e.length)throw RangeError("Index out of range")}function ll(e,t,n,i,r){lm(t,i,r,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function lh(e,t,n,i,r){lm(t,i,r,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n+7]=s,s>>=8,e[n+6]=s,s>>=8,e[n+5]=s,s>>=8,e[n+4]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function lu(e,t,n,i,r,s){if(n+i>e.length||n<0)throw RangeError("Index out of range")}function lc(e,t,n,i,r){return t*=1,n>>>=0,r||lu(e,t,n,4,34028234663852886e22,-34028234663852886e22),L(e,t,n,i,23,4),n+4}function ld(e,t,n,i,r){return t*=1,n>>>=0,r||lu(e,t,n,8,17976931348623157e292,-17976931348623157e292),L(e,t,n,i,52,8),n+8}a6.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a6.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a6.prototype,"parent",{enumerable:!0,get:function(){if(a6.isBuffer(this))return this.buffer}}),Object.defineProperty(a6.prototype,"offset",{enumerable:!0,get:function(){if(a6.isBuffer(this))return this.byteOffset}}),a6.poolSize=8192,a6.from=function(e,t,n){return a3(e,t,n)},Object.setPrototypeOf(a6.prototype,Uint8Array.prototype),Object.setPrototypeOf(a6,Uint8Array),a6.alloc=function(e,t,n){return(a5(e),e<=0)?a2(e):void 0!==t?"string"==typeof n?a2(e).fill(t,n):a2(e).fill(t):a2(e)},a6.allocUnsafe=function(e){return a4(e)},a6.allocUnsafeSlow=function(e){return a4(e)},a6.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a6.prototype},a6.compare=function(e,t){if(lI(e,Uint8Array)&&(e=a6.from(e,e.offset,e.byteLength)),lI(t,Uint8Array)&&(t=a6.from(t,t.offset,t.byteLength)),!a6.isBuffer(e)||!a6.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:+(i<n)},a6.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a6.concat=function(e,t){let n;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a6.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;let i=a6.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){let t=e[n];if(lI(t,Uint8Array))r+t.length>i.length?(a6.isBuffer(t)||(t=a6.from(t)),t.copy(i,r)):Uint8Array.prototype.set.call(i,t,r);else if(a6.isBuffer(t))t.copy(i,r);else throw TypeError('"list" argument must be an Array of Buffers');r+=t.length}return i},a6.byteLength=le,a6.prototype._isBuffer=!0,a6.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)ln(this,t,t+1);return this},a6.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)ln(this,t,t+3),ln(this,t+1,t+2);return this},a6.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)ln(this,t,t+7),ln(this,t+1,t+6),ln(this,t+2,t+5),ln(this,t+3,t+4);return this},a6.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?ls(this,0,e):lt.apply(this,arguments)},a6.prototype.toLocaleString=a6.prototype.toString,a6.prototype.equals=function(e){if(!a6.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===a6.compare(this,e)},a6.prototype.inspect=function(){let e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},a1&&(a6.prototype[a1]=a6.prototype.inspect),a6.prototype.compare=function(e,t,n,i,r){if(lI(e,Uint8Array)&&(e=a6.from(e,e.offset,e.byteLength)),!a6.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;let s=r-i,o=n-t,a=Math.min(s,o),l=this.slice(i,r),h=e.slice(t,n);for(let e=0;e<a;++e)if(l[e]!==h[e]){s=l[e],o=h[e];break}return s<o?-1:+(o<s)},a6.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},a6.prototype.indexOf=function(e,t,n){return li(this,e,t,n,!0)},a6.prototype.lastIndexOf=function(e,t,n){return li(this,e,t,n,!1)},a6.prototype.write=function(e,t,n,i){var r,s,o,a,l,h,u,c;if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let f=!1;for(;;)switch(i){case"hex":return function(e,t,n,i){let r;n=Number(n)||0;let s=e.length-n;i?(i=Number(i))>s&&(i=s):i=s;let o=t.length;for(i>o/2&&(i=o/2),r=0;r<i;++r){var a;let i=parseInt(t.substr(2*r,2),16);if((a=i)!=a)break;e[n+r]=i}return r}(this,e,t,n);case"utf8":case"utf-8":return r=t,s=n,lE(lw(e,this.length-r),this,r,s);case"ascii":case"latin1":case"binary":return o=t,a=n,lE(function(e){let t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(e),this,o,a);case"base64":return l=t,h=n,lE(lb(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,lE(function(e,t){let n,i,r=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)i=(n=e.charCodeAt(s))>>8,r.push(n%256),r.push(i);return r}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),f=!0}},a6.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a6.prototype.slice=function(e,t){let n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,a6.prototype),i},a6.prototype.readUintLE=a6.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||lo(e,t,this.length);let i=this[e],r=1,s=0;for(;++s<t&&(r*=256);)i+=this[e+s]*r;return i},a6.prototype.readUintBE=a6.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||lo(e,t,this.length);let i=this[e+--t],r=1;for(;t>0&&(r*=256);)i+=this[e+--t]*r;return i},a6.prototype.readUint8=a6.prototype.readUInt8=function(e,t){return e>>>=0,t||lo(e,1,this.length),this[e]},a6.prototype.readUint16LE=a6.prototype.readUInt16LE=function(e,t){return e>>>=0,t||lo(e,2,this.length),this[e]|this[e+1]<<8},a6.prototype.readUint16BE=a6.prototype.readUInt16BE=function(e,t){return e>>>=0,t||lo(e,2,this.length),this[e]<<8|this[e+1]},a6.prototype.readUint32LE=a6.prototype.readUInt32LE=function(e,t){return e>>>=0,t||lo(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},a6.prototype.readUint32BE=a6.prototype.readUInt32BE=function(e,t){return e>>>=0,t||lo(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a6.prototype.readBigUInt64LE=lC(function(e){ly(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&l_(e,this.length-8);let i=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],r=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*n;return BigInt(i)+(BigInt(r)<<BigInt(32))}),a6.prototype.readBigUInt64BE=lC(function(e){ly(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&l_(e,this.length-8);let i=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],r=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)}),a6.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||lo(e,t,this.length);let i=this[e],r=1,s=0;for(;++s<t&&(r*=256);)i+=this[e+s]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},a6.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||lo(e,t,this.length);let i=t,r=1,s=this[e+--i];for(;i>0&&(r*=256);)s+=this[e+--i]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*t)),s},a6.prototype.readInt8=function(e,t){return(e>>>=0,t||lo(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},a6.prototype.readInt16LE=function(e,t){e>>>=0,t||lo(e,2,this.length);let n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},a6.prototype.readInt16BE=function(e,t){e>>>=0,t||lo(e,2,this.length);let n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},a6.prototype.readInt32LE=function(e,t){return e>>>=0,t||lo(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a6.prototype.readInt32BE=function(e,t){return e>>>=0,t||lo(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a6.prototype.readBigInt64LE=lC(function(e){ly(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&l_(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),a6.prototype.readBigInt64BE=lC(function(e){ly(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&l_(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n)}),a6.prototype.readFloatLE=function(e,t){return e>>>=0,t||lo(e,4,this.length),O(this,e,!0,23,4)},a6.prototype.readFloatBE=function(e,t){return e>>>=0,t||lo(e,4,this.length),O(this,e,!1,23,4)},a6.prototype.readDoubleLE=function(e,t){return e>>>=0,t||lo(e,8,this.length),O(this,e,!0,52,8)},a6.prototype.readDoubleBE=function(e,t){return e>>>=0,t||lo(e,8,this.length),O(this,e,!1,52,8)},a6.prototype.writeUintLE=a6.prototype.writeUIntLE=function(e,t,n,i){if(e*=1,t>>>=0,n>>>=0,!i){let i=Math.pow(2,8*n)-1;la(this,e,t,n,i,0)}let r=1,s=0;for(this[t]=255&e;++s<n&&(r*=256);)this[t+s]=e/r&255;return t+n},a6.prototype.writeUintBE=a6.prototype.writeUIntBE=function(e,t,n,i){if(e*=1,t>>>=0,n>>>=0,!i){let i=Math.pow(2,8*n)-1;la(this,e,t,n,i,0)}let r=n-1,s=1;for(this[t+r]=255&e;--r>=0&&(s*=256);)this[t+r]=e/s&255;return t+n},a6.prototype.writeUint8=a6.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,1,255,0),this[t]=255&e,t+1},a6.prototype.writeUint16LE=a6.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a6.prototype.writeUint16BE=a6.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a6.prototype.writeUint32LE=a6.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a6.prototype.writeUint32BE=a6.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a6.prototype.writeBigUInt64LE=lC(function(e,t=0){return ll(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),a6.prototype.writeBigUInt64BE=lC(function(e,t=0){return lh(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),a6.prototype.writeIntLE=function(e,t,n,i){if(e*=1,t>>>=0,!i){let i=Math.pow(2,8*n-1);la(this,e,t,n,i-1,-i)}let r=0,s=1,o=0;for(this[t]=255&e;++r<n&&(s*=256);)e<0&&0===o&&0!==this[t+r-1]&&(o=1),this[t+r]=(e/s|0)-o&255;return t+n},a6.prototype.writeIntBE=function(e,t,n,i){if(e*=1,t>>>=0,!i){let i=Math.pow(2,8*n-1);la(this,e,t,n,i-1,-i)}let r=n-1,s=1,o=0;for(this[t+r]=255&e;--r>=0&&(s*=256);)e<0&&0===o&&0!==this[t+r+1]&&(o=1),this[t+r]=(e/s|0)-o&255;return t+n},a6.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a6.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a6.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a6.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a6.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||la(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a6.prototype.writeBigInt64LE=lC(function(e,t=0){return ll(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a6.prototype.writeBigInt64BE=lC(function(e,t=0){return lh(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a6.prototype.writeFloatLE=function(e,t,n){return lc(this,e,t,!0,n)},a6.prototype.writeFloatBE=function(e,t,n){return lc(this,e,t,!1,n)},a6.prototype.writeDoubleLE=function(e,t,n){return ld(this,e,t,!0,n)},a6.prototype.writeDoubleBE=function(e,t,n){return ld(this,e,t,!1,n)},a6.prototype.copy=function(e,t,n,i){if(!a6.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},a6.prototype.fill=function(e,t,n,i){let r;if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!a6.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){let t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{let s=a6.isBuffer(e)?e:a6.from(e,i),o=s.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=s[r%o]}return this};const lf={};function lp(e,t,n){lf[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function lg(e){let t="",n=e.length,i=+("-"===e[0]);for(;n>=i+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function lm(e,t,n,i,r,s){if(e>n||e<t){let i,r="bigint"==typeof t?"n":"";throw i=s>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${(s+1)*8}${r}`:`>= -(2${r} ** ${(s+1)*8-1}${r}) and < 2 ** ${(s+1)*8-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new lf.ERR_OUT_OF_RANGE("value",i,e)}ly(r,"offset"),(void 0===i[r]||void 0===i[r+s])&&l_(r,i.length-(s+1))}function ly(e,t){if("number"!=typeof e)throw new lf.ERR_INVALID_ARG_TYPE(t,"number",e)}function l_(e,t,n){if(Math.floor(e)!==e)throw ly(e,n),new lf.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new lf.ERR_BUFFER_OUT_OF_BOUNDS;throw new lf.ERR_OUT_OF_RANGE(n||"offset",`>= ${+!!n} and <= ${t}`,e)}lp("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),lp("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),lp("ERR_OUT_OF_RANGE",function(e,t,n){let i=`The value of "${e}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?r=lg(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=lg(r)),r+="n"),i+=` It must be ${t}. Received ${r}`},RangeError);const lv=/[^+/0-9A-Za-z-_]/g;function lw(e,t){let n;t=t||1/0;let i=e.length,r=null,s=[];for(let o=0;o<i;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319||o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function lb(e){return function(e){var t,n,i=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var i=n===t?0:4-n%4;return[n,i]}(e),r=i[0],s=i[1],o=new aJ((r+s)*3/4-s),a=0,l=s>0?r-4:r;for(n=0;n<l;n+=4)t=aY[e.charCodeAt(n)]<<18|aY[e.charCodeAt(n+1)]<<12|aY[e.charCodeAt(n+2)]<<6|aY[e.charCodeAt(n+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;return 2===s&&(t=aY[e.charCodeAt(n)]<<2|aY[e.charCodeAt(n+1)]>>4,o[a++]=255&t),1===s&&(t=aY[e.charCodeAt(n)]<<10|aY[e.charCodeAt(n+1)]<<4|aY[e.charCodeAt(n+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t),o}(function(e){if((e=(e=e.split("=")[0]).trim().replace(lv,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function lE(e,t,n,i){let r;for(r=0;r<i&&!(r+n>=t.length)&&!(r>=e.length);++r)t[r+n]=e[r];return r}function lI(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}const lT=function(){let e="0123456789abcdef",t=Array(256);for(let n=0;n<16;++n){let i=16*n;for(let r=0;r<16;++r)t[i+r]=e[n]+e[r]}return t}();function lC(e){return"undefined"==typeof BigInt?lS:e}function lS(){throw Error("BigInt not supported")}const lk="@firebase/firestore",lA="4.7.14";class lN{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}lN.UNAUTHENTICATED=new lN(null),lN.GOOGLE_CREDENTIALS=new lN("google-credentials-uid"),lN.FIRST_PARTY=new lN("first-party-uid"),lN.MOCK_USER=new lN("mock-user");let lR="11.7.3";const lP=new eQ("@firebase/firestore");function lD(){return lP.logLevel}function lx(e,...t){if(lP.logLevel<=_.DEBUG){let n=t.map(lM);lP.debug(`Firestore (${lR}): ${e}`,...n)}}function lO(e,...t){if(lP.logLevel<=_.ERROR){let n=t.map(lM);lP.error(`Firestore (${lR}): ${e}`,...n)}}function lL(e,...t){if(lP.logLevel<=_.WARN){let n=t.map(lM);lP.warn(`Firestore (${lR}): ${e}`,...n)}}function lM(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function lU(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,lF(e,i,n)}function lF(e,t,n){let i=`FIRESTORE (${lR}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(e){i+=" CONTEXT: "+n}throw lO(i),Error(i)}function lV(e,t,n,i){let r="Unexpected state";"string"==typeof n?r=n:i=n,e||lF(t,r,i)}const lB={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class lj extends ey{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class lq{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class l${constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class lz{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(lN.UNAUTHENTICATED))}shutdown(){}}class lH{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class lW{constructor(e){this.t=e,this.currentUser=lN.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){lV(void 0===this.o,42304);let n=this.i,i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),r=new lq;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new lq,e.enqueueRetryable(()=>i(this.currentUser))};let s=()=>{let t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},o=e=>{lx("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(lx("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new lq)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(lx("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(lV("string"==typeof t.accessToken,31837,{l:t}),new l$(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return lV(null===e||"string"==typeof e,2055,{h:e}),new lN(e)}}class lK{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=lN.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class lG{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new lK(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(lN.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class lQ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class lY{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,tc(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){lV(void 0===this.o,3512);let n=e=>{null!=e.error&&lx("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,lx("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let i=e=>{lx("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?i(e):lx("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new lQ(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(lV("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new lQ(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function lJ(){return new TextEncoder}class lX{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function lZ(e,t){return e<t?-1:+(e>t)}function l0(e,t){let n=0;for(;n<e.length&&n<t.length;){let i=e.codePointAt(n),r=t.codePointAt(n);if(i!==r){if(i<128&&r<128)return lZ(i,r);{let s=lJ(),o=function(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return lZ(e[n],t[n]);return lZ(e.length,t.length)}(s.encode(l1(e,n)),s.encode(l1(t,n)));return 0!==o?o:lZ(i,r)}}n+=i>65535?2:1}return lZ(e.length,t.length)}function l1(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function l2(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class l6{static now(){return l6.fromMillis(Date.now())}static fromDate(e){return l6.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new l6(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new lj(lB.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new lj(lB.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?lZ(this.nanoseconds,e.nanoseconds):lZ(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class l3{static fromTimestamp(e){return new l3(e)}static min(){return new l3(new l6(0,0))}static max(){return new l3(new l6(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const l5="__name__";class l4{constructor(e,t,n){void 0===t?t=0:t>e.length&&lU(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&lU(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===l4.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof l4?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let n=l4.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return lZ(e.length,t.length)}static compareSegments(e,t){let n=l4.isNumericId(e),i=l4.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?l4.extractNumericId(e).compare(l4.extractNumericId(t)):l0(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return I.fromString(e.substring(4,e.length-2))}}class l8 extends l4{construct(e,t,n){return new l8(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new lj(lB.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new l8(t)}static emptyPath(){return new l8([])}}const l7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class l9 extends l4{construct(e,t,n){return new l9(e,t,n)}static isValidIdentifier(e){return l7.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),l9.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===l5}static keyField(){return new l9([l5])}static fromServerFormat(e){let t=[],n="",i=0,r=()=>{if(0===n.length)throw new lj(lB.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;i<e.length;){let t=e[i];if("\\"===t){if(i+1===e.length)throw new lj(lB.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new lj(lB.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?s=!s:"."!==t||s?n+=t:r(),i++}if(r(),s)throw new lj(lB.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new l9(t)}static emptyPath(){return new l9([])}}class he{constructor(e){this.path=e}static fromPath(e){return new he(l8.fromString(e))}static fromName(e){return new he(l8.fromString(e).popFirst(5))}static empty(){return new he(l8.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===l8.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return l8.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new he(new l8(e.slice()))}}class ht{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ht(l3.min(),he.empty(),-1)}static max(){return new ht(l3.max(),he.empty(),-1)}}class hn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function hi(e){if(e.code!==lB.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;lx("LocalStore","Unexpectedly lost primary lease")}class hr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&lU(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new hr((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof hr?t:hr.resolve(t)}catch(e){return hr.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):hr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):hr.reject(t)}static resolve(e){return new hr((t,n)=>{t(e)})}static reject(e){return new hr((t,n)=>{n(e)})}static waitFor(e){return new hr((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=hr.resolve(!1);for(let n of e)t=t.next(e=>e?hr.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new hr((n,i)=>{let r=e.length,s=Array(r),o=0;for(let a=0;a<r;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===r&&n(s)},e=>i(e))}})}static doWhile(e,t){return new hr((n,i)=>{let r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}function hs(e){return"IndexedDbTransactionError"===e.name}class ho{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ce&&this.ce(e),e}}ho.le=-1;function ha(e){return 0===e&&1/e==-1/0}function hl(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function hh(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function hu(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class hc{constructor(e,t){this.comparator=e,this.root=t||hf.EMPTY}insert(e,t){return new hc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,hf.BLACK,null,null))}remove(e){return new hc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hf.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hd(this.root,e,this.comparator,!1)}getReverseIterator(){return new hd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hd(this.root,e,this.comparator,!0)}}class hd{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class hf{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:hf.RED,this.left=null!=i?i:hf.EMPTY,this.right=null!=r?r:hf.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new hf(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return hf.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,i=this;if(0>t(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return hf.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,hf.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,hf.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw lU(43730,{key:this.key,value:this.value});if(this.right.isRed())throw lU(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw lU(27949);return e+ +!this.isRed()}}hf.EMPTY=null,hf.RED=!0,hf.BLACK=!1,hf.EMPTY=new class{constructor(){this.size=0}get key(){throw lU(57766)}get value(){throw lU(16141)}get color(){throw lU(16727)}get left(){throw lU(29726)}get right(){throw lU(36894)}copy(e,t,n,i,r){return this}insert(e,t,n){return new hf(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class hp{constructor(e){this.comparator=e,this.data=new hc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new hg(this.data.getIterator())}getIteratorFrom(e){return new hg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof hp)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new hp(this.comparator);return t.data=e,t}}class hg{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class hm{constructor(e){this.fields=e,e.sort(l9.comparator)}static empty(){return new hm([])}unionWith(e){let t=new hp(l9.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new hm(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return l2(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class hy extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class h_{constructor(e){this.binaryString=e}static fromBase64String(e){return new h_(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new hy("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new h_(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return lZ(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}h_.EMPTY_BYTE_STRING=new h_("");const hv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hw(e){if(lV(!!e,39018),"string"==typeof e){let t=0,n=hv.exec(e);if(lV(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:hb(e.seconds),nanos:hb(e.nanos)}}function hb(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function hE(e){return"string"==typeof e?h_.fromBase64String(e):h_.fromUint8Array(e)}const hI="server_timestamp",hT="__type__",hC="__previous_value__",hS="__local_write_time__";function hk(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[hT])?void 0:n.stringValue)===hI}function hA(e){let t=e.mapValue.fields[hC];return hk(t)?hA(t):t}function hN(e){let t=hw(e.mapValue.fields[hS].timestampValue);return new l6(t.seconds,t.nanos)}class hR{constructor(e,t,n,i,r,s,o,a,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=h}}const hP="(default)";class hD{constructor(e,t){this.projectId=e,this.database=t||hP}static empty(){return new hD("","")}get isDefaultDatabase(){return this.database===hP}isEqual(e){return e instanceof hD&&e.projectId===this.projectId&&e.database===this.database}}const hx="__type__",hO="__max__",hL={mapValue:{fields:{__type__:{stringValue:hO}}}},hM="__vector__",hU="value";function hF(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?hk(e)?4:hX(e)?0x1fffffffffffff:hY(e)?10:11:lU(28295,{value:e})}function hV(e,t){if(e===t)return!0;let n=hF(e);if(n!==hF(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return hN(e).isEqual(hN(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let i=hw(e.timestampValue),r=hw(t.timestampValue);return i.seconds===r.seconds&&i.nanos===r.nanos;case 5:return e.stringValue===t.stringValue;case 6:return hE(e.bytesValue).isEqual(hE(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return hb(e.geoPointValue.latitude)===hb(t.geoPointValue.latitude)&&hb(e.geoPointValue.longitude)===hb(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return hb(e.integerValue)===hb(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=hb(e.doubleValue),i=hb(t.doubleValue);return n===i?ha(n)===ha(i):isNaN(n)&&isNaN(i)}return!1;case 9:return l2(e.arrayValue.values||[],t.arrayValue.values||[],hV);case 10:case 11:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(hl(s)!==hl(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!hV(s[e],o[e])))return!1;return!0;default:return lU(52216,{left:e})}}function hB(e,t){return void 0!==(e.values||[]).find(e=>hV(e,t))}function hj(e,t){if(e===t)return 0;let n=hF(e),i=hF(t);if(n!==i)return lZ(n,i);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return lZ(e.booleanValue,t.booleanValue);case 2:let r=hb(e.integerValue||e.doubleValue),s=hb(t.integerValue||t.doubleValue);return r<s?-1:r>s?1:r===s?0:isNaN(r)?isNaN(s)?0:-1:1;case 3:return hq(e.timestampValue,t.timestampValue);case 4:return hq(hN(e),hN(t));case 5:return l0(e.stringValue,t.stringValue);case 6:return function(e,t){let n=hE(e),i=hE(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){let t=lZ(n[e],i[e]);if(0!==t)return t}return lZ(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=lZ(hb(e.latitude),hb(t.latitude));return 0!==n?n:lZ(hb(e.longitude),hb(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return h$(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,i,r,s;let o=e.fields||{},a=t.fields||{},l=null==(n=o[hU])?void 0:n.arrayValue,h=null==(i=a[hU])?void 0:i.arrayValue,u=lZ((null==(r=null==l?void 0:l.values)?void 0:r.length)||0,(null==(s=null==h?void 0:h.values)?void 0:s.length)||0);return 0!==u?u:h$(l,h)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===hL.mapValue&&t===hL.mapValue)return 0;if(e===hL.mapValue)return 1;if(t===hL.mapValue)return -1;let n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){let t=l0(i[e],s[e]);if(0!==t)return t;let o=hj(n[i[e]],r[s[e]]);if(0!==o)return o}return lZ(i.length,s.length)}(e.mapValue,t.mapValue);default:throw lU(23264,{Pe:n})}}function hq(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return lZ(e,t);let n=hw(e),i=hw(t),r=lZ(n.seconds,i.seconds);return 0!==r?r:lZ(n.nanos,i.nanos)}function h$(e,t){let n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){let t=hj(n[e],i[e]);if(t)return t}return lZ(n.length,i.length)}function hz(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=hw(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?hE(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,he.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let i of e.values||[])n?n=!1:t+=",",t+=hz(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",i=!0;for(let r of t)i?i=!1:n+=",",n+=`${r}:${hz(e.fields[r])}`;return n+"}"}(e.mapValue):lU(61005,{value:e})}function hH(e){return!!e&&"integerValue"in e}function hW(e){return!!e&&"arrayValue"in e}function hK(e){return!!e&&"nullValue"in e}function hG(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function hQ(e){return!!e&&"mapValue"in e}function hY(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[hx])?void 0:n.stringValue)===hM}function hJ(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return hh(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=hJ(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=hJ(e.arrayValue.values[n]);return t}return Object.assign({},e)}function hX(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===hO}class hZ{constructor(e){this.value=e}static empty(){return new hZ({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!hQ(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hJ(t)}setAll(e){let t=l9.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){let e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=hJ(e):i.push(r.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){let t=this.field(e.popLast());hQ(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return hV(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];hQ(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){for(let i of(hh(t,(t,n)=>e[t]=n),n))delete e[i]}clone(){return new hZ(hJ(this.value))}}class h0{constructor(e,t,n,i,r,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new h0(e,0,l3.min(),l3.min(),l3.min(),hZ.empty(),0)}static newFoundDocument(e,t,n,i){return new h0(e,1,t,l3.min(),n,i,0)}static newNoDocument(e,t){return new h0(e,2,t,l3.min(),l3.min(),hZ.empty(),0)}static newUnknownDocument(e,t){return new h0(e,3,t,l3.min(),l3.min(),hZ.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(l3.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=hZ.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=hZ.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=l3.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof h0&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new h0(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class h1{constructor(e,t){this.position=e,this.inclusive=t}}function h2(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){let s=t[r],o=e.position[r];if(i=s.field.isKeyField()?he.comparator(he.fromName(o.referenceValue),n.key):hj(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function h6(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!hV(e.position[n],t.position[n]))return!1;return!0}class h3{constructor(e,t="asc"){this.field=e,this.dir=t}}class h5{}class h4 extends h5{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ue(e,t,n):"array-contains"===t?new ur(e,n):"in"===t?new us(e,n):"not-in"===t?new uo(e,n):"array-contains-any"===t?new ua(e,n):new h4(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ut(e,n):new un(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(hj(t,this.value)):null!==t&&hF(this.value)===hF(t)&&this.matchesComparison(hj(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return lU(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class h8 extends h5{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new h8(e,t)}matches(e){return h7(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function h7(e){return"and"===e.op}function h9(e){for(let t of e.filters)if(t instanceof h8)return!1;return!0}class ue extends h4{constructor(e,t,n){super(e,t,n),this.key=he.fromName(n.referenceValue)}matches(e){let t=he.comparator(e.key,this.key);return this.matchesComparison(t)}}class ut extends h4{constructor(e,t){super(e,"in",t),this.keys=ui("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class un extends h4{constructor(e,t){super(e,"not-in",t),this.keys=ui("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ui(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>he.fromName(e.referenceValue))}class ur extends h4{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return hW(t)&&hB(t.arrayValue,this.value)}}class us extends h4{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&hB(this.value.arrayValue,t)}}class uo extends h4{constructor(e,t){super(e,"not-in",t)}matches(e){if(hB(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!hB(this.value.arrayValue,t)}}class ua extends h4{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!hW(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>hB(this.value.arrayValue,e))}}class ul{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.Ie=null}}function uh(e,t=null,n=[],i=[],r=null,s=null,o=null){return new ul(e,t,n,i,r,s,o)}function uu(e){if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof h4)return t.field.canonicalString()+t.op.toString()+hz(t.value);if(h9(t)&&h7(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>hz(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>hz(e)).join(",")),e.Ie=t}return e.Ie}function uc(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++){var n,i;if(n=e.orderBy[r],i=t.orderBy[r],!(n.dir===i.dir&&n.field.isEqual(i.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof h4?n instanceof h4&&t.op===n.op&&t.field.isEqual(n.field)&&hV(t.value,n.value):t instanceof h8?n instanceof h8&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,i,r)=>t&&e(i,n.filters[r]),!0):void lU(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!h6(e.startAt,t.startAt)&&h6(e.endAt,t.endAt)}function ud(e){return he.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class uf{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function up(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ug(e){if(null===e.Ee){let t;e.Ee=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ee.push(t),n.add(t.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new hp(l9.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ee.push(new h3(t,i))}),n.has(l9.keyField().canonicalString())||e.Ee.push(new h3(l9.keyField(),i))}return e.Ee}function um(e){return e.de||(e.de=function(e,t){if("F"===e.limitType)return uh(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new h3(e.field,t)});let n=e.endAt?new h1(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new h1(e.startAt.position,e.startAt.inclusive):null;return uh(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(e,ug(e))),e.de}function uy(e,t,n){return new uf(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function u_(e,t){return uc(um(e),um(t))&&e.limitType===t.limitType}function uv(e){return`${uu(um(e))}|lt:${e.limitType}`}function uw(e){var t;let n;return`Query(target=${n=(t=um(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof h4?`${t.field.canonicalString()} ${t.op} ${hz(t.value)}`:t instanceof h8?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>hz(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>hz(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function ub(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):he.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of ug(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let i=h2(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,ug(e),t))&&(!e.endAt||!!function(e,t,n){let i=h2(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,ug(e),t))}function uE(e){return(t,n)=>{let i=!1;for(let r of ug(e)){let e=function(e,t,n){let i=e.field.isKeyField()?he.comparator(t.key,n.key):function(e,t,n){let i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?hj(i,r):lU(42886)}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return -1*i;default:return lU(19790,{direction:e.dir})}}(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}class uI{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,i]of n)if(this.equalsFn(t,e))return i}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){hh(this.inner,(t,n)=>{for(let[t,i]of n)e(t,i)})}isEmpty(){return hu(this.inner)}size(){return this.innerSize}}const uT=new hc(he.comparator),uC=new hc(he.comparator);function uS(...e){let t=uC;for(let n of e)t=t.insert(n.key,n);return t}function uk(e){let t=uC;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function uA(){return new uI(e=>e.toString(),(e,t)=>e.isEqual(t))}const uN=new hc(he.comparator),uR=new hp(he.comparator);function uP(...e){let t=uR;for(let n of e)t=t.add(n);return t}const uD=new hp(lZ);function ux(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ha(t)?"-0":t}}function uO(e){return{integerValue:""+e}}class uL{constructor(){this._=void 0}}function uM(e,t){return e instanceof uq?hH(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class uU extends uL{}class uF extends uL{constructor(e){super(),this.elements=e}}function uV(e,t){let n=uz(t);for(let t of e.elements)n.some(e=>hV(e,t))||n.push(t);return{arrayValue:{values:n}}}class uB extends uL{constructor(e){super(),this.elements=e}}function uj(e,t){let n=uz(t);for(let t of e.elements)n=n.filter(e=>!hV(e,t));return{arrayValue:{values:n}}}class uq extends uL{constructor(e,t){super(),this.serializer=e,this.Re=t}}function u$(e){return hb(e.integerValue||e.doubleValue)}function uz(e){return hW(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class uH{constructor(e,t){this.version=e,this.transformResults=t}}class uW{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new uW}static exists(e){return new uW(void 0,e)}static updateTime(e){return new uW(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function uK(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class uG{}function uQ(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new u6(e.key,uW.none()):new uX(e.key,e.data,uW.none());{let n=e.data,i=hZ.empty(),r=new hp(l9.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new uZ(e.key,i,new hm(r.toArray()),uW.none())}}function uY(e,t,n,i){return e instanceof uX?function(e,t,n,i){if(!uK(e.precondition,t))return n;let r=e.value.clone(),s=u2(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof uZ?function(e,t,n,i){if(!uK(e.precondition,t))return n;let r=u2(e.fieldTransforms,i,t),s=t.data;return(s.setAll(u0(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):uK(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function uJ(e,t){var n,i;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||!(!n||!i)&&l2(n,i,(e,t)=>{var n,i;return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof uF&&i instanceof uF||n instanceof uB&&i instanceof uB?l2(n.elements,i.elements,hV):n instanceof uq&&i instanceof uq?hV(n.Re,i.Re):n instanceof uU&&i instanceof uU)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class uX extends uG{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class uZ extends uG{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function u0(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let i=e.data.field(n);t.set(n,i)}}),t}function u1(e,t,n){let i=new Map;lV(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let s=0;s<n.length;s++){var r;let o=e[s],a=o.transform,l=t.data.field(o.field);i.set(o.field,(r=n[s],a instanceof uF?uV(a,l):a instanceof uB?uj(a,l):r))}return i}function u2(e,t,n){let i=new Map;for(let r of e){let e=r.transform,s=n.data.field(r.field);i.set(r.field,e instanceof uU?function(e,t){let n={fields:{[hT]:{stringValue:hI},[hS]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&hk(t)&&(t=hA(t)),t&&(n.fields[hC]=t),{mapValue:n}}(t,s):e instanceof uF?uV(e,s):e instanceof uB?uj(e,s):function(e,t){let n=uM(e,t),i=u$(n)+u$(e.Re);return hH(n)&&hH(e.Re)?uO(i):ux(e.serializer,i)}(e,s))}return i}class u6 extends uG{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class u3 extends uG{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class u5{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let i=this.mutations[t];i.key.isEqual(e.key)&&function(e,t,n){e instanceof uX?function(e,t,n){let i=e.value.clone(),r=u1(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof uZ?function(e,t,n){if(!uK(e.precondition,t))return t.convertToUnknownDocument(n.version);let i=u1(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(u0(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(i,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=uY(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=uY(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=uA();return this.mutations.forEach(i=>{let r=e.get(i.key),s=r.overlayedDocument,o=this.applyToLocalView(s,r.mutatedFields),a=uQ(s,o=t.has(i.key)?null:o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(l3.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),uP())}isEqual(e){return this.batchId===e.batchId&&l2(this.mutations,e.mutations,(e,t)=>uJ(e,t))&&l2(this.baseMutations,e.baseMutations,(e,t)=>uJ(e,t))}}class u4{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){lV(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let i=uN,r=e.mutations;for(let e=0;e<r.length;e++)i=i.insert(r[e].key,n[e].version);return new u4(e,t,n,i)}}class u8{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class u7{constructor(e,t){this.count=e,this.unchangedNames=t}}function u9(e){if(void 0===e)return lO("GRPC error has no .code"),lB.UNKNOWN;switch(e){case M.OK:return lB.OK;case M.CANCELLED:return lB.CANCELLED;case M.UNKNOWN:return lB.UNKNOWN;case M.DEADLINE_EXCEEDED:return lB.DEADLINE_EXCEEDED;case M.RESOURCE_EXHAUSTED:return lB.RESOURCE_EXHAUSTED;case M.INTERNAL:return lB.INTERNAL;case M.UNAVAILABLE:return lB.UNAVAILABLE;case M.UNAUTHENTICATED:return lB.UNAUTHENTICATED;case M.INVALID_ARGUMENT:return lB.INVALID_ARGUMENT;case M.NOT_FOUND:return lB.NOT_FOUND;case M.ALREADY_EXISTS:return lB.ALREADY_EXISTS;case M.PERMISSION_DENIED:return lB.PERMISSION_DENIED;case M.FAILED_PRECONDITION:return lB.FAILED_PRECONDITION;case M.ABORTED:return lB.ABORTED;case M.OUT_OF_RANGE:return lB.OUT_OF_RANGE;case M.UNIMPLEMENTED:return lB.UNIMPLEMENTED;case M.DATA_LOSS:return lB.DATA_LOSS;default:return lU(39323,{code:e})}}(U=M||(M={}))[U.OK=0]="OK",U[U.CANCELLED=1]="CANCELLED",U[U.UNKNOWN=2]="UNKNOWN",U[U.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",U[U.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",U[U.NOT_FOUND=5]="NOT_FOUND",U[U.ALREADY_EXISTS=6]="ALREADY_EXISTS",U[U.PERMISSION_DENIED=7]="PERMISSION_DENIED",U[U.UNAUTHENTICATED=16]="UNAUTHENTICATED",U[U.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",U[U.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",U[U.ABORTED=10]="ABORTED",U[U.OUT_OF_RANGE=11]="OUT_OF_RANGE",U[U.UNIMPLEMENTED=12]="UNIMPLEMENTED",U[U.INTERNAL=13]="INTERNAL",U[U.UNAVAILABLE=14]="UNAVAILABLE",U[U.DATA_LOSS=15]="DATA_LOSS";const ce=new I([0xffffffff,0xffffffff],0);function ct(e){let t=lJ().encode(e),n=new T;return n.update(t),new Uint8Array(n.digest())}function cn(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new I([n,i],0),new I([r,s],0)]}class ci{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new cr(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new cr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new cr(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=I.fromNumber(this.pe)}we(e,t,n){let i=e.add(t.multiply(I.fromNumber(n)));return 1===i.compare(ce)&&(i=new I([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;let[t,n]=cn(ct(e));for(let e=0;e<this.hashCount;e++){let i=this.we(t,n,e);if(!this.be(i))return!1}return!0}static create(e,t,n){let i=new ci(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.pe)return;let[t,n]=cn(ct(e));for(let e=0;e<this.hashCount;e++){let i=this.we(t,n,e);this.Se(i)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class cr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class cs{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,co.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new cs(l3.min(),i,new hc(lZ),uT,uP())}}class co{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new co(n,t,uP(),uP(),uP())}}class ca{constructor(e,t,n,i){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=i}}class cl{constructor(e,t){this.targetId=e,this.Ce=t}}class ch{constructor(e,t,n=h_.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class cu{constructor(){this.Fe=0,this.Me=cf(),this.xe=h_.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=uP(),t=uP(),n=uP();return this.Me.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:lU(38017,{changeType:r})}}),new co(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=cf()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,lV(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class cc{constructor(e){this.ze=e,this.je=new Map,this.He=uT,this.Je=cd(),this.Ye=cd(),this.Ze=new hc(lZ)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:lU(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((e,n)=>{this.it(n)&&t(n)})}ot(e){let t=e.targetId,n=e.Ce.count,i=this._t(t);if(i){let r=i.target;if(ud(r))if(0===n){let e=new he(r.path);this.tt(t,e,h0.newNoDocument(e,l3.min()))}else lV(1===n,20013,{expectedCount:n});else{let i=this.ut(t);if(i!==n){let n=this.ct(e),r=n?this.lt(n,e,i):1;0!==r&&(this.st(t),this.Ze=this.Ze.insert(t,2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ct(e){let t,n,i=e.Ce.unchangedNames;if(!i||!i.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=i;try{t=hE(r).toUint8Array()}catch(e){if(e instanceof hy)return lL("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new ci(t,s,o)}catch(e){return lL(e instanceof cr?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.pe?null:n}lt(e,t,n){return 2*(t.Ce.count!==n-this.Tt(e,t.targetId))}Tt(e,t){let n=this.ze.getRemoteKeysForTarget(t),i=0;return n.forEach(n=>{let r=this.ze.Pt(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,n,null),i++)}),i}It(e){let t=new Map;this.je.forEach((n,i)=>{let r=this._t(i);if(r){if(n.current&&ud(r.target)){let t=new he(r.target.path);this.Et(t).has(i)||this.dt(i,t)||this.tt(i,t,h0.newNoDocument(t,e))}n.Le&&(t.set(i,n.qe()),n.Qe())}});let n=uP();this.Ye.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{let t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.He.forEach((t,n)=>n.setReadTime(e));let i=new cs(e,t,this.Ze,this.He,n);return this.He=uT,this.Je=cd(),this.Ye=cd(),this.Ze=new hc(lZ),i}et(e,t){if(!this.it(e))return;let n=2*!!this.dt(e,t.key);this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;let i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new cu,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new hp(lZ),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new hp(lZ),this.Je=this.Je.insert(e,t)),t}it(e){let t=null!==this._t(e);return t||lx("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new cu),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function cd(){return new hc(he.comparator)}function cf(){return new hc(he.comparator)}const cp={asc:"ASCENDING",desc:"DESCENDING"},cg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},cm={and:"AND",or:"OR"};class cy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function c_(e,t){return e.useProto3Json||null==t?t:{value:t}}function cv(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function cw(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function cb(e){return lV(!!e,49232),l3.fromTimestamp(function(e){let t=hw(e);return new l6(t.seconds,t.nanos)}(e))}function cE(e,t){return cI(e,t).canonicalString()}function cI(e,t){let n=new l8(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function cT(e){let t=l8.fromString(e);return lV(cx(t),10190,{key:t.toString()}),t}function cC(e,t){return cE(e.databaseId,t.path)}function cS(e,t){let n=cT(t);if(n.get(1)!==e.databaseId.projectId)throw new lj(lB.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new lj(lB.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new he(cN(n))}function ck(e,t){return cE(e.databaseId,t)}function cA(e){return new l8(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function cN(e){return lV(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function cR(e,t,n){return{name:cC(e,t),fields:n.value.mapValue.fields}}function cP(e){return{fieldPath:e.canonicalString()}}function cD(e){return l9.fromServerFormat(e.fieldPath)}function cx(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class cO{constructor(e,t,n,i,r=l3.min(),s=l3.min(),o=h_.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new cO(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cO(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cO(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cO(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class cL{constructor(e){this.wt=e}}class cM{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(+!!e.booleanValue);else if("integerValue"in e)this.Mt(t,15),t.xt(hb(e.integerValue));else if("doubleValue"in e){let n=hb(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),ha(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=hw(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(hE(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?hX(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):hY(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):lU(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let n=e.fields||{};for(let e of(this.Mt(t,55),Object.keys(n)))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,i;let r=e.fields||{};this.Mt(t,53);let s=(null==(i=null==(n=r[hU].arrayValue)?void 0:n.values)?void 0:i.length)||0;this.Mt(t,15),t.xt(hb(s)),this.Nt(hU,t),this.Ct(r[hU],t)}$t(e,t){let n=e.values||[];for(let e of(this.Mt(t,50),n))this.Ct(e,t)}kt(e,t){this.Mt(t,37),he.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}cM.Wt=new cM;class cU{constructor(){this.yn=new cF}addToCollectionParentIndex(e,t){return this.yn.add(t),hr.resolve()}getCollectionParents(e,t){return hr.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return hr.resolve()}deleteFieldIndex(e,t){return hr.resolve()}deleteAllFieldIndexes(e){return hr.resolve()}createTargetIndexes(e,t){return hr.resolve()}getDocumentsMatchingTarget(e,t){return hr.resolve(null)}getIndexType(e,t){return hr.resolve(0)}getFieldIndexes(e,t){return hr.resolve([])}getNextCollectionGroupToUpdate(e){return hr.resolve(null)}getMinOffset(e,t){return hr.resolve(ht.min())}getMinOffsetFromCollectionGroup(e,t){return hr.resolve(ht.min())}updateCollectionGroup(e,t,n){return hr.resolve()}updateIndexEntries(e,t){return hr.resolve()}}class cF{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new hp(l8.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new hp(l8.comparator)).toArray()}}new Uint8Array(0);const cV={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class cB{static withCacheSize(e){return new cB(e,cB.DEFAULT_COLLECTION_PERCENTILE,cB.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}cB.DEFAULT_COLLECTION_PERCENTILE=10,cB.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,cB.DEFAULT=new cB(0x2800000,cB.DEFAULT_COLLECTION_PERCENTILE,cB.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),cB.DISABLED=new cB(-1,0,0);class cj{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new cj(0)}static ir(){return new cj(-1)}}const cq="LruGarbageCollector";function c$([e,t],[n,i]){let r=lZ(e,n);return 0===r?lZ(t,i):r}class cz{constructor(e){this.cr=e,this.buffer=new hp(c$),this.lr=0}hr(){return++this.lr}Pr(e){let t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>c$(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class cH{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Tr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return null!==this.Tr}Ir(e){lx(cq,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){hs(e)?lx(cq,"Ignoring IndexedDB error during garbage collection: ",e):await hi(e)}await this.Ir(3e5)})}}class cW{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return hr.resolve(ho.le);let n=new cz(t);return this.Er.forEachTarget(e,e=>n.Pr(e.sequenceNumber)).next(()=>this.Er.Ar(e,e=>n.Pr(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Er.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(lx("LruGarbageCollector","Garbage collection skipped; disabled"),hr.resolve(cV)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(lx("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cV):this.Rr(e,t))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,t){let n,i,r,s,o,a,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(lx("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,s=Date.now(),this.nthSequenceNumber(e,i))).next(i=>(n=i,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),lD()<=_.DEBUG&&lx("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${i} in `+(o-s)+"ms\n"+`	Removed ${r} targets in `+(a-o)+"ms\n"+`	Removed ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-h}ms`),hr.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:e})))}}class cK{constructor(){this.changes=new uI(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,h0.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?hr.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class cG{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class cQ{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&uY(n.mutation,e,hm.empty(),l6.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,uP()).next(()=>t))}getLocalViewOfDocuments(e,t,n=uP()){let i=uA();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=uS();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=uA();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,uP()))}populateOverlays(e,t,n){let i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=uT,s=uA(),o=uA();return t.forEach((e,t)=>{let o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof uZ)?r=r.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),uY(o.mutation,t,o.mutation.getFieldMask(),l6.now())):s.set(t.key,hm.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new cG(t,null!=(n=s.get(e))?n:null))}),o))}recalculateAndSaveOverlays(e,t){let n=uA(),i=new hc((e,t)=>e-t),r=uP();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let r of e)r.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||hm.empty();o=r.applyToLocalView(s,o),n.set(e,o);let a=(i.get(r.batchId)||uP()).add(e);i=i.insert(r.batchId,a)})}).next(()=>{let s=[],o=i.getReverseIterator();for(;o.hasNext();){let i=o.getNext(),a=i.key,l=i.value,h=uA();l.forEach(e=>{if(!r.has(e)){let i=uQ(t.get(e),n.get(e));null!==i&&h.set(e,i),r=r.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return hr.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return he.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):null!==t.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{let s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):hr.resolve(uA()),o=-1,a=r;return s.next(t=>hr.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?hr.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,a,t,uP())).next(e=>({batchId:o,changes:uk(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new he(t)).next(e=>{let t=uS();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let r=t.collectionGroup,s=uS();return this.indexManager.getCollectionParents(e,r).next(o=>hr.forEach(o,o=>{let a=new uf(o.child(r),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n,i).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,i))).next(e=>{r.forEach((t,n)=>{let i=n.getKey();null===e.get(i)&&(e=e.insert(i,h0.newInvalidDocument(i)))});let n=uS();return e.forEach((e,i)=>{let s=r.get(e);void 0!==s&&uY(s.mutation,i,hm.empty(),l6.now()),ub(t,i)&&(n=n.insert(e,i))}),n})}}class cY{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return hr.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,{id:t.id,version:t.version,createTime:cb(t.createTime)}),hr.resolve()}getNamedQuery(e,t){return hr.resolve(this.Mr.get(t))}saveNamedQuery(e,t){return this.Mr.set(t.name,{name:t.name,query:function(e){let t=function(e){var t;let n,i=function(e){let t=cT(e);return 4===t.length?l8.emptyPath():cN(t)}(e.parent),r=e.structuredQuery,s=r.from?r.from.length:0,o=null;if(s>0){lV(1===s,65062);let e=r.from[0];e.allDescendants?o=e.collectionId:i=i.child(e.collectionId)}let a=[];r.where&&(a=function(e){var t;let n=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=cD(e.unaryFilter.field);return h4.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=cD(e.unaryFilter.field);return h4.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=cD(e.unaryFilter.field);return h4.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=cD(e.unaryFilter.field);return h4.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return lU(61313);default:return lU(60726)}}(t):void 0!==t.fieldFilter?h4.create(cD(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return lU(58110);default:return lU(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?h8.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return lU(1026)}}(t.compositeFilter.op)):lU(30097,{filter:t})}(e);return n instanceof h8&&h9(t=n)&&h7(t)?n.getFilters():[n]}(r.where));let l=[];r.orderBy&&(l=r.orderBy.map(e=>new h3(cD(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let h=null;r.limit&&(h=null==(n="object"==typeof(t=r.limit)?t.value:t)?null:n);let u=null;r.startAt&&(u=function(e){let t=!!e.before;return new h1(e.values||[],t)}(r.startAt));let c=null;return r.endAt&&(c=function(e){let t=!e.before;return new h1(e.values||[],t)}(r.endAt)),new uf(i,o,l,a,h,"F",u,c)}({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?uy(t,t.limit,"L"):t}(t.bundledQuery),readTime:cb(t.readTime)}),hr.resolve()}}class cJ{constructor(){this.overlays=new hc(he.comparator),this.Or=new Map}getOverlay(e,t){return hr.resolve(this.overlays.get(t))}getOverlays(e,t){let n=uA();return hr.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.St(e,t,i)}),hr.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Or.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.Or.delete(n)),hr.resolve()}getOverlaysForCollection(e,t,n){let i=uA(),r=t.length+1,s=new he(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return hr.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new hc((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=uA(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=uA(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=i)););return hr.resolve(o)}St(e,t,n){let i=this.overlays.get(n.key);if(null!==i){let e=this.Or.get(i.largestBatchId).delete(n.key);this.Or.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new u8(t,n));let r=this.Or.get(t);void 0===r&&(r=uP(),this.Or.set(t,r)),this.Or.set(t,r.add(n.key))}}class cX{constructor(){this.sessionToken=h_.EMPTY_BYTE_STRING}getSessionToken(e){return hr.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,hr.resolve()}}class cZ{constructor(){this.Nr=new hp(c0.Br),this.Lr=new hp(c0.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){let n=new c0(e,t);this.Nr=this.Nr.add(n),this.Lr=this.Lr.add(n)}qr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Qr(new c0(e,t))}$r(e,t){e.forEach(e=>this.removeReference(e,t))}Ur(e){let t=new he(new l8([])),n=new c0(t,e),i=new c0(t,e+1),r=[];return this.Lr.forEachInRange([n,i],e=>{this.Qr(e),r.push(e.key)}),r}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){let t=new he(new l8([])),n=new c0(t,e),i=new c0(t,e+1),r=uP();return this.Lr.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){let t=new c0(e,0),n=this.Nr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class c0{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return he.comparator(e.key,t.key)||lZ(e.Gr,t.Gr)}static kr(e,t){return lZ(e.Gr,t.Gr)||he.comparator(e.key,t.key)}}class c1{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new hp(c0.Br)}checkEmpty(e){return hr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){let r=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new u5(r,t,n,i);for(let t of(this.mutationQueue.push(s),i))this.zr=this.zr.add(new c0(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return hr.resolve(s)}lookupMutationBatch(e,t){return hr.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Hr(t+1),i=n<0?0:n;return hr.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return hr.resolve(0===this.mutationQueue.length?-1:this.Jn-1)}getAllMutationBatches(e){return hr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new c0(t,0),i=new c0(t,Number.POSITIVE_INFINITY),r=[];return this.zr.forEachInRange([n,i],e=>{let t=this.jr(e.Gr);r.push(t)}),hr.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new hp(lZ);return t.forEach(e=>{let t=new c0(e,0),i=new c0(e,Number.POSITIVE_INFINITY);this.zr.forEachInRange([t,i],e=>{n=n.add(e.Gr)})}),hr.resolve(this.Jr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=n;he.isDocumentKey(r)||(r=r.child(""));let s=new c0(new he(r),0),o=new hp(lZ);return this.zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.Gr)),!0)},s),hr.resolve(this.Jr(o))}Jr(e){let t=[];return e.forEach(e=>{let n=this.jr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){lV(0===this.Yr(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.zr;return hr.forEach(t.mutations,i=>{let r=new c0(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.zr=n})}Xn(e){}containsKey(e,t){let n=new c0(t,0),i=this.zr.firstAfterOrEqual(n);return hr.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,hr.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}jr(e){let t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class c2{constructor(e){this.Zr=e,this.docs=new hc(he.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.Zr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return hr.resolve(n?n.document.mutableCopy():h0.newInvalidDocument(t))}getEntries(e,t){let n=uT;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():h0.newInvalidDocument(e))}),hr.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=uT,s=t.path,o=new he(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=he.comparator(e.documentKey,t.documentKey))?n:lZ(e.largestBatchId,t.largestBatchId)}(new ht(o.readTime,o.key,-1),n)||(i.has(o.key)||ub(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return hr.resolve(r)}getAllFromCollectionGroup(e,t,n,i){lU(9500)}Xr(e,t){return hr.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new c6(this)}getSize(e){return hr.resolve(this.size)}}class c6 extends cK{constructor(e){super(),this.vr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.vr.addEntry(e,i)):this.vr.removeEntry(n)}),hr.waitFor(t)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}}class c3{constructor(e){this.persistence=e,this.ei=new uI(e=>uu(e),uc),this.lastRemoteSnapshotVersion=l3.min(),this.highestTargetId=0,this.ti=0,this.ni=new cZ,this.targetCount=0,this.ri=cj.rr()}forEachTarget(e,t){return this.ei.forEach((e,n)=>t(n)),hr.resolve()}getLastRemoteSnapshotVersion(e){return hr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return hr.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),hr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ti&&(this.ti=t),hr.resolve()}ar(e){this.ei.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ri=new cj(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,hr.resolve()}updateTargetData(e,t){return this.ar(t),hr.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),this.targetCount-=1,hr.resolve()}removeTargets(e,t,n){let i=0,r=[];return this.ei.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.ei.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),hr.waitFor(r).next(()=>i)}getTargetCount(e){return hr.resolve(this.targetCount)}getTargetData(e,t){let n=this.ei.get(t)||null;return hr.resolve(n)}addMatchingKeys(e,t,n){return this.ni.qr(t,n),hr.resolve()}removeMatchingKeys(e,t,n){this.ni.$r(t,n);let i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),hr.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),hr.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ni.Wr(t);return hr.resolve(n)}containsKey(e,t){return hr.resolve(this.ni.containsKey(t))}}class c5{constructor(e,t){this.ii={},this.overlays={},this.si=new ho(0),this.oi=!1,this.oi=!0,this._i=new cX,this.referenceDelegate=e(this),this.ai=new c3(this),this.indexManager=new cU,this.remoteDocumentCache=new c2(e=>this.referenceDelegate.ui(e)),this.serializer=new cL(t),this.ci=new cY(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new cJ,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ii[e.toKey()];return n||(n=new c1(t,this.referenceDelegate),this.ii[e.toKey()]=n),n}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,n){lx("MemoryPersistence","Starting transaction:",e);let i=new c4(this.si.next());return this.referenceDelegate.li(),n(i).next(e=>this.referenceDelegate.hi(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Pi(e,t){return hr.or(Object.values(this.ii).map(n=>()=>n.containsKey(e,t)))}}class c4 extends hn{constructor(e){super(),this.currentSequenceNumber=e}}class c8{constructor(e){this.persistence=e,this.Ti=new cZ,this.Ii=null}static Ei(e){return new c8(e)}get di(){if(this.Ii)return this.Ii;throw lU(60996)}addReference(e,t,n){return this.Ti.addReference(n,t),this.di.delete(n.toString()),hr.resolve()}removeReference(e,t,n){return this.Ti.removeReference(n,t),this.di.add(n.toString()),hr.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),hr.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach(e=>this.di.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}li(){this.Ii=new Set}hi(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return hr.forEach(this.di,n=>{let i=he.fromPath(n);return this.Ai(e,i).next(e=>{e||t.removeEntry(i,l3.min())})}).next(()=>(this.Ii=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ai(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}ui(e){return 0}Ai(e,t){return hr.or([()=>hr.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}}class c7{constructor(e,t){this.persistence=e,this.Ri=new uI(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,i=e.length;for(let t=0;t<i;t++){let i=e.charAt(t);switch(i){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=i}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new cW(this,t)}static Ei(e,t){return new c7(e,t)}li(){}hi(e){return hr.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Vr(e){let t=0;return this.Ar(e,e=>{t++}).next(()=>t)}Ar(e,t){return hr.forEach(this.Ri,(n,i)=>this.gr(e,n,i).next(e=>e?hr.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.Xr(e,i=>this.gr(e,i,t).next(e=>{e||(n++,r.removeEntry(i,l3.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),hr.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),hr.resolve()}removeReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),hr.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),hr.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(hF(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=hA(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return hE(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var i;let r;return i=t.mapValue,r=0,hh(i.fields,(t,n)=>{r+=t.length+e(n)}),r;default:throw lU(13486,{value:t})}}(e.data.value)),t}gr(e,t,n){return hr.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.Ri.get(t);return hr.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class c9{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.ls=n,this.hs=i}static Ps(e,t){let n=uP(),i=uP();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new c9(e,t.fromCache,n,i)}}class de{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class dt{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=!function(){var e;let t=null==(e=et())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(B.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}(ef())>0?6:4}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(e,t,n,i){let r={result:null};return this.Rs(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.Vs(e,t,i,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;let n=new de;return this.fs(e,t,n).next(i=>{if(r.result=i,this.Is)return this.gs(e,t,n,i.size)})}).next(()=>r.result)}gs(e,t,n,i){return n.documentReadCount<this.Es?(lD()<=_.DEBUG&&lx("QueryEngine","SDK will not create cache indexes for query:",uw(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),hr.resolve()):(lD()<=_.DEBUG&&lx("QueryEngine","Query:",uw(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ds*i?(lD()<=_.DEBUG&&lx("QueryEngine","The SDK decides to create cache indexes for query:",uw(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,um(t))):hr.resolve())}Rs(e,t){if(up(t))return hr.resolve(null);let n=um(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(n=um(t=uy(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{let r=uP(...i);return this.As.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.ps(t,i);return this.ys(t,s,r,n.readTime)?this.Rs(e,uy(t,null,"F")):this.ws(e,s,t,n)}))})))}Vs(e,t,n,i){return up(t)||i.isEqual(l3.min())?hr.resolve(null):this.As.getDocuments(e,n).next(r=>{let s=this.ps(t,r);return this.ys(t,s,n,i)?hr.resolve(null):(lD()<=_.DEBUG&&lx("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),uw(t)),this.ws(e,s,t,function(e,t){let n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1;return new ht(l3.fromTimestamp(1e9===i?new l6(n+1,0):new l6(n,i)),he.empty(),-1)}(i,0)).next(e=>e))})}ps(e,t){let n=new hp(uE(e));return t.forEach((t,i)=>{ub(e,i)&&(n=n.add(i))}),n}ys(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}fs(e,t,n){return lD()<=_.DEBUG&&lx("QueryEngine","Using full collection scan to execute query:",uw(t)),this.As.getDocumentsMatchingQuery(e,t,ht.min(),n)}ws(e,t,n,i){return this.As.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const dn="LocalStore";class di{constructor(e,t,n,i){this.persistence=e,this.bs=t,this.serializer=i,this.Ss=new hc(lZ),this.Ds=new uI(e=>uu(e),uc),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(n)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cQ(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ss))}}async function dr(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(r=>(i=r,e.Fs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let r=[],s=[],o=uP();for(let e of i)for(let t of(r.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({Ms:e,removedBatchIds:r,addedBatchIds:s}))})})}function ds(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ai.getLastRemoteSnapshotVersion(t))}async function da(e,t,n){let i=e.Ss.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,i))}catch(e){if(!hs(e))throw e;lx(dn,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ss=e.Ss.remove(t),e.Ds.delete(i.target)}function dl(e,t,n){let i=l3.min(),r=uP();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,n){let i=e.Ds.get(n);return void 0!==i?hr.resolve(e.Ss.get(i)):e.ai.getTargetData(t,n)})(e,s,um(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,e.ai.getMatchingKeysForTargetId(s,t.targetId).next(e=>{r=e})}).next(()=>e.bs.getDocumentsMatchingQuery(s,t,n?i:l3.min(),n?r:uP())).next(n=>{var i,s,o;let a;return i=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),o=n,a=i.vs.get(s)||l3.min(),o.forEach((e,t)=>{t.readTime.compareTo(a)>0&&(a=t.readTime)}),i.vs.set(s,a),{documents:n,Ns:r}}))}class dh{constructor(){this.activeTargetIds=uD}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class du{constructor(){this.So=new dh,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,n){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new dh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class dc{vo(e){}shutdown(){}}const dd="ConnectivityMonitor";class df{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){for(let e of(lx(dd,"Network connectivity changed: AVAILABLE"),this.Oo))e(0)}xo(){for(let e of(lx(dd,"Network connectivity changed: UNAVAILABLE"),this.Oo))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let dp=null;function dg(){return null===dp?dp=0x10000000+Math.round(0x80000000*Math.random()):dp++,"0x"+dp.toString(16)}const dm="RestConnection",dy={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class d_{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${n}/databases/${i}`,this.qo=this.databaseId.database===hP?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Qo(e,t,n,i,r){let s=dg(),o=this.$o(e,t.toUriEncodedString());lx(dm,`Sending RPC '${e}' ${s}:`,o,n);let a={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};this.Uo(a,i,r);let{host:l}=new URL(o),h=ea(l);return this.Ko(e,o,a,n,h).then(t=>(lx(dm,`Received RPC '${e}' ${s}: `,t),t),t=>{throw lL(dm,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Wo(e,t,n,i,r,s){return this.Qo(e,t,n,i,r)}Uo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+lR,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}$o(e,t){let n=dy[e];return`${this.Lo}/v1/${t}:${n}`}terminate(){}}class dv{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}}const dw="WebChannelConnection";class db extends d_{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,t,n,i,r){let s=dg();return new Promise((r,o)=>{let a=new C;a.setWithCredentials(!0),a.listenOnce(k.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case A.NO_ERROR:let t=a.getResponseJson();lx(dw,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),r(t);break;case A.TIMEOUT:lx(dw,`RPC '${e}' ${s} timed out`),o(new lj(lB.DEADLINE_EXCEEDED,"Request time out"));break;case A.HTTP_ERROR:let n=a.getStatus();if(lx(dw,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(lB).indexOf(t)>=0?t:lB.UNKNOWN}(t.status);o(new lj(e,t.message))}else o(new lj(lB.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new lj(lB.UNAVAILABLE,"Connection failed."));break;default:lU(9055,{s_:e,streamId:s,o_:a.getLastErrorCode(),__:a.getLastError()})}}finally{lx(dw,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(i);lx(dw,`RPC '${e}' ${s} sending request:`,i),a.send(t,"POST",l,n,15)})}a_(e,t,n){let i=dg(),r=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=D(),o=P(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Uo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let h=r.join("");lx(dw,`Creating RPC '${e}' stream ${i}: ${h}`,a);let u=s.createWebChannel(h,a),c=!1,d=!1,f=new dv({Go:t=>{d?lx(dw,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(c||(lx(dw,`Opening RPC '${e}' stream ${i} transport.`),u.open(),c=!0),lx(dw,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,S.EventType.OPEN,()=>{d||(lx(dw,`RPC '${e}' stream ${i} transport opened.`),f.t_())}),p(u,S.EventType.CLOSE,()=>{d||(d=!0,lx(dw,`RPC '${e}' stream ${i} transport closed`),f.r_())}),p(u,S.EventType.ERROR,t=>{d||(d=!0,lL(dw,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),f.r_(new lj(lB.UNAVAILABLE,"The operation could not be completed")))}),p(u,S.EventType.MESSAGE,t=>{var n;if(!d){let r=t.data[0];lV(!!r,16349);let s=(null==r?void 0:r.error)||(null==(n=r[0])?void 0:n.error);if(s){lx(dw,`RPC '${e}' stream ${i} received error:`,s);let t=s.status,n=function(e){let t=M[e];if(void 0!==t)return u9(t)}(t),r=s.message;void 0===n&&(n=lB.INTERNAL,r="Unknown error status: "+t+" with message "+s.message),d=!0,f.r_(new lj(n,r)),u.close()}else lx(dw,`RPC '${e}' stream ${i} received:`,r),f.i_(r)}}),p(o,R.STAT_EVENT,t=>{t.stat===N.PROXY?lx(dw,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===N.NOPROXY&&lx(dw,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{f.n_()},0),f}}function dE(){return"undefined"!=typeof document?document:null}function dI(e){return new cy(e,!0)}class dT{constructor(e,t,n=1e3,i=1.5,r=6e4){this.bi=e,this.timerId=t,this.u_=n,this.c_=i,this.l_=r,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();let t=Math.floor(this.h_+this.d_()),n=Math.max(0,Date.now()-this.T_),i=Math.max(0,t-n);i>0&&lx("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,i,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){null!==this.P_&&(this.P_.skipDelay(),this.P_=null)}cancel(){null!==this.P_&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}const dC="PersistentStream";class dS{constructor(e,t,n,i,r,s,o,a){this.bi=e,this.R_=n,this.V_=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new dT(e,t)}w_(){return 1===this.state||5===this.state||this.b_()}b_(){return 2===this.state||3===this.state}start(){this.p_=0,4!==this.state?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&null===this.f_&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(e,t){this.M_(),this.x_(),this.y_.cancel(),this.m_++,4!==e?this.y_.reset():t&&t.code===lB.RESOURCE_EXHAUSTED?(lO(t.toString()),lO("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===lB.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zo(t)}O_(){}auth(){this.state=1;let e=this.N_(this.m_),t=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.m_===t&&this.B_(e,n)},t=>{e(()=>{let e=new lj(lB.UNKNOWN,"Fetching auth token failed: "+t.message);return this.L_(e)})})}B_(e,t){let n=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo(()=>{n(()=>this.listener.jo())}),this.stream.Jo(()=>{n(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(e=>{n(()=>this.L_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.p_?this.q_(e):this.onNext(e))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(e){return lx(dC,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return t=>{this.bi.enqueueAndForget(()=>this.m_===e?t():(lx(dC,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dk extends dS{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();let t=function(e,t){let n;if("targetChange"in t){var i,r;t.targetChange;let s="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:lU(39313,{state:i}),o=t.targetChange.targetIds||[],a=(r=t.targetChange.resumeToken,e.useProto3Json?(lV(void 0===r||"string"==typeof r,58123),h_.fromBase64String(r||"")):(lV(void 0===r||r instanceof a6||r instanceof Uint8Array,16193),h_.fromUint8Array(r||new Uint8Array))),l=t.targetChange.cause;n=new ch(s,o,a,l&&new lj(void 0===l.code?lB.UNKNOWN:u9(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=cS(e,i.document.name),s=cb(i.document.updateTime),o=i.document.createTime?cb(i.document.createTime):l3.min(),a=new hZ({mapValue:{fields:i.document.fields}}),l=h0.newFoundDocument(r,s,o,a);n=new ca(i.targetIds||[],i.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=cS(e,i.document),s=i.readTime?cb(i.readTime):l3.min(),o=h0.newNoDocument(r,s);n=new ca([],i.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=cS(e,i.document);n=new ca([],i.removedTargetIds||[],r,null)}else{if(!("filter"in t))return lU(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:i=0,unchangedNames:r}=e,s=new u7(i,r);n=new cl(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return l3.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?l3.min():t.readTime?cb(t.readTime):l3.min()}(e);return this.listener.Q_(t,n)}U_(e){let t={};t.database=cA(this.serializer),t.addTarget=function(e,t){let n,i=t.target;if((n=ud(i)?{documents:{documents:[ck(e,i.path)]}}:{query:function(e,t){var n,i;let r,s={structuredQuery:{}},o=t.path;null!==t.collectionGroup?(r=o,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=o.popLast(),s.structuredQuery.from=[{collectionId:o.lastSegment()}]),s.parent=ck(e,r);let a=function(e){if(0!==e.length)return function e(t){return t instanceof h4?function(e){if("=="===e.op){if(hG(e.value))return{unaryFilter:{field:cP(e.field),op:"IS_NAN"}};if(hK(e.value))return{unaryFilter:{field:cP(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(hG(e.value))return{unaryFilter:{field:cP(e.field),op:"IS_NOT_NAN"}};if(hK(e.value))return{unaryFilter:{field:cP(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cP(e.field),op:cg[e.op],value:e.value}}}(t):t instanceof h8?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:cm[t.op],filters:n}}}(t):lU(54877,{filter:t})}(h8.create(e,"and"))}(t.filters);a&&(s.structuredQuery.where=a);let l=function(e){if(0!==e.length)return e.map(e=>({field:cP(e.field),direction:cp[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let h=c_(e,t.limit);return null!==h&&(s.structuredQuery.limit=h),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(i=t.endAt).inclusive,values:i.position}),{gt:s,parent:r}}(e,i).gt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=cw(e,t.resumeToken);let i=c_(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(l3.min())>0){n.readTime=cv(e,t.snapshotVersion.toTimestamp());let i=c_(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return lU(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.F_(t)}K_(e){let t={};t.database=cA(this.serializer),t.removeTarget=e,this.F_(t)}}class dA extends dS{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return lV(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,lV(!e.writeResults||0===e.writeResults.length,55816),this.listener.z_()}onNext(e){var t,n;lV(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();let i=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(lV(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?cb(e.updateTime):cb(n)).isEqual(l3.min())&&(t=cb(n)),new uH(t,e.transformResults||[])})):[]),r=cb(e.commitTime);return this.listener.j_(r,i)}H_(){let e={};e.database=cA(this.serializer),this.F_(e)}G_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n;let i;if(t instanceof uX)i={update:cR(e,t.key,t.value)};else if(t instanceof u6)i={delete:cC(e,t.key)};else if(t instanceof uZ)i={update:cR(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof u3))return lU(16599,{ft:t.type});i={verify:cC(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof uU)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof uF)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof uB)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof uq)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw lU(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:cv(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:lU(27497)),i})(this.serializer,e))};this.F_(t)}}class dN{}class dR extends dN{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.J_=!1}Y_(){if(this.J_)throw new lj(lB.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,t,n,i){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.Qo(e,cI(t,n),i,r,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===lB.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new lj(lB.UNKNOWN,e.toString())})}Wo(e,t,n,i,r){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,cI(t,n),i,s,o,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===lB.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new lj(lB.UNKNOWN,e.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class dP{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){0===this.Z_&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){"Online"===this.state?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,"Online"===e&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(lO(t),this.ea=!1):lx("OnlineStateTracker",t)}sa(){null!==this.X_&&(this.X_.cancel(),this.X_=null)}}const dD="RemoteStore";class dx{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=r,this.ca.vo(e=>{n.enqueueAndForget(async()=>{dq(this)&&(lx(dD,"Restarting streams for network reachability change."),await async function(e){e.aa.add(4),await dL(e),e.la.set("Unknown"),e.aa.delete(4),await dO(e)}(this))})}),this.la=new dP(n,i)}}async function dO(e){if(dq(e))for(let t of e.ua)await t(!0)}async function dL(e){for(let t of e.ua)await t(!1)}function dM(e,t){e._a.has(t.targetId)||(e._a.set(t.targetId,t),dj(e)?dB(e):d3(e).b_()&&dF(e,t))}function dU(e,t){let n=d3(e);e._a.delete(t),n.b_()&&dV(e,t),0===e._a.size&&(n.b_()?n.v_():dq(e)&&e.la.set("Unknown"))}function dF(e,t){if(e.ha.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(l3.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}d3(e).U_(t)}function dV(e,t){e.ha.Ke(t),d3(e).K_(t)}function dB(e){e.ha=new cc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e._a.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),d3(e).start(),e.la.ta()}function dj(e){return dq(e)&&!d3(e).w_()&&e._a.size>0}function dq(e){return 0===e.aa.size}async function d$(e){e.la.set("Online")}async function dz(e){e._a.forEach((t,n)=>{dF(e,t)})}async function dH(e,t){e.ha=void 0,dj(e)?(e.la.ia(t),dB(e)):e.la.set("Unknown")}async function dW(e,t,n){if(e.la.set("Online"),t instanceof ch&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let i of t.targetIds)e._a.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e._a.delete(i),e.ha.removeTarget(i))}(e,t)}catch(n){lx(dD,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await dK(e,n)}else if(t instanceof ca?e.ha.Xe(t):t instanceof cl?e.ha.ot(t):e.ha.nt(t),!n.isEqual(l3.min()))try{let t=await ds(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.ha.It(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){let r=e._a.get(i);r&&e._a.set(i,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let i=e._a.get(t);if(!i)return;e._a.set(t,i.withResumeToken(h_.EMPTY_BYTE_STRING,i.snapshotVersion)),dV(e,t);let r=new cO(i.target,t,n,i.sequenceNumber);dF(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){lx(dD,"Failed to raise snapshot:",t),await dK(e,t)}}async function dK(e,t,n){if(!hs(t))throw t;e.aa.add(1),await dL(e),e.la.set("Offline"),n||(n=()=>ds(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{lx(dD,"Retrying IndexedDB access"),await n(),e.aa.delete(1),await dO(e)})}function dG(e,t){return t().catch(n=>dK(e,n,t))}async function dQ(e){var t;let n=d5(e),i=e.oa.length>0?e.oa[e.oa.length-1].batchId:-1;for(;dq(t=e)&&t.oa.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,i);if(null===t){0===e.oa.length&&n.v_();break}i=t.batchId,function(e,t){e.oa.push(t);let n=d5(e);n.b_()&&n.W_&&n.G_(t.mutations)}(e,t)}catch(t){await dK(e,t)}dY(e)&&dJ(e)}function dY(e){return dq(e)&&!d5(e).w_()&&e.oa.length>0}function dJ(e){d5(e).start()}async function dX(e){d5(e).H_()}async function dZ(e){let t=d5(e);for(let n of e.oa)t.G_(n.mutations)}async function d0(e,t,n){let i=e.oa.shift(),r=u4.from(i,t,n);await dG(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await dQ(e)}async function d1(e,t){t&&d5(e).W_&&await async function(e,t){var n;if(function(e){switch(e){case lB.OK:return lU(64938);case lB.CANCELLED:case lB.UNKNOWN:case lB.DEADLINE_EXCEEDED:case lB.RESOURCE_EXHAUSTED:case lB.INTERNAL:case lB.UNAVAILABLE:case lB.UNAUTHENTICATED:return!1;case lB.INVALID_ARGUMENT:case lB.NOT_FOUND:case lB.ALREADY_EXISTS:case lB.PERMISSION_DENIED:case lB.FAILED_PRECONDITION:case lB.ABORTED:case lB.OUT_OF_RANGE:case lB.UNIMPLEMENTED:case lB.DATA_LOSS:return!0;default:return lU(15467,{code:e})}}(n=t.code)&&n!==lB.ABORTED){let n=e.oa.shift();d5(e).D_(),await dG(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await dQ(e)}}(e,t),dY(e)&&dJ(e)}async function d2(e,t){e.asyncQueue.verifyOperationInProgress(),lx(dD,"RemoteStore received new credentials");let n=dq(e);e.aa.add(3),await dL(e),n&&e.la.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.aa.delete(3),await dO(e)}async function d6(e,t){t?(e.aa.delete(2),await dO(e)):t||(e.aa.add(2),await dL(e),e.la.set("Unknown"))}function d3(e){var t,n,i;return e.Pa||(t=e.datastore,n=e.asyncQueue,i={jo:d$.bind(null,e),Jo:dz.bind(null,e),Zo:dH.bind(null,e),Q_:dW.bind(null,e)},t.Y_(),e.Pa=new dk(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i),e.ua.push(async t=>{t?(e.Pa.D_(),dj(e)?dB(e):e.la.set("Unknown")):(await e.Pa.stop(),e.ha=void 0)})),e.Pa}function d5(e){var t,n,i;return e.Ta||(t=e.datastore,n=e.asyncQueue,i={jo:()=>Promise.resolve(),Jo:dX.bind(null,e),Zo:d1.bind(null,e),z_:dZ.bind(null,e),j_:d0.bind(null,e)},t.Y_(),e.Ta=new dA(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i),e.ua.push(async t=>{t?(e.Ta.D_(),await dQ(e)):(await e.Ta.stop(),e.oa.length>0&&(lx(dD,`Stopping write stream with ${e.oa.length} pending writes`),e.oa=[]))})),e.Ta}class d4{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new lq,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,r){let s=new d4(e,t,Date.now()+n,i,r);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new lj(lB.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function d8(e,t){if(lO("AsyncQueue",`${t}: ${e}`),hs(e))return new lj(lB.UNAVAILABLE,`${t}: ${e}`);throw e}class d7{static emptySet(e){return new d7(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||he.comparator(t.key,n.key):(e,t)=>he.comparator(e.key,t.key),this.keyedMap=uS(),this.sortedSet=new hc(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof d7)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new d7;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class d9{constructor(){this.Ia=new hc(he.comparator)}track(e){let t=e.doc.key,n=this.Ia.get(t);n?0!==e.type&&3===n.type?this.Ia=this.Ia.insert(t,e):3===e.type&&1!==n.type?this.Ia=this.Ia.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Ia=this.Ia.remove(t):1===e.type&&2===n.type?this.Ia=this.Ia.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):lU(63341,{Vt:e,Ea:n}):this.Ia=this.Ia.insert(t,e)}da(){let e=[];return this.Ia.inorderTraversal((t,n)=>{e.push(n)}),e}}class fe{constructor(e,t,n,i,r,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new fe(e,t,d7.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&u_(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class ft{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}}class fn{constructor(){this.queries=fi(),this.onlineState="Unknown",this.fa=new Set}terminate(){!function(e,t){let n=e.queries;e.queries=fi(),n.forEach((e,n)=>{for(let e of n.Ra)e.onError(t)})}(this,new lj(lB.ABORTED,"Firestore shutting down"))}}function fi(){return new uI(e=>uv(e),u_)}async function fr(e,t){let n=3,i=t.query,r=e.queries.get(i);r?!r.Va()&&t.ma()&&(n=2):(r=new ft,n=+!t.ma());try{switch(n){case 0:r.Aa=await e.onListen(i,!0);break;case 1:r.Aa=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(n){let e=d8(n,`Initialization of query '${uw(t.query)}' failed`);return void t.onError(e)}e.queries.set(i,r),r.Ra.push(t),t.ga(e.onlineState),r.Aa&&t.pa(r.Aa)&&fl(e)}async function fs(e,t){let n=t.query,i=3,r=e.queries.get(n);if(r){let e=r.Ra.indexOf(t);e>=0&&(r.Ra.splice(e,1),0===r.Ra.length?i=+!t.ma():!r.Va()&&t.ma()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function fo(e,t){let n=!1;for(let i of t){let t=i.query,r=e.queries.get(t);if(r){for(let e of r.Ra)e.pa(i)&&(n=!0);r.Aa=i}}n&&fl(e)}function fa(e,t,n){let i=e.queries.get(t);if(i)for(let e of i.Ra)e.onError(n);e.queries.delete(t)}function fl(e){e.fa.forEach(e=>{e.next()})}(V=F||(F={})).ya="default",V.Cache="cache";class fh{constructor(e,t,n){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=n||{}}pa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new fe(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ba?this.Da(e)&&(this.wa.next(e),t=!0):this.va(e,this.onlineState)&&(this.Ca(e),t=!0),this.Sa=e,t}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){return!(e.fromCache&&this.ma())||(!this.options.Fa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Da(e){if(e.docChanges.length>0)return!0;let t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Ca(e){e=fe.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==F.Cache}}class fu{constructor(e){this.key=e}}class fc{constructor(e){this.key=e}}class fd{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=uP(),this.mutatedKeys=uP(),this.Ua=uE(e),this.Ka=new d7(this.Ua)}get Wa(){return this.qa}Ga(e,t){let n=t?t.za:new d9,i=t?t.Ka:this.Ka,r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1,a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{let h=i.get(e),u=ub(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.ja(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Ua(u,a)>0||l&&0>this.Ua(u,l))&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{Ka:s,za:n,ys:o,mutatedKeys:r}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let r=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;let s=e.za.da();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return lU(20277,{Vt:e})}};return n(e)-n(t)})(e.type,t.type)||this.Ua(e.doc,t.doc)),this.Ha(n),i=null!=i&&i;let o=t&&!i?this.Ja():[],a=0===this.$a.size&&this.current&&!i?1:0,l=a!==this.Qa;return(this.Qa=a,0!==s.length||l)?{snapshot:new fe(this.query,e.Ka,r,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ya:o}:{Ya:o}}ga(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new d9,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(e=>this.qa=this.qa.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qa=this.qa.delete(e)),this.current=e.current)}Ja(){if(!this.current)return[];let e=this.$a;this.$a=uP(),this.Ka.forEach(e=>{this.Za(e.key)&&(this.$a=this.$a.add(e.key))});let t=[];return e.forEach(e=>{this.$a.has(e)||t.push(new fc(e))}),this.$a.forEach(n=>{e.has(n)||t.push(new fu(n))}),t}Xa(e){this.qa=e.Ns,this.$a=uP();let t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return fe.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,0===this.Qa,this.hasCachedResults)}}const ff="SyncEngine";class fp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class fg{constructor(e){this.key=e,this.tu=!1}}class fm{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.nu={},this.ru=new uI(e=>uv(e),u_),this.iu=new Map,this.su=new Set,this.ou=new hc(he.comparator),this._u=new Map,this.au=new cZ,this.uu={},this.cu=new Map,this.lu=cj.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return!0===this.hu}}async function fy(e,t,n=!0){let i,r=fF(e),s=r.ru.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.eu()):i=await fv(r,t,n,!0),i}async function f_(e,t){let n=fF(e);await fv(n,t,!0,!1)}async function fv(e,t,n,i){var r,s;let o,a=await (r=e.localStore,s=um(t),r.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return r.ai.getTargetData(e,s).next(n=>n?(t=n,hr.resolve(t)):r.ai.allocateTargetId(e).next(n=>(t=new cO(s,n,"TargetPurposeListen",e.currentSequenceNumber),r.ai.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=r.Ss.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(r.Ss=r.Ss.insert(e.targetId,e),r.Ds.set(s,e.targetId)),e})),l=a.targetId,h=e.sharedClientState.addLocalQueryTarget(l,n);return i&&(o=await fw(e,t,l,"current"===h,a.resumeToken)),e.isPrimaryClient&&n&&dM(e.remoteStore,a),o}async function fw(e,t,n,i,r){e.Pu=(t,n,i)=>(async function(e,t,n,i){let r=t.view.Ga(n);r.ys&&(r=await dl(e.localStore,t.query,!1).then(({documents:e})=>t.view.Ga(e,r)));let s=i&&i.targetChanges.get(t.targetId),o=i&&null!=i.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s,o);return fx(e,t.targetId,a.Ya),a.snapshot})(e,t,n,i);let s=await dl(e.localStore,t,!0),o=new fd(t,s.Ns),a=o.Ga(s.documents),l=co.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),h=o.applyChanges(a,e.isPrimaryClient,l);fx(e,n,h.Ya);let u=new fp(t,n,o);return e.ru.set(t,u),e.iu.has(n)?e.iu.get(n).push(t):e.iu.set(n,[t]),h.snapshot}async function fb(e,t,n){let i=e.ru.get(t),r=e.iu.get(i.targetId);if(r.length>1)return e.iu.set(i.targetId,r.filter(e=>!u_(e,t))),void e.ru.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(i.targetId),e.sharedClientState.isActiveQueryTarget(i.targetId)||await da(e.localStore,i.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(i.targetId),n&&dU(e.remoteStore,i.targetId),fP(e,i.targetId)}).catch(hi)):(fP(e,i.targetId),await da(e.localStore,i.targetId,!0))}async function fE(e,t){let n=e.ru.get(t),i=e.iu.get(n.targetId);e.isPrimaryClient&&1===i.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),dU(e.remoteStore,n.targetId))}async function fI(e,t,n){var i,r;let s=((i=e).remoteStore.remoteSyncer.applySuccessfulWrite=fk.bind(null,i),i.remoteStore.remoteSyncer.rejectFailedWrite=fA.bind(null,i),i);try{let e,i=await function(e,t){let n,i,r=l6.now(),s=t.reduce((e,t)=>e.add(t.key),uP());return e.persistence.runTransaction("Locally write mutations","readwrite",o=>{let a=uT,l=uP();return e.Cs.getEntries(o,s).next(e=>{(a=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(o,a)).next(i=>{n=i;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let i of e.fieldTransforms){let e=t.data.field(i.field),r=uM(i.transform,e||null);null!=r&&(null===n&&(n=hZ.empty()),n.set(i.field,r))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new uZ(e.key,t,function e(t){let n=[];return hh(t.fields,(t,i)=>{let r=new l9([t]);if(hQ(i)){let t=e(i.mapValue).fields;if(0===t.length)n.push(r);else for(let e of t)n.push(r.child(e))}else n.push(r)}),new hm(n)}(t.value.mapValue),uW.exists(!0)))}return e.mutationQueue.addMutationBatch(o,r,s,t)}).next(t=>{i=t;let r=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(o,t.batchId,r)})}).then(()=>({batchId:i.batchId,changes:uk(n)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(i.batchId),r=i.batchId,(e=s.uu[s.currentUser.toKey()])||(e=new hc(lZ)),e=e.insert(r,n),s.uu[s.currentUser.toKey()]=e,await fL(s,i.changes),await dQ(s.remoteStore)}catch(t){let e=d8(t,"Failed to persist write");n.reject(e)}}async function fT(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,i=e.Ss;return e.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{var s,o,a;let l,h,u=e.Cs.newChangeBuffer({trackRemovals:!0});i=e.Ss;let c=[];t.targetChanges.forEach((s,o)=>{var a;let l=i.get(o);if(!l)return;c.push(e.ai.removeMatchingKeys(r,s.removedDocuments,o).next(()=>e.ai.addMatchingKeys(r,s.addedDocuments,o)));let h=l.withSequenceNumber(r.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(h_.EMPTY_BYTE_STRING,l3.min()).withLastLimboFreeSnapshotVersion(l3.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),a=h,(0===l.resumeToken.approximateByteSize()||a.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(e.ai.updateTargetData(r,h))});let d=uT,f=uP();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(r,n))}),c.push((s=r,o=u,a=t.documentUpdates,l=uP(),h=uP(),a.forEach(e=>l=l.add(e)),o.getEntries(s,l).next(e=>{let t=uT;return a.forEach((n,i)=>{let r=e.get(n);i.isFoundDocument()!==r.isFoundDocument()&&(h=h.add(n)),i.isNoDocument()&&i.version.isEqual(l3.min())?(o.removeEntry(n,i.readTime),t=t.insert(n,i)):!r.isValidDocument()||i.version.compareTo(r.version)>0||0===i.version.compareTo(r.version)&&r.hasPendingWrites?(o.addEntry(i),t=t.insert(n,i)):lx(dn,"Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",i.version)}),{xs:t,Os:h}})).next(e=>{d=e.xs,f=e.Os})),!n.isEqual(l3.min())){let t=e.ai.getLastRemoteSnapshotVersion(r).next(t=>e.ai.setTargetsMetadata(r,r.currentSequenceNumber,n));c.push(t)}return hr.waitFor(c).next(()=>u.apply(r)).next(()=>e.localDocuments.getLocalViewOfDocuments(r,d,f)).next(()=>d)}).then(t=>(e.Ss=i,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let i=e._u.get(n);i&&(lV(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?i.tu=!0:t.modifiedDocuments.size>0?lV(i.tu,14607):t.removedDocuments.size>0&&(lV(i.tu,42227),i.tu=!1))}),await fL(e,n,t)}catch(e){await hi(e)}}function fC(e,t,n){var i;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,r=[];e.ru.forEach((e,n)=>{let i=n.view.ga(t);i.snapshot&&r.push(i.snapshot)}),(i=e.eventManager).onlineState=t,n=!1,i.queries.forEach((e,i)=>{for(let e of i.Ra)e.ga(t)&&(n=!0)}),n&&fl(i),r.length&&e.nu.Q_(r),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function fS(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let i=e._u.get(t),r=i&&i.key;if(r){let n=new hc(he.comparator);n=n.insert(r,h0.newNoDocument(r,l3.min()));let i=uP().add(r),s=new cs(l3.min(),new Map,new hc(lZ),n,i);await fT(e,s),e.ou=e.ou.remove(r),e._u.delete(t),fO(e)}else await da(e.localStore,t,!1).then(()=>fP(e,t,n)).catch(hi)}async function fk(e,t){var n;let i=t.batch.batchId;try{let r=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let i=t.batch.keys(),r=n.Cs.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,i){let r=n.batch,s=r.keys(),o=hr.resolve();return s.forEach(e=>{o=o.next(()=>i.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);lV(null!==s,48541),0>t.version.compareTo(s)&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,r))})(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=uP();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,i))}));fR(e,i,null),fN(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await fL(e,r)}catch(e){await hi(e)}}async function fA(e,t,n){var i;try{let r=await (i=e.localStore,i.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return i.mutationQueue.lookupMutationBatch(e,t).next(t=>(lV(null!==t,37113),n=t.keys(),i.mutationQueue.removeMutationBatch(e,t))).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>i.localDocuments.getDocuments(e,n))}));fR(e,t,n),fN(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await fL(e,r)}catch(e){await hi(e)}}function fN(e,t){(e.cu.get(t)||[]).forEach(e=>{e.resolve()}),e.cu.delete(t)}function fR(e,t,n){let i=e.uu[e.currentUser.toKey()];if(i){let r=i.get(t);r&&(n?r.reject(n):r.resolve(),i=i.remove(t)),e.uu[e.currentUser.toKey()]=i}}function fP(e,t,n=null){for(let i of(e.sharedClientState.removeLocalQueryTarget(t),e.iu.get(t)))e.ru.delete(i),n&&e.nu.Tu(i,n);e.iu.delete(t),e.isPrimaryClient&&e.au.Ur(t).forEach(t=>{e.au.containsKey(t)||fD(e,t)})}function fD(e,t){e.su.delete(t.path.canonicalString());let n=e.ou.get(t);null!==n&&(dU(e.remoteStore,n),e.ou=e.ou.remove(t),e._u.delete(n),fO(e))}function fx(e,t,n){for(let i of n)i instanceof fu?(e.au.addReference(i.key,t),function(e,t){let n=t.key,i=n.path.canonicalString();e.ou.get(n)||e.su.has(i)||(lx(ff,"New document in limbo: "+n),e.su.add(i),fO(e))}(e,i)):i instanceof fc?(lx(ff,"Document no longer in limbo: "+i.key),e.au.removeReference(i.key,t),e.au.containsKey(i.key)||fD(e,i.key)):lU(19791,{Iu:i})}function fO(e){for(;e.su.size>0&&e.ou.size<e.maxConcurrentLimboResolutions;){let t=e.su.values().next().value;e.su.delete(t);let n=new he(l8.fromString(t)),i=e.lu.next();e._u.set(i,new fg(n)),e.ou=e.ou.insert(n,i),dM(e.remoteStore,new cO(um(new uf(n.path)),i,"TargetPurposeLimboResolution",ho.le))}}async function fL(e,t,n){let i=[],r=[],s=[];e.ru.isEmpty()||(e.ru.forEach((o,a)=>{s.push(e.Pu(a,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let i=t?!t.fromCache:null==(s=null==n?void 0:n.targetChanges.get(a.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);let e=c9.Ps(a.targetId,t);r.push(e)}}))}),await Promise.all(s),e.nu.Q_(i),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>hr.forEach(t,t=>hr.forEach(t.ls,i=>e.persistence.referenceDelegate.addReference(n,t.targetId,i)).next(()=>hr.forEach(t.hs,i=>e.persistence.referenceDelegate.removeReference(n,t.targetId,i)))))}catch(e){if(!hs(e))throw e;lx(dn,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ss.get(t),i=n.snapshotVersion,r=n.withLastLimboFreeSnapshotVersion(i);e.Ss=e.Ss.insert(t,r)}}}(e.localStore,r))}async function fM(e,t){if(!e.currentUser.isEqual(t)){lx(ff,"User change. New user:",t.toKey());let n=await dr(e.localStore,t);e.currentUser=t,e.cu.forEach(e=>{e.forEach(e=>{e.reject(new lj(lB.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.cu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await fL(e,n.Ms)}}function fU(e,t){let n=e._u.get(t);if(n&&n.tu)return uP().add(n.key);{let n=uP(),i=e.iu.get(t);if(!i)return n;for(let t of i){let i=e.ru.get(t);n=n.unionWith(i.view.Wa)}return n}}function fF(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=fT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fS.bind(null,e),e.nu.Q_=fo.bind(null,e.eventManager),e.nu.Tu=fa.bind(null,e.eventManager),e}class fV{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dI(e.databaseInfo.databaseId),this.sharedClientState=this.Au(e),this.persistence=this.Ru(e),await this.persistence.start(),this.localStore=this.Vu(e),this.gcScheduler=this.mu(e,this.localStore),this.indexBackfillerScheduler=this.fu(e,this.localStore)}mu(e,t){return null}fu(e,t){return null}Vu(e){var t,n;return t=this.persistence,n=new dt,new di(t,n,e.initialUser,this.serializer)}Ru(e){return new c5(c8.Ei,this.serializer)}Au(e){return new du}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fV.provider={build:()=>new fV};class fB extends fV{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){return lV(this.persistence.referenceDelegate instanceof c7,46915),new cH(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ru(e){let t=void 0!==this.cacheSizeBytes?cB.withCacheSize(this.cacheSizeBytes):cB.DEFAULT;return new c5(e=>c7.Ei(e,t),this.serializer)}}class fj{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>fC(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=fM.bind(null,this.syncEngine),await d6(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new fn}createDatastore(e){var t;let n=dI(e.databaseInfo.databaseId),i=new db(e.databaseInfo);return t=e.authCredentials,new dR(t,e.appCheckCredentials,i,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new dx(t,n,e.asyncQueue,e=>fC(this.syncEngine,e,0),df.C()?new df:new dc)}createSyncEngine(e,t){return function(e,t,n,i,r,s,o){let a=new fm(e,t,n,i,r,s);return o&&(a.hu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){lx(dD,"RemoteStore shutting down."),e.aa.add(5),await dL(e),e.ca.shutdown(),e.la.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}fj.provider={build:()=>new fj};class fq{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):lO("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const f$="FirestoreClient";class fz{constructor(e,t,n,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=lN.UNAUTHENTICATED,this.clientId=lX.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{lx(f$,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(lx(f$,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new lq;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=d8(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function fH(e,t){e.asyncQueue.verifyOperationInProgress(),lx(f$,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await dr(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function fW(e,t){e.asyncQueue.verifyOperationInProgress();let n=await fK(e);lx(f$,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>d2(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>d2(t.remoteStore,n)),e._onlineComponents=t}async function fK(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){lx(f$,"Using user provided OfflineComponentProvider");try{await fH(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===lB.FAILED_PRECONDITION||t.code===lB.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;lL("Error using user provided cache. Falling back to memory cache: "+t),await fH(e,new fV)}}else lx(f$,"Using default OfflineComponentProvider"),await fH(e,new fB(void 0));return e._offlineComponents}async function fG(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(lx(f$,"Using user provided OnlineComponentProvider"),await fW(e,e._uninitializedComponentsProvider._online)):(lx(f$,"Using default OnlineComponentProvider"),await fW(e,new fj))),e._onlineComponents}async function fQ(e){let t=await fG(e),n=t.eventManager;return n.onListen=fy.bind(null,t.syncEngine),n.onUnlisten=fb.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=f_.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=fE.bind(null,t.syncEngine),n}function fY(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const fJ=new Map;function fX(e){if(!he.isDocumentKey(e))throw new lj(lB.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function fZ(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":lU(12329,{type:typeof e})}function f0(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new lj(lB.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=fZ(e);throw new lj(lB.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}const f1="firestore.googleapis.com";class f2{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new lj(lB.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=f1,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new lj(lB.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new lj(lB.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fY(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new lj(lB.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new lj(lB.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new lj(lB.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class f6{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new f2({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new lj(lB.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new lj(lB.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new f2(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new lz;switch(e.type){case"firstParty":return new lG(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new lj(lB.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,ed("Firestore",this._settings.isUsingEmulator),this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=fJ.get(e);t&&(lx("ComponentProvider","Removing Datastore"),fJ.delete(e),t.terminate())}(this),Promise.resolve()}}class f3{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new f3(this.firestore,e,this._query)}}class f5{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new f4(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new f5(this.firestore,e,this._key)}}class f4 extends f3{constructor(e,t,n){super(e,t,new uf(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new f5(this.firestore,null,new he(e))}withConverter(e){return new f4(this.firestore,e,this._path)}}function f8(e,t,...n){if(e=eV(e),1==arguments.length&&(t=lX.newId()),function(e,t,n){if(!n)throw new lj(lB.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof f6){let i=l8.fromString(t,...n);return fX(i),new f5(e,null,new he(i))}{if(!(e instanceof f5||e instanceof f4))throw new lj(lB.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(l8.fromString(t,...n));return fX(i),new f5(e.firestore,e instanceof f4?e.converter:null,new he(i))}}const f7="AsyncQueue";class f9{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new dT(this,"async_queue_retry"),this.ju=()=>{let e=dE();e&&lx(f7,"Visibility state changed to "+e.visibilityState),this.y_.A_()},this.Hu=e;let t=dE();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;let t=dE();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});let t=new lq;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}async Zu(){if(0!==this.Qu.length){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!hs(e))throw e;lx(f7,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}}Yu(e){let t=this.Hu.then(()=>(this.Wu=!0,e().catch(e=>{throw this.Ku=e,this.Wu=!1,lO("INTERNAL UNHANDLED ERROR: ",pe(e)),e}).then(e=>(this.Wu=!1,e))));return this.Hu=t,t}enqueueAfterDelay(e,t,n){this.Ju(),this.zu.indexOf(e)>-1&&(t=0);let i=d4.createAndSchedule(this,e,t,n,e=>this.Xu(e));return this.Uu.push(i),i}Ju(){this.Ku&&lU(47125,{ec:pe(this.Ku)})}verifyOperationInProgress(){}async tc(){let e;do e=this.Hu,await e;while(e!==this.Hu)}nc(e){for(let t of this.Uu)if(t.timerId===e)return!0;return!1}rc(e){return this.tc().then(()=>{for(let t of(this.Uu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Uu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){let t=this.Uu.indexOf(e);this.Uu.splice(t,1)}}function pe(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class pt extends f6{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new f9,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new f9(e),this._firestoreClient=void 0,await e}}}function pn(e){if(e._terminated)throw new lj(lB.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,i,r,s;let o=e._freezeSettings(),a=(r=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new hR(r,s,e._persistenceKey,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,fY(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator));e._componentsProvider||(null==(n=o.localCache)?void 0:n._offlineComponentProvider)&&(null==(i=o.localCache)?void 0:i._onlineComponentProvider)&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new fz(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class pi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new pi(h_.fromBase64String(e))}catch(e){throw new lj(lB.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new pi(h_.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class pr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new lj(lB.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new l9(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ps{constructor(e){this._methodName=e}}class po{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new lj(lB.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new lj(lB.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return lZ(this._lat,e._lat)||lZ(this._long,e._long)}}class pa{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const pl=/^__.*__$/;class ph{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new uZ(e,this.data,this.fieldMask,t,this.fieldTransforms):new uX(e,this.data,t,this.fieldTransforms)}}function pu(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw lU(40011,{oc:e})}}class pc{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this._c(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new pc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i.lc(e),i}hc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i._c(),i}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return py(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(0===e.length)throw this.Tc("Document fields must not be empty");if(pu(this.oc)&&pl.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}}class pd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||dI(e)}dc(e,t,n,i=!1){return new pc({oc:e,methodName:t,Ec:n,path:l9.emptyPath(),cc:!1,Ic:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function pf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof l6||e instanceof po||e instanceof pi||e instanceof f5||e instanceof ps||e instanceof pa)}function pp(e,t,n){if(!pf(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let i=fZ(n);throw"an object"===i?t.Tc(e+" a custom object"):t.Tc(e+" "+i)}}const pg=RegExp("[~\\*/\\[\\]]");function pm(e,t,n){if(t.search(pg)>=0)throw py(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new pr(...t.split("."))._internalPath}catch(i){throw py(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function py(e,t,n,i,r){let s=i&&!i.isEmpty(),o=void 0!==r,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new lj(lB.INVALID_ARGUMENT,a+e+l)}class p_{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new f5(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new pv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(pw("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class pv extends p_{data(){return super.data()}}function pw(e,t){return"string"==typeof t?pm(e,t):t instanceof pr?t._internalPath:t._delegate._internalPath}class pb{convertValue(e,t="none"){switch(hF(e)){case 0:return null;case 1:return e.booleanValue;case 2:return hb(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(hE(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw lU(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return hh(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,i;return new pa(null==(i=null==(n=null==(t=e.fields)?void 0:t[hU].arrayValue)?void 0:n.values)?void 0:i.map(e=>hb(e.doubleValue)))}convertGeoPoint(e){return new po(hb(e.latitude),hb(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=hA(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(hN(e));default:return null}}convertTimestamp(e){let t=hw(e);return new l6(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=l8.fromString(e);lV(cx(n),9688,{name:e});let i=new hD(n.get(1),n.get(3)),r=new he(n.popFirst(5));return i.isEqual(t)||lO(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class pE{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pI extends p_{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new pT(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(pw("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class pT extends pI{data(e={}){return super.data(e)}}function pC(e){e=f0(e,f5);let t=f0(e.firestore,pt);return(function(e,t,n={}){let i=new lq;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,i,r){let s=new fq({next:a=>{s.yu(),t.enqueueAndForget(()=>fs(e,o));let l=a.docs.has(n);!l&&a.fromCache?r.reject(new lj(lB.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&i&&"server"===i.source?r.reject(new lj(lB.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:e=>r.reject(e)}),o=new fh(new uf(n.path),s,{includeMetadataChanges:!0,Fa:!0});return fr(e,o)})(await fQ(e),e.asyncQueue,t,n,i)),i.promise})(pn(t),e._key).then(n=>(function(e,t,n){let i=n.docs.get(t._key),r=new pS(e);return new pI(e,r,t._key,i,new pE(n.hasPendingWrites,n.fromCache),t.converter)})(t,e,n))}class pS extends pb{constructor(e){super(),this.firestore=e}convertBytes(e){return new pi(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new f5(this.firestore,null,t)}}function pk(e,t,n){e=f0(e,f5);let i=f0(e.firestore,pt),r=(s=e.converter,s?n&&(n.merge||n.mergeFields)?s.toFirestore(t,n):s.toFirestore(t):t);var s,o=i,a=[(function(e,t,n,i,r,s={}){let o,a,l=e.dc(s.merge||s.mergeFields?2:0,t,n,r);pp("Data must be an object, but it was:",l,i);let h=function e(t,n){let i={};return hu(t)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):hh(t,(t,r)=>{let s=function t(n,i){if(pf(n=eV(n)))return pp("Unsupported field value:",i,n),e(n,i);if(n instanceof ps)return function(e,t){if(!pu(t.oc))throw t.Tc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Tc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(n,i),null;if(void 0===n&&i.ignoreUndefinedProperties)return null;if(i.path&&i.fieldMask.push(i.path),n instanceof Array){if(i.settings.cc&&4!==i.oc)throw i.Tc("Nested arrays are not supported");let e=[],r=0;for(let s of n){let n=t(s,i.Pc(r));null==n&&(n={nullValue:"NULL_VALUE"}),e.push(n),r++}return{arrayValue:{values:e}}}return function(e,t){var n,i,r;if(null===(e=eV(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(r=i=e)&&Number.isInteger(r)&&!ha(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER?uO(i):ux(n,i);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=l6.fromDate(e);return{timestampValue:cv(t.serializer,n)}}if(e instanceof l6){let n=new l6(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:cv(t.serializer,n)}}if(e instanceof po)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof pi)return{bytesValue:cw(t.serializer,e._byteString)};if(e instanceof f5){let n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Tc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:cE(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof pa)return{mapValue:{fields:{[hx]:{stringValue:hM},[hU]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Tc("VectorValues must only contain numeric values.");return ux(t.serializer,e)})}}}}};throw t.Tc(`Unsupported field value: ${fZ(e)}`)}(n,i)}(r,n.uc(t));null!=s&&(i[t]=s)}),{mapValue:{fields:i}}}(i,l);if(s.merge)o=new hm(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let i of s.mergeFields){let r=function(e,t,n){if((t=eV(t))instanceof pr)return t._internalPath;if("string"==typeof t)return pm(e,t);throw py("Field path arguments must be of type string or ",e,!1,void 0,n)}(t,i,n);if(!l.contains(r))throw new lj(lB.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);(function(e,t){return e.some(e=>e.isEqual(t))})(e,r)||e.push(r)}o=new hm(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new ph(new hZ(h),o,a)})(function(e){let t=e._freezeSettings(),n=dI(e._databaseId);return new pd(e._databaseId,!!t.ignoreUndefinedProperties,n)}(i),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,uW.none())],l=pn(o);let h=new lq;return l.asyncQueue.enqueueAndForget(async()=>fI(await fG(l).then(e=>e.syncEngine),a,h)),h.promise}new WeakMap,function(e=!0){lR=tp,th(new eB("firestore",(t,{instanceIdentifier:n,options:i})=>{let r=t.getProvider("app").getImmediate(),s=new pt(new lW(t.getProvider("auth-internal")),new lY(r,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new lj(lB.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hD(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s},"PUBLIC").setMultipleInstances(!0)),ty(lk,lA,void 0),ty(lk,lA,"esm2017")}();const pA=tg({apiKey:"AIzaSyA-ZfLVt-mMYlewskoMF0xVdp7ODXykBMs",authDomain:"cgpa-master-calculator.firebaseapp.com",projectId:"cgpa-master-calculator",storageBucket:"cgpa-master-calculator.firebasestorage.app",messagingSenderId:"127347563364",appId:"1:127347563364:web:a5b7f218cffaf0401cf871"}),pN=function(e=tm()){let t=tu(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=tu(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(eN(n.getOptions(),null!=t?t:{}))return e;tx(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:rh,persistence:[iM,iv,iw]}),i=es("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(i,location.origin);if(location.origin===e.origin){let t=rw(e.toString());eV(n).beforeAuthStateChanged(t,()=>t(n.currentUser)),eV(n).onIdTokenChanged(e=>t(e),void 0,void 0)}}let r=en("auth");return r?!function(e,t,n){let i=eV(e);tF(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=n$(t),{host:s,port:o}=function(e){let t=n$(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let e=r[1];return{host:e,port:nz(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:nz(t)}}}(t),a=null===o?"":`:${o}`,l={url:`${r}//${s}${a}/`},h=Object.freeze({host:s,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){tF(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),tF(eN(l,i.config.emulator)&&eN(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=l,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,ea(s)?(ed("Auth",!0),el(`${r}//${s}${a}`)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`):ed("Auth",!1),n}(pA),pR=function(e,t){let n=tu("object"==typeof e?e:tm(),"firestore").getImmediate({identifier:"string"==typeof e?e:hP});if(!n._initialized){let e=ei("firestore");e&&function(e,t,n,i={}){var r;e=f0(e,f6);let s=ea(t),o=e._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;o.host!==f1&&o.host!==l&&lL("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},o),{host:l,ssl:s,emulatorOptions:i});if(!eN(h,a)&&(e._setSettings(h),s&&(el(`https://${l}`),ed("Firestore",!0)),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=lN.MOCK_USER;else{t=eh(i.mockUserToken,null==(r=e._app)?void 0:r.options.projectId);let s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new lj(lB.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new lN(s)}e._authCredentials=new lH(new l$(t,n))}}(n,...e)}return n}(pA);function pP(){let e=document.getElementById("signup-name").value.trim(),t=document.getElementById("signup-matric").value.trim().toUpperCase(),n=document.getElementById("signup-email").value.trim(),i=document.getElementById("signup-password").value.trim();if(!e||!t||!n||!i)return void pL("Please fill all fields.","error");ig(pN,n,i).then(i=>pk(f8(pR,"users",i.user.uid),{name:e,matric:t,email:n})).then(()=>{alert("Account created successfully!"),window.location.href="index.html"}).catch(e=>{console.error("Signup Error:",e),alert("Error: "+e.message)})}function pD(){let e=document.getElementById("login-email").value.trim(),t=document.getElementById("login-password").value.trim();if(!e||!t)return void pL("Please fill all fields.","error");(tc(pN.app)?Promise.reject(tM(pN)):id(eV(pN),n4.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&ip(pN),e})).then(e=>{px(e.user.uid).then(e=>{if(e){let t=document.getElementById("welcome-message");t&&(t.textContent=`Welcome, ${e.name}!`)}}),pL("\uD83D\uDC4B Welcome back!","success"),window.location.href="homePage.html"}).catch(e=>{pL("❌ Login failed: "+e.message,"error"),console.error("Login Error:",e)})}async function px(e){try{let t=f8(pR,"users",e),n=await pC(t);if(n.exists())return n.data();return null}catch(e){return console.error("Error fetching user data:",e),null}}function pO(){eV(pN).signOut().then(()=>{alert("\uD83D\uDEAA Logged out successfully!"),window.location.href="index.html"}).catch(e=>{alert("❌ Error logging out: "+e.message),console.error("Logout Error:",e)})}function pL(e,t="info"){let n=document.getElementById("status-message");n.textContent=e,n.style.display="block","success"===t?(n.style.backgroundColor="#d4edda",n.style.color="#155724",n.style.border="1px solid #c3e6cb"):"error"===t?(n.style.backgroundColor="#f8d7da",n.style.color="#721c24",n.style.border="1px solid #f5c6cb"):(n.style.backgroundColor="#d1ecf1",n.style.color="#0c5460",n.style.border="1px solid #bee5eb"),n.style.width="90%"}function pM(e){let t=e.closest("tr");if(t){let e=t.closest("table").id;t.remove(),pU(e,t)}}async function pU(e,t){let n=pN.currentUser;if(n)try{let i=f8(pR,"users",n.uid),r=await pC(i);if(r.exists()){let n=(r.data().semesters||{}).tableData||{};if(n[e]){let r=t.querySelectorAll("input"),s=r[0].value.trim(),o=r[1].value.trim(),a=r[2].value.trim();n[e]=n[e].filter(e=>e.course!==s||e.credit!==o||e.grade!==a),await pk(i,{semesters:{tableData:n}},{merge:!0}),console.log(`Course deleted from ${e} in Firestore.`),pq(e),p$()}}}catch(e){console.error("Error deleting course from Firestore:",e),alert("Error deleting course.")}}function pF(){let e=document.getElementById("semesterSelect").value,t=document.getElementById("semester-tables");if(document.getElementById(e))return void alert(`${e} already exists.`);let n=document.createElement("div");n.innerHTML=`
      <h3>${e}</h3>
      <table id="${e}" class="input-table">
        <thead>
          <tr>
            <th>Course</th>
            <th>Credit</th>
            <th>Grade</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button class="btn add-course-btn" data-semester="${e}">Add Course</button>
      <button class="btn calculate-gpa-btn" data-semester="${e}">Calculate GPA</button>
    `,t.appendChild(n)}function pV(e){let t=document.getElementById(e);if(!t)return;let n=document.createElement("tr");n.innerHTML=`
      <td><input type="text" placeholder="Course" /></td>
      <td><input type="number" placeholder="Credit" /></td>
      <td><input type="text" placeholder="Grade or Score" /></td>
      <td><button class="delete-btn">Delete</button></td>
    `,t.querySelector("tbody").appendChild(n)}function pB(e){return({A:5,B:4,C:3,D:2,E:1,F:0})[e.toUpperCase()]??null}function pj(e){return e>=70&&e<=100?"A":e>=60?"B":e>=50?"C":e>=45?"D":e>=40?"E":"F"}function pq(e){let t=document.getElementById(e),n=t.querySelectorAll("tbody tr"),i=0,r=0,s=document.getElementById(`${e}-msg`);s&&s.remove();let o=null;n.forEach(t=>{let n=t.querySelectorAll("input"),s=parseFloat(n[1].value),a=n[2].value.trim().toUpperCase();if(!a||isNaN(s))return;if(!isNaN(a)){let t=parseFloat(a);if(t<0||t>100){o=`\u{26A0}\u{FE0F} Invalid score '${t}' in ${e}. Must be between 0 and 100.`;return}a=pj(t)}let l=pB(a);null===l||isNaN(s)||(i+=s*l,r+=s)});let a=document.getElementById(`${e}-gpa`);if(a&&a.remove(),(a=document.createElement("p")).id=`${e}-gpa`,0===r)a.textContent=`\u{26A0}\u{FE0F} No valid data for ${e}`,a.style.color="red";else{let t=(i/r).toFixed(2);a.textContent=`\u{1F4D8} GPA for ${e}: ${t}`,a.style.color="#1976d2"}if(o){let n=document.createElement("p");n.id=`${e}-msg`,n.textContent=o,n.style.color="red",n.style.marginTop="5px",t.parentElement.appendChild(n)}t.parentElement.appendChild(a)}function p$(){let e=document.querySelectorAll(".input-table"),t={},n=0,i=0,r={};e.forEach(e=>{let s=e.id,o=e.querySelectorAll("tbody tr"),a=0,l=0;if(r[s]=[],o.forEach(e=>{let t=e.querySelectorAll("input"),n=t[0].value.trim(),i=parseFloat(t[1].value),o=t[2].value.trim().toUpperCase();if(!o)return;if(!isNaN(o)){let e=parseFloat(o);if(e<0||e>100)return void alert(`\u{26A0}\u{FE0F} Invalid score '${e}'. Please enter a score between 0 and 100.`);o=pj(e)}let h=pB(o);r[s].push({course:n,credit:t[1].value,grade:t[2].value}),isNaN(i)||null===h||(a+=i*h,l+=i)}),l>0){let e=(a/l).toFixed(2);t[s]={gpa:e,points:a,credits:l},n+=a,i+=l}});let s=document.getElementById("cgpa-result");if(0===i){s.textContent="⚠️ No valid grades entered.",s.style.color="red";return}let o=(n/i).toFixed(2),a=`\u{1F393} CGPA: ${o}`,l="#24633c",h=parseFloat(o);h>=4.5?(a+=" – First Class \uD83C\uDF89",l="green"):h>=3.5?(a+=" – Second Class Upper \uD83D\uDC4D",l="blue"):h>=2.5?(a+=" – Second Class Lower \uD83D\uDC4C",l="orange"):h>=1.5?(a+=" – Third Class ⚠️",l="tomato"):(a+=" – Probation \uD83D\uDEA8",l="darkred"),s.textContent=a,s.style.color=l;let u=Object.keys(t),c=u.map(e=>t[e].gpa);pz(u,c),pH({tableData:r,semesterData:t,cgpaMessage:a,cgpaColor:l})}function pz(e,t){let n=document.getElementById("gpaChart").getContext("2d");d&&d.destroy(),d=new Chart(n,{type:"line",data:{labels:e,datasets:[{label:"GPA Progress",data:t,borderColor:"#24633c",backgroundColor:"#24633c",tension:.3,pointRadius:5,pointHoverRadius:7}]},options:{responsive:!0,scales:{y:{suggestedMin:0,suggestedMax:5,title:{display:!0,text:"GPA"}},x:{title:{display:!0,text:"Semester"}}},plugins:{legend:{display:!1}}}})}async function pH(e){let t=pN.currentUser;if(t)try{let n=f8(pR,"users",t.uid),i=Object.keys(e.tableData).map(t=>({name:t,tableData:e.tableData[t],gpa:e.semesterData[t].gpa}));i.sort((e,t)=>e.name.localeCompare(t.name)),await pk(n,{semesters:i,cgpaMessage:e.cgpaMessage,cgpaColor:e.cgpaColor},{merge:!0}),console.log("✅ Data saved successfully to Firestore.")}catch(e){console.error("❌ Error saving data to Firestore:",e)}}async function pW(){let e=pN.currentUser;if(!e)return null;try{let t=f8(pR,"users",e.uid),n=await pC(t);if(!n.exists())return null;{let e=n.data(),t=e.semesters||[],i=document.getElementById("semester-tables");if(i){if(i.innerHTML="",t.forEach(e=>{let t=document.createElement("div");t.innerHTML=`
              <h3>${e.name}</h3>
              <table id="${e.name}" class="input-table">
                <thead>
                  <tr>
                    <th>Course</th>
                    <th>Credit</th>
                    <th>Grade</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <button class="btn add-course-btn" data-semester="${e.name}">Add Course</button>
              <button class="btn calculate-gpa-btn" data-semester="${e.name}">Calculate GPA</button>
            `,i.appendChild(t);let n=document.getElementById(e.name);if(n){let i=n.querySelector("tbody");e.tableData.forEach(e=>{let t=document.createElement("tr");t.innerHTML=`
                  <td><input type="text" value="${e.course}" /></td>
                  <td><input type="number" value="${e.credit}" /></td>
                  <td><input type="text" value="${e.grade}" /></td>
                  <td><button class="delete-btn">Delete</button></td>
                `,i.appendChild(t)});let r=document.createElement("p");r.id=`${e.name}-gpa`,r.textContent=`\u{1F4D8} GPA for ${e.name}: ${e.gpa}`,r.style.color="#1976d2",t.appendChild(r)}}),e.cgpaMessage&&e.cgpaColor){let t=document.getElementById("cgpa-result");t&&(t.textContent=e.cgpaMessage,t.style.color=e.cgpaColor)}let n=t.map(e=>e.name),r=t.map(e=>e.gpa);pz(n,r)}return e}}catch(e){return console.error("Error loading user data:",e),null}}async function pK(){let e=document.createElement("div"),t=pN.currentUser;if(t){let n=f8(pR,"users",t.uid),i=await pC(n);if(i.exists()){let t=i.data(),n=document.createElement("div");n.innerHTML=`
        <h2>CGPA Master Report</h2>
        <p><strong>Name:</strong> ${t.name}</p>
        <p><strong>Matric Number:</strong> ${t.matric}</p>
      `,n.style.paddingBottom="20px",e.appendChild(n)}}let n=document.getElementById("semester-tables")?.cloneNode(!0),i=document.getElementById("cgpa-result")?.cloneNode(!0);e.appendChild(n),e.appendChild(i),e.classList.remove("container"),e.style.margin="0px",e.style.fontFamily="Arial, sans-serif",html2pdf().set({margin:.5,filename:"CGPA_Report.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"a4",orientation:"landscape"}}).from(e).save()}!function(e=tm(),t){let n=tu(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=ei("database");e&&function(e,t,n,i={}){let r;(e=eV(e))._checkNotDeleted("useEmulator");let s=`${t}:${n}`,o=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&eN(i,o.repoInfo_.emulatorOptions))return;rJ("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}o.repoInfo_.nodeAdmin?(i.mockUserToken&&rJ('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new sa(sa.OWNER)):i.mockUserToken&&(r=new sa("string"==typeof i.mockUserToken?i.mockUserToken:eh(i.mockUserToken,e.app.options.projectId))),ea(t)&&(el(t),ed("Database",!0));var a=r;let l=s.lastIndexOf(":"),h=ea(s.substring(0,l));o.repoInfo_=new sc(s,h,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams,!0,i),a&&(o.authTokenProvider_=a)}(n,...e)}}(pA),document.addEventListener("DOMContentLoaded",()=>{var e;let t=document.getElementById("signup-button"),n=document.getElementById("login-button"),i=document.getElementById("add-semester"),r=document.getElementById("semester-tables"),s=document.getElementById("calculate-gpa"),o=document.getElementById("logout-button"),a=document.getElementById("save-transcript-btn");t&&t.addEventListener("click",pP),n&&n.addEventListener("click",pD),i&&i.addEventListener("click",pF),s&&s.addEventListener("click",p$),o&&o.addEventListener("click",pO),a&&a.addEventListener("click",pK),r.addEventListener("click",e=>{e.target.classList.contains("add-course-btn")&&pV(e.target.dataset.semester),e.target.classList.contains("calculate-gpa-btn")&&pq(e.target.dataset.semester),e.target.classList.contains("delete-btn")&&pM(e.target)}),e=async e=>{if(e){let t=f8(pR,"users",e.uid),n=await pC(t);if(n.exists()){let e=n.data(),t=document.getElementById("welcome-message");t&&(t.textContent=`Welcome, ${e.name||""}!`)}pW()}else window.location.href="index.html"},eV(pN).onAuthStateChanged(e,void 0,void 0)}),window.addSemesterRow=pV,window.deleteRow=pM,window.calculateGPA=pq,window.calculateCGPA=p$,window.deleteCourse=pU;
//# sourceMappingURL=CGPA-Master-Tracker.4e67e096.js.map
